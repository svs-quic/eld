<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>17. Linker support and frequently asked questions!!! &mdash; ELD  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/index.css" type="text/css" />
      <link rel="stylesheet" href="/home/runner/work/eld/eld/obj/tools/eld/docs/userguide/source/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="16. Target Specific Features" href="target_specific_features.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ELD
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="linker_overview.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="linking_modes_supported.html">2. Supported Linking Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_targets.html">3. Supported Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_script.html">4. Linker Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_diagnostics.html">5. Diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_support_backward_compatibility.html">6. Shared Library Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_support_backward_compatibility.html#gnu-elf-symbol-versioning">7. GNU ELF Symbol Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_structure_and_generation.html">8. Image Structure and Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_map_files.html">9. Linker Map Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="layout.html">10. Image layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_plugins_updated.html">11. Linker Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="linker_optimizations.html">12. Linker Optimization Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="lto_support.html">13. LTO Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_image_details.html">14. Getting Image Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/options.html">15. Command-line options</a></li>
<li class="toctree-l1"><a class="reference internal" href="target_specific_features.html">16. Target Specific Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">17. Linker support and frequently asked questions!!!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-linker-questions">17.1. General Linker Questions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-pass-arguments-to-linker-using-clang-clang-driver">17.1.1. How do I pass arguments to linker using clang/clang++ driver ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-remove-unused-functions-from-the-final-elf">17.1.2. How to remove unused functions from the final ELF ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-trace-a-symbol">17.1.3. How do I trace a symbol ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-trace-a-relocation">17.1.4. How do I trace a relocation ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#figure-out-garbage-collected-symbols">17.1.5. Figure out garbage collected symbols</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linker-is-garbage-collecting-a-symbol">17.1.6. Linker is garbage collecting a symbol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#print-timing-information">17.1.7. Print Timing Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linker-is-taking-a-long-time-to-link">17.1.8. Linker is taking a long time to link</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-figure-out-why-a-archive-member-is-being-loaded-by-the-linker">17.1.9. How to figure out why a archive member is being loaded by the linker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controlling-page-size">17.1.10. Controlling Page size</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-fail-a-build-for-linker-warnings">17.1.11. How to fail a build for linker warnings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weak-references-and-definitions">17.1.12. Weak references and definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reproducing-a-failure">17.1.13. Reproducing a failure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-ways-to-invoke-eld-linker">17.1.14. Multiple ways to invoke ELD linker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ignore-multiple-definition-errors-and-continue-with-the-link">17.1.15. Ignore multiple definition errors and continue with the link</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-ways-to-provide-entry-point-to-linker">17.1.16. Multiple ways to provide entry point to linker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-obtain-a-non-executable-stack">17.1.17. How to obtain a non-executable stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-the-difference-between-section-type-nobits-and-progbits">17.1.18. What is the difference between section type NOBITS and PROGBITS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-link-libraries-to-resolve-circular-dependencies">17.1.19. How to link libraries to resolve circular dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-disable-use-of-standard-system-startup-files">17.1.20. How to disable use of standard system startup files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-disable-use-of-standard-system-libraries">17.1.21. How to disable use of standard system libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-remove-a-section-from-a-obj-file">17.1.22. How to remove a section from a OBJ file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-extract-obj-files-from-an-archive">17.1.23. How to extract OBJ files from an archive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-obtain-a-deterministic-output-from-linker">17.1.24. How to obtain a deterministic output from linker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-obtain-memory-statistics-from-an-elf-file-or-obj-file">17.1.25. How to obtain memory statistics from an ELF file or OBJ file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-compare-layout-of-two-output-images">17.1.26. How to compare layout of two output images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-embed-a-binary-and-use-it-in-c-code">17.1.27. How to embed a binary and use it in ‘C’ code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-python-code-to-create-a-binary-file">17.1.28. Simple python code to create a binary file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-simple-assembly-file-to-include-this-binary-file">17.1.29. Create a simple assembly file to include this binary file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#include-this-assembly-file-to-build-a-static-executable">17.1.30. Include this assembly file to build a static executable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#where-should-note-gnu-property-section-map-to-in-elf">17.1.31. Where should .note.gnu.property section map to in elf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-garbage-collect-symbols-in-a-shared-library">17.1.32. How to garbage-collect symbols in a shared library?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-are-zero-sized-sections-handled">17.1.33. How are zero-sized sections handled?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#relocation-referring-to-a-zero-sized-section">17.1.33.1. Relocation referring to a zero sized section</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-section-has-associated-symbols">17.1.33.2. The section has associated symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#can-a-zero-sized-section-ever-affect-the-layout-yes-it-can">17.1.33.3. Can a zero-sized section ever affect the layout?  - Yes it can</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging-zero-sized-sections-related-issues">17.1.33.4. Debugging zero-sized sections related issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-interpret-the-new-trampoline-naming-convention">17.1.34. How to interpret the new trampoline naming convention?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-1">17.1.34.1. Case 1:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case2">17.1.34.2. Case2:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case3">17.1.34.3. Case3:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case4">17.1.34.4. Case4:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-loadable-segments-are-unsorted-by-virtual-address-warning-from-llvm-readelf">17.1.35. Understanding “loadable segments are unsorted by virtual address” warning from llvm-readelf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linker-overlap-checks">17.1.36. Linker overlap checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#input-file-to-linker">17.2. Input File to Linker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#elf-executable-as-input-files-to-the-linker">17.2.1. ELF executable as input files to the linker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#linker-script-general-questions">17.3. Linker Script General Questions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging-section-placements">17.3.1. Debugging section placements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linker-script-rules">17.3.2. Linker Script Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fill-values">17.3.3. Fill Values</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#output-section-fill">17.3.3.1. Output Section Fill</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#i-am-getting-an-error-no-linker-script-rule-for-bss">17.3.4. I am getting an error, no linker script rule for “.bss”</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-am-getting-an-error-no-linker-script-rule-for-data-bar">17.3.5. I am getting an error, no linker script rule for “.data.bar”</a></li>
<li class="toctree-l3"><a class="reference internal" href="#is-there-a-way-to-find-all-used-unused-rules-in-the-linker-script">17.3.6. Is there a way to find all used/unused rules in the Linker script ?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#unused-rules">17.3.6.1. UnUsed Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#used-rules">17.3.6.2. Used Rules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-exclude-sections-from-object-files-archive-files">17.3.7. How do I exclude sections from object files/archive files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#excluding-sections-from-object-files">17.3.7.1. Excluding sections from object files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exclude-all-patterns-of-text-section-from-one-file">17.3.7.2. Exclude all patterns of text section from one file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#excluding-all-patterns-of-text-section-from-more-than-one-file">17.3.7.3. Excluding all patterns of text section from more than one file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specifying-multiple-exclude-patterns">17.3.7.4. Specifying multiple exclude patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-mistakes-with-exclude-files">17.3.7.5. Common mistakes with exclude files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#not-specifying-all-the-files-in-the-exclude-file-pattern">17.3.7.6. Not specifying all the files in the EXCLUDE_FILE pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specifying-exclude-file-directive-that-applies-to-multiple-section-patterns">17.3.7.7. Specifying EXCLUDE_FILE directive that applies to multiple section patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nocrossrefs">17.3.7.8. NOCROSSREFS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-discard-an-input-section">17.3.8. How to discard an input section?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#marking-a-loadable-output-section-as-non-loadable">17.3.9. Marking a loadable output section as non loadable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-does-keep-mean-for-input-section-descriptions-in-discard-added-in-hex-8-8">17.3.10. What does KEEP mean for input section descriptions in /DISCARD/? (Added in HEX 8.8)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-executables-by-linking-symbols-from-an-another-elf-file">17.3.11. How to build executables by linking symbols from an another ELF file?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#symdef-file">17.3.11.1. SymDef file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-specify-load-memory-address-lma-of-a-section">17.3.12. How to specify Load Memory Address (LMA) of a section?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-layout-using-lma">17.3.13. Image layout using LMA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-are-byte-short-long-quad-squad-linker-script-commands">17.3.14. What are BYTE/SHORT/LONG/QUAD/SQUAD linker script commands?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-the-order-of-linker-script-assignment-evaluations">17.3.15. What is the order of linker script assignment evaluations?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic">17.3.15.1. Basic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-an-after-sections-variable-to-initialize-an-in-sections-variable">17.3.15.2. Use an after-sections variable to initialize an in-sections variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-a-variable-that-is-defined-in-both-before-sections-and-after-sections-assignment-to-initialize-an-in-sections-variable">17.3.15.3. Use a variable, that is defined in both before-sections and after-sections assignment, to initialize an in-sections variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-a-defsym-symbol-in-linker-script-assignment-expression">17.3.15.4. Using a defsym symbol in linker script assignment expression</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-linker-script-changes-are-required-for-supporting-thread-local-storage-tls">17.3.15.5. What linker script changes are required for supporting thread-local storage (TLS)?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#why-am-i-getting-the-warning-space-between-archive-member-file-pattern-is-deprecated">17.3.16. Why am I getting the warning ‘Space between archive:member file pattern is deprecated’</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#linker-script-phdrs">17.4. Linker Script PHDRS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#when-should-i-use-phdrs-command">17.4.1. When should I use PHDRS command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#my-output-file-is-big">17.4.2. My output file is big!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loadable-section-not-in-any-load-segment">17.4.3. Loadable section not in any load segment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#segments-need-to-be-mentioned-contiguously-in-the-linker-script">17.4.4. Segments need to be mentioned contiguously in the linker script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-file-header-and-program-header-to-be-loaded">17.4.5. Getting file header and program header to be loaded</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-at-along-with-loading-file-headers-and-program-headers">17.4.6. Using AT along with loading file headers and program headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-phdr-flags">17.4.7. Using PHDR flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-only-the-program-header">17.4.8. Loading only the program header</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#string-merging">17.5. String Merging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#merging-order">17.5.1. Merging order</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hexagon">17.6. Hexagon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#convert-binary-file-to-hexagon">17.6.1. Convert binary file to Hexagon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hexagon-specific-behavior">17.6.2. Hexagon specific behavior</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phdrs">17.6.2.1. PHDRS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-common-input-section-description-does-not-affect-all-the-common-symbols">17.6.2.2. Why <em>COMMON</em> input section description does not affect all the common symbols?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-disable-small-common-symbol-functionality">17.6.2.3. How to disable small common symbol functionality?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#risc-v">17.7. RISC-V</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#show-linker-relaxation-output">17.7.1. Show Linker relaxation output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disable-relaxation">17.7.2. Disable Relaxation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disable-compressed-relaxation">17.7.3. Disable compressed relaxation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage">17.8. Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linker-plugin-framework">17.9. Linker Plugin Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-are-the-differences-between-sectionmatcherplugin-and-sectioniteratorplugin">17.9.1. What are the differences between SectionMatcherPlugin and SectionIteratorPlugin?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#symbol-resolution">17.10. Symbol Resolution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#symbol-wrapping">17.10.1. Symbol wrapping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-symbol-wrapping-and-how-to-use-it">17.10.1.1. What is symbol wrapping and how to use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where-is-symbol-wrapping-helpful">17.10.1.2. Where is symbol wrapping helpful?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">17.10.1.3. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-time-issues">17.11. Build time issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-to-all-targets">17.11.1. Common to all targets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lto-is-showing-undefined-symbol-when-symbol-is-defined">17.11.1.1. LTO is showing undefined symbol when symbol is defined</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lto-is-showing-could-not-set-section-name-for-the-symbol">17.11.1.2. LTO is showing could not set section name for the symbol</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id5">17.12. Hexagon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#relocation-overflows-to-function-symbols">17.12.1. Relocation overflows to function symbols</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-linker-crash-issues">17.12.2. Debugging Linker crash issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1">17.12.2.1. Step 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2">17.12.2.2. Step 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3">17.12.2.3. Step 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4">17.12.2.4. Step 4</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5">17.12.2.5. Step 5</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#arm">17.13. ARM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sbrel-relocations-fixing-relocation-error-when-applying-relocation-r-arm-sbrel32">17.13.1. SBREL relocations : Fixing relocation error when applying relocation ‘R_ARM_SBREL32’</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-resolve-the-warning-compact-option-needs-physical-address-aligned-with-file-offsets">17.13.2. How to resolve the warning ‘Compact Option needs physical address aligned with File offsets’</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#runtime-issues">17.14. Runtime issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">17.14.1. ARM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#crash-with-load-stores">17.14.2. Crash with load / stores</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#improving-your-image-build">17.15. Improving your image/build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#warnings">17.15.1. Warnings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#convert-warning-to-error">17.15.1.1. Convert warning to error</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-allocatable-section-assigned-to-an-output-section">17.15.1.2. Non allocatable section assigned to an output section</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#linkerplugin-api">17.16. LinkerPlugin API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build-errors">17.16.1. Build Errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-am-i-receiving-the-error-functions-that-differ-only-in-their-return-type-cannot-be-overloaded-error-while-building-plugins">17.16.1.1. Why am I receiving the error ‘functions that differ only in their return type cannot be overloaded’ error while building plugins?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-am-i-getting-an-error-about-plugin-error-referenced-chunk-seen-from-last-rule-deleted-from-output-section">17.16.1.2. Why am I getting an error about “Plugin Error referenced chunk &lt;seen from last rule&gt; deleted from Output section”</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-errors">17.16.2. Runtime errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-am-i-receiving-the-error-unable-to-load-library-libyourplugin-so-undefined-symbol">17.16.2.1. Why am I receiving the error ‘Unable to load library ${libYourPlugin.so}: undefined symbol: …’?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#concepts">17.16.3. Concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id15">17.16.3.1. What are the differences between SectionMatcherPlugin and SectionIteratorPlugin?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-is-the-search-order-for-plugin-invocation-configuration-file">17.16.3.2. What is the search order for plugin invocation configuration file?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-is-the-search-order-for-linkerwrapper-findconfigfile-function">17.16.3.3. What is the search order for LinkerWrapper::findConfigFile function?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugging">17.16.4. Debugging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-see-which-plugins-are-successfully-loaded">17.16.4.1. How to see which plugins are successfully loaded?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-it-expected-to-see-decrease-in-link-time-performance-when-plugins-are-used">17.16.4.2. Is it expected to see decrease in link-time performance when plugins are used?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-verify-which-plugin-config-file-was-selected-by-the-linker">17.16.4.3. How to verify which plugin config file was selected by the linker?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#plugin-compatibility">17.16.5. Plugin compatibility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#plugin-api-version">17.16.5.1. Plugin API version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reporting-api-version-by-plugins">17.16.5.2. Reporting API version by plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linker-plugin-config-search-paths">17.16.6. Linker Plugin Config Search Paths</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-are-the-search-paths-for-linker-plugin-config-files">17.16.6.1. What are the search paths for linker plugin config files?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-verify-that-the-plugin-search-config-was-found-and-debug-related-issues">17.16.6.2. How to verify that the plugin search config was found and debug related issues?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linker-script-noload-handling">17.16.7. Linker Script NOLOAD handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">17.16.7.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">17.16.7.2. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usecases">17.16.7.3. Usecases</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ELD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">17. </span>Linker support and frequently asked questions!!!</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="linker-support-and-frequently-asked-questions">
<h1><span class="section-number">17. </span>Linker support and frequently asked questions!!!<a class="headerlink" href="#linker-support-and-frequently-asked-questions" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#general-linker-questions" id="id16">General Linker Questions</a></p>
<ul>
<li><p><a class="reference internal" href="#how-do-i-pass-arguments-to-linker-using-clang-clang-driver" id="id17">How do I pass arguments to linker using clang/clang++ driver ?</a></p></li>
<li><p><a class="reference internal" href="#how-to-remove-unused-functions-from-the-final-elf" id="id18">How to remove unused functions from the final ELF ?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-trace-a-symbol" id="id19">How do I trace a symbol ?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-trace-a-relocation" id="id20">How do I trace a relocation ?</a></p></li>
<li><p><a class="reference internal" href="#figure-out-garbage-collected-symbols" id="id21">Figure out garbage collected symbols</a></p></li>
<li><p><a class="reference internal" href="#linker-is-garbage-collecting-a-symbol" id="id22">Linker is garbage collecting a symbol</a></p></li>
<li><p><a class="reference internal" href="#print-timing-information" id="id23">Print Timing Information</a></p></li>
<li><p><a class="reference internal" href="#linker-is-taking-a-long-time-to-link" id="id24">Linker is taking a long time to link</a></p></li>
<li><p><a class="reference internal" href="#how-to-figure-out-why-a-archive-member-is-being-loaded-by-the-linker" id="id25">How to figure out why a archive member is being loaded by the linker</a></p></li>
<li><p><a class="reference internal" href="#controlling-page-size" id="id26">Controlling Page size</a></p></li>
<li><p><a class="reference internal" href="#how-to-fail-a-build-for-linker-warnings" id="id27">How to fail a build for linker warnings</a></p></li>
<li><p><a class="reference internal" href="#weak-references-and-definitions" id="id28">Weak references and definitions</a></p></li>
<li><p><a class="reference internal" href="#reproducing-a-failure" id="id29">Reproducing a failure</a></p></li>
<li><p><a class="reference internal" href="#multiple-ways-to-invoke-eld-linker" id="id30">Multiple ways to invoke ELD linker</a></p></li>
<li><p><a class="reference internal" href="#ignore-multiple-definition-errors-and-continue-with-the-link" id="id31">Ignore multiple definition errors and continue with the link</a></p></li>
<li><p><a class="reference internal" href="#multiple-ways-to-provide-entry-point-to-linker" id="id32">Multiple ways to provide entry point to linker</a></p></li>
<li><p><a class="reference internal" href="#how-to-obtain-a-non-executable-stack" id="id33">How to obtain a non-executable stack</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-difference-between-section-type-nobits-and-progbits" id="id34">What is the difference between section type NOBITS and PROGBITS</a></p></li>
<li><p><a class="reference internal" href="#how-to-link-libraries-to-resolve-circular-dependencies" id="id35">How to link libraries to resolve circular dependencies</a></p></li>
<li><p><a class="reference internal" href="#how-to-disable-use-of-standard-system-startup-files" id="id36">How to disable use of standard system startup files</a></p></li>
<li><p><a class="reference internal" href="#how-to-disable-use-of-standard-system-libraries" id="id37">How to disable use of standard system libraries</a></p></li>
<li><p><a class="reference internal" href="#how-to-remove-a-section-from-a-obj-file" id="id38">How to remove a section from a OBJ file</a></p></li>
<li><p><a class="reference internal" href="#how-to-extract-obj-files-from-an-archive" id="id39">How to extract OBJ files from an archive</a></p></li>
<li><p><a class="reference internal" href="#how-to-obtain-a-deterministic-output-from-linker" id="id40">How to obtain a deterministic output from linker</a></p></li>
<li><p><a class="reference internal" href="#how-to-obtain-memory-statistics-from-an-elf-file-or-obj-file" id="id41">How to obtain memory statistics from an ELF file or OBJ file</a></p></li>
<li><p><a class="reference internal" href="#how-to-compare-layout-of-two-output-images" id="id42">How to compare layout of two output images</a></p></li>
<li><p><a class="reference internal" href="#how-to-embed-a-binary-and-use-it-in-c-code" id="id43">How to embed a binary and use it in ‘C’ code</a></p></li>
<li><p><a class="reference internal" href="#simple-python-code-to-create-a-binary-file" id="id44">Simple python code to create a binary file</a></p></li>
<li><p><a class="reference internal" href="#create-a-simple-assembly-file-to-include-this-binary-file" id="id45">Create a simple assembly file to include this binary file</a></p></li>
<li><p><a class="reference internal" href="#include-this-assembly-file-to-build-a-static-executable" id="id46">Include this assembly file to build a static executable</a></p></li>
<li><p><a class="reference internal" href="#where-should-note-gnu-property-section-map-to-in-elf" id="id47">Where should .note.gnu.property section map to in elf</a></p></li>
<li><p><a class="reference internal" href="#how-to-garbage-collect-symbols-in-a-shared-library" id="id48">How to garbage-collect symbols in a shared library?</a></p></li>
<li><p><a class="reference internal" href="#how-are-zero-sized-sections-handled" id="id49">How are zero-sized sections handled?</a></p>
<ul>
<li><p><a class="reference internal" href="#relocation-referring-to-a-zero-sized-section" id="id50">Relocation referring to a zero sized section</a></p></li>
<li><p><a class="reference internal" href="#the-section-has-associated-symbols" id="id51">The section has associated symbols</a></p></li>
<li><p><a class="reference internal" href="#can-a-zero-sized-section-ever-affect-the-layout-yes-it-can" id="id52">Can a zero-sized section ever affect the layout?  - Yes it can</a></p></li>
<li><p><a class="reference internal" href="#debugging-zero-sized-sections-related-issues" id="id53">Debugging zero-sized sections related issues</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-interpret-the-new-trampoline-naming-convention" id="id54">How to interpret the new trampoline naming convention?</a></p>
<ul>
<li><p><a class="reference internal" href="#case-1" id="id55">Case 1:</a></p></li>
<li><p><a class="reference internal" href="#case2" id="id56">Case2:</a></p></li>
<li><p><a class="reference internal" href="#case3" id="id57">Case3:</a></p></li>
<li><p><a class="reference internal" href="#case4" id="id58">Case4:</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#understanding-loadable-segments-are-unsorted-by-virtual-address-warning-from-llvm-readelf" id="id59">Understanding “loadable segments are unsorted by virtual address” warning from llvm-readelf</a></p></li>
<li><p><a class="reference internal" href="#linker-overlap-checks" id="id60">Linker overlap checks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#input-file-to-linker" id="id61">Input File to Linker</a></p>
<ul>
<li><p><a class="reference internal" href="#elf-executable-as-input-files-to-the-linker" id="id62">ELF executable as input files to the linker</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#linker-script-general-questions" id="id63">Linker Script General Questions</a></p>
<ul>
<li><p><a class="reference internal" href="#debugging-section-placements" id="id64">Debugging section placements</a></p></li>
<li><p><a class="reference internal" href="#linker-script-rules" id="id65">Linker Script Rules</a></p></li>
<li><p><a class="reference internal" href="#fill-values" id="id66">Fill Values</a></p>
<ul>
<li><p><a class="reference internal" href="#output-section-fill" id="id67">Output Section Fill</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#i-am-getting-an-error-no-linker-script-rule-for-bss" id="id68">I am getting an error, no linker script rule for “.bss”</a></p></li>
<li><p><a class="reference internal" href="#i-am-getting-an-error-no-linker-script-rule-for-data-bar" id="id69">I am getting an error, no linker script rule for “.data.bar”</a></p></li>
<li><p><a class="reference internal" href="#is-there-a-way-to-find-all-used-unused-rules-in-the-linker-script" id="id70">Is there a way to find all used/unused rules in the Linker script ?</a></p>
<ul>
<li><p><a class="reference internal" href="#unused-rules" id="id71">UnUsed Rules</a></p></li>
<li><p><a class="reference internal" href="#used-rules" id="id72">Used Rules</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-do-i-exclude-sections-from-object-files-archive-files" id="id73">How do I exclude sections from object files/archive files</a></p>
<ul>
<li><p><a class="reference internal" href="#excluding-sections-from-object-files" id="id74">Excluding sections from object files</a></p></li>
<li><p><a class="reference internal" href="#exclude-all-patterns-of-text-section-from-one-file" id="id75">Exclude all patterns of text section from one file</a></p></li>
<li><p><a class="reference internal" href="#excluding-all-patterns-of-text-section-from-more-than-one-file" id="id76">Excluding all patterns of text section from more than one file</a></p></li>
<li><p><a class="reference internal" href="#specifying-multiple-exclude-patterns" id="id77">Specifying multiple exclude patterns</a></p></li>
<li><p><a class="reference internal" href="#common-mistakes-with-exclude-files" id="id78">Common mistakes with exclude files</a></p></li>
<li><p><a class="reference internal" href="#not-specifying-all-the-files-in-the-exclude-file-pattern" id="id79">Not specifying all the files in the EXCLUDE_FILE pattern</a></p></li>
<li><p><a class="reference internal" href="#specifying-exclude-file-directive-that-applies-to-multiple-section-patterns" id="id80">Specifying EXCLUDE_FILE directive that applies to multiple section patterns</a></p></li>
<li><p><a class="reference internal" href="#nocrossrefs" id="id81">NOCROSSREFS</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-discard-an-input-section" id="id82">How to discard an input section?</a></p></li>
<li><p><a class="reference internal" href="#marking-a-loadable-output-section-as-non-loadable" id="id83">Marking a loadable output section as non loadable</a></p></li>
<li><p><a class="reference internal" href="#what-does-keep-mean-for-input-section-descriptions-in-discard-added-in-hex-8-8" id="id84">What does KEEP mean for input section descriptions in /DISCARD/? (Added in HEX 8.8)</a></p></li>
<li><p><a class="reference internal" href="#how-to-build-executables-by-linking-symbols-from-an-another-elf-file" id="id85">How to build executables by linking symbols from an another ELF file?</a></p>
<ul>
<li><p><a class="reference internal" href="#symdef-file" id="id86">SymDef file</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-specify-load-memory-address-lma-of-a-section" id="id87">How to specify Load Memory Address (LMA) of a section?</a></p></li>
<li><p><a class="reference internal" href="#image-layout-using-lma" id="id88">Image layout using LMA</a></p></li>
<li><p><a class="reference internal" href="#what-are-byte-short-long-quad-squad-linker-script-commands" id="id89">What are BYTE/SHORT/LONG/QUAD/SQUAD linker script commands?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-order-of-linker-script-assignment-evaluations" id="id90">What is the order of linker script assignment evaluations?</a></p>
<ul>
<li><p><a class="reference internal" href="#basic" id="id91">Basic</a></p></li>
<li><p><a class="reference internal" href="#use-an-after-sections-variable-to-initialize-an-in-sections-variable" id="id92">Use an after-sections variable to initialize an in-sections variable</a></p></li>
<li><p><a class="reference internal" href="#use-a-variable-that-is-defined-in-both-before-sections-and-after-sections-assignment-to-initialize-an-in-sections-variable" id="id93">Use a variable, that is defined in both before-sections and after-sections assignment, to initialize an in-sections variable</a></p></li>
<li><p><a class="reference internal" href="#using-a-defsym-symbol-in-linker-script-assignment-expression" id="id94">Using a defsym symbol in linker script assignment expression</a></p></li>
<li><p><a class="reference internal" href="#what-linker-script-changes-are-required-for-supporting-thread-local-storage-tls" id="id95">What linker script changes are required for supporting thread-local storage (TLS)?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#why-am-i-getting-the-warning-space-between-archive-member-file-pattern-is-deprecated" id="id96">Why am I getting the warning ‘Space between archive:member file pattern is deprecated’</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#linker-script-phdrs" id="id97">Linker Script PHDRS</a></p>
<ul>
<li><p><a class="reference internal" href="#when-should-i-use-phdrs-command" id="id98">When should I use PHDRS command</a></p></li>
<li><p><a class="reference internal" href="#my-output-file-is-big" id="id99">My output file is big!</a></p></li>
<li><p><a class="reference internal" href="#loadable-section-not-in-any-load-segment" id="id100">Loadable section not in any load segment</a></p></li>
<li><p><a class="reference internal" href="#segments-need-to-be-mentioned-contiguously-in-the-linker-script" id="id101">Segments need to be mentioned contiguously in the linker script</a></p></li>
<li><p><a class="reference internal" href="#getting-file-header-and-program-header-to-be-loaded" id="id102">Getting file header and program header to be loaded</a></p></li>
<li><p><a class="reference internal" href="#using-at-along-with-loading-file-headers-and-program-headers" id="id103">Using AT along with loading file headers and program headers</a></p></li>
<li><p><a class="reference internal" href="#using-phdr-flags" id="id104">Using PHDR flags</a></p></li>
<li><p><a class="reference internal" href="#loading-only-the-program-header" id="id105">Loading only the program header</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#string-merging" id="id106">String Merging</a></p>
<ul>
<li><p><a class="reference internal" href="#merging-order" id="id107">Merging order</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#hexagon" id="id108">Hexagon</a></p>
<ul>
<li><p><a class="reference internal" href="#convert-binary-file-to-hexagon" id="id109">Convert binary file to Hexagon</a></p></li>
<li><p><a class="reference internal" href="#hexagon-specific-behavior" id="id110">Hexagon specific behavior</a></p>
<ul>
<li><p><a class="reference internal" href="#phdrs" id="id111">PHDRS</a></p></li>
<li><p><a class="reference internal" href="#why-common-input-section-description-does-not-affect-all-the-common-symbols" id="id112">Why <em>COMMON</em> input section description does not affect all the common symbols?</a></p></li>
<li><p><a class="reference internal" href="#how-to-disable-small-common-symbol-functionality" id="id113">How to disable small common symbol functionality?</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#risc-v" id="id114">RISC-V</a></p>
<ul>
<li><p><a class="reference internal" href="#show-linker-relaxation-output" id="id115">Show Linker relaxation output</a></p></li>
<li><p><a class="reference internal" href="#disable-relaxation" id="id116">Disable Relaxation</a></p></li>
<li><p><a class="reference internal" href="#disable-compressed-relaxation" id="id117">Disable compressed relaxation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id118">Usage</a></p></li>
<li><p><a class="reference internal" href="#linker-plugin-framework" id="id119">Linker Plugin Framework</a></p>
<ul>
<li><p><a class="reference internal" href="#what-are-the-differences-between-sectionmatcherplugin-and-sectioniteratorplugin" id="id120">What are the differences between SectionMatcherPlugin and SectionIteratorPlugin?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#symbol-resolution" id="id121">Symbol Resolution</a></p>
<ul>
<li><p><a class="reference internal" href="#symbol-wrapping" id="id122">Symbol wrapping</a></p>
<ul>
<li><p><a class="reference internal" href="#what-is-symbol-wrapping-and-how-to-use-it" id="id123">What is symbol wrapping and how to use it?</a></p></li>
<li><p><a class="reference internal" href="#where-is-symbol-wrapping-helpful" id="id124">Where is symbol wrapping helpful?</a></p></li>
<li><p><a class="reference internal" href="#example" id="id125">Example</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#build-time-issues" id="id126">Build time issues</a></p>
<ul>
<li><p><a class="reference internal" href="#common-to-all-targets" id="id127">Common to all targets</a></p>
<ul>
<li><p><a class="reference internal" href="#lto-is-showing-undefined-symbol-when-symbol-is-defined" id="id128">LTO is showing undefined symbol when symbol is defined</a></p></li>
<li><p><a class="reference internal" href="#lto-is-showing-could-not-set-section-name-for-the-symbol" id="id129">LTO is showing could not set section name for the symbol</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id5" id="id130">Hexagon</a></p>
<ul>
<li><p><a class="reference internal" href="#relocation-overflows-to-function-symbols" id="id131">Relocation overflows to function symbols</a></p></li>
<li><p><a class="reference internal" href="#debugging-linker-crash-issues" id="id132">Debugging Linker crash issues</a></p>
<ul>
<li><p><a class="reference internal" href="#step-1" id="id133">Step 1</a></p></li>
<li><p><a class="reference internal" href="#step-2" id="id134">Step 2</a></p></li>
<li><p><a class="reference internal" href="#step-3" id="id135">Step 3</a></p></li>
<li><p><a class="reference internal" href="#step-4" id="id136">Step 4</a></p></li>
<li><p><a class="reference internal" href="#step-5" id="id137">Step 5</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#arm" id="id138">ARM</a></p>
<ul>
<li><p><a class="reference internal" href="#sbrel-relocations-fixing-relocation-error-when-applying-relocation-r-arm-sbrel32" id="id139">SBREL relocations : Fixing relocation error when applying relocation ‘R_ARM_SBREL32’</a></p></li>
<li><p><a class="reference internal" href="#how-to-resolve-the-warning-compact-option-needs-physical-address-aligned-with-file-offsets" id="id140">How to resolve the warning ‘Compact Option needs physical address aligned with File offsets’</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#runtime-issues" id="id141">Runtime issues</a></p>
<ul>
<li><p><a class="reference internal" href="#id14" id="id142">ARM</a></p></li>
<li><p><a class="reference internal" href="#crash-with-load-stores" id="id143">Crash with load / stores</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#improving-your-image-build" id="id144">Improving your image/build</a></p>
<ul>
<li><p><a class="reference internal" href="#warnings" id="id145">Warnings</a></p>
<ul>
<li><p><a class="reference internal" href="#convert-warning-to-error" id="id146">Convert warning to error</a></p></li>
<li><p><a class="reference internal" href="#non-allocatable-section-assigned-to-an-output-section" id="id147">Non allocatable section assigned to an output section</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#linkerplugin-api" id="id148">LinkerPlugin API</a></p>
<ul>
<li><p><a class="reference internal" href="#build-errors" id="id149">Build Errors</a></p>
<ul>
<li><p><a class="reference internal" href="#why-am-i-receiving-the-error-functions-that-differ-only-in-their-return-type-cannot-be-overloaded-error-while-building-plugins" id="id150">Why am I receiving the error ‘functions that differ only in their return type cannot be overloaded’ error while building plugins?</a></p></li>
<li><p><a class="reference internal" href="#why-am-i-getting-an-error-about-plugin-error-referenced-chunk-seen-from-last-rule-deleted-from-output-section" id="id151">Why am I getting an error about “Plugin Error referenced chunk &lt;seen from last rule&gt; deleted from Output section”</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#runtime-errors" id="id152">Runtime errors</a></p>
<ul>
<li><p><a class="reference internal" href="#why-am-i-receiving-the-error-unable-to-load-library-libyourplugin-so-undefined-symbol" id="id153">Why am I receiving the error ‘Unable to load library ${libYourPlugin.so}: undefined symbol: …’?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#concepts" id="id154">Concepts</a></p>
<ul>
<li><p><a class="reference internal" href="#id15" id="id155">What are the differences between SectionMatcherPlugin and SectionIteratorPlugin?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-search-order-for-plugin-invocation-configuration-file" id="id156">What is the search order for plugin invocation configuration file?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-search-order-for-linkerwrapper-findconfigfile-function" id="id157">What is the search order for LinkerWrapper::findConfigFile function?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#debugging" id="id158">Debugging</a></p>
<ul>
<li><p><a class="reference internal" href="#how-to-see-which-plugins-are-successfully-loaded" id="id159">How to see which plugins are successfully loaded?</a></p></li>
<li><p><a class="reference internal" href="#is-it-expected-to-see-decrease-in-link-time-performance-when-plugins-are-used" id="id160">Is it expected to see decrease in link-time performance when plugins are used?</a></p></li>
<li><p><a class="reference internal" href="#how-to-verify-which-plugin-config-file-was-selected-by-the-linker" id="id161">How to verify which plugin config file was selected by the linker?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#plugin-compatibility" id="id162">Plugin compatibility</a></p>
<ul>
<li><p><a class="reference internal" href="#plugin-api-version" id="id163">Plugin API version</a></p></li>
<li><p><a class="reference internal" href="#reporting-api-version-by-plugins" id="id164">Reporting API version by plugins</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#linker-plugin-config-search-paths" id="id165">Linker Plugin Config Search Paths</a></p>
<ul>
<li><p><a class="reference internal" href="#what-are-the-search-paths-for-linker-plugin-config-files" id="id166">What are the search paths for linker plugin config files?</a></p></li>
<li><p><a class="reference internal" href="#how-to-verify-that-the-plugin-search-config-was-found-and-debug-related-issues" id="id167">How to verify that the plugin search config was found and debug related issues?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#linker-script-noload-handling" id="id168">Linker Script NOLOAD handling</a></p>
<ul>
<li><p><a class="reference internal" href="#description" id="id169">Description</a></p></li>
<li><p><a class="reference internal" href="#references" id="id170">References</a></p></li>
<li><p><a class="reference internal" href="#usecases" id="id171">Usecases</a></p>
<ul>
<li><p><a class="reference internal" href="#noload-region-assigned-to-pt-null-segment" id="id172">NOLOAD region assigned to PT_NULL segment</a></p></li>
<li><p><a class="reference internal" href="#placing-a-loadable-section-to-pt-null" id="id173">Placing a loadable section to PT_NULL</a></p></li>
<li><p><a class="reference internal" href="#placing-noload-region-to-load-segment" id="id174">Placing NOLOAD region to LOAD segment</a></p></li>
<li><p><a class="reference internal" href="#mixing-noload-and-load-regions" id="id175">Mixing NOLOAD and LOAD regions</a></p></li>
<li><p><a class="reference internal" href="#noload-section-in-the-middle-of-a-pt-load-segment" id="id176">NOLOAD section in the middle of a PT_LOAD segment</a></p></li>
<li><p><a class="reference internal" href="#noload-sections-start-of-the-segment-and-pt-null-segment" id="id177">NOLOAD sections start of the segment and PT_NULL segment</a></p></li>
<li><p><a class="reference internal" href="#noload-sections-start-of-the-segment" id="id178">NOLOAD sections start of the segment</a></p>
<ul>
<li><p><a class="reference internal" href="#how-the-offset-of-the-section-is-calculated" id="id179">How the offset of the section is calculated</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#noload-sections-start-of-the-segment-with-first-load-section-starting-at-a-virtual-address" id="id180">NOLOAD sections start of the segment with first load section starting at a virtual address</a></p></li>
<li><p><a class="reference internal" href="#noload-sections-placed-at-beginning-of-segment" id="id181">NOLOAD sections placed at beginning of segment</a></p></li>
<li><p><a class="reference internal" href="#load-sections-following-noload-sections" id="id182">LOAD sections following NOLOAD sections</a></p></li>
<li><p><a class="reference internal" href="#noload-sections-at-the-beginning-of-the-load-segment" id="id183">NOLOAD sections at the beginning of the LOAD segment</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="general-linker-questions">
<h2><a class="toc-backref" href="#id16"><span class="section-number">17.1. </span>General Linker Questions</a><a class="headerlink" href="#general-linker-questions" title="Permalink to this heading"></a></h2>
<div class="section" id="how-do-i-pass-arguments-to-linker-using-clang-clang-driver">
<h3><a class="toc-backref" href="#id17"><span class="section-number">17.1.1. </span>How do I pass arguments to linker using clang/clang++ driver ?</a><a class="headerlink" href="#how-do-i-pass-arguments-to-linker-using-clang-clang-driver" title="Permalink to this heading"></a></h3>
<p>clang/clang++ driver provides <strong>“-Wl,&lt;args&gt;”</strong> option to pass args to linker.</p>
<p>-Wl,&lt;args&gt;</p>
<p>Pass the comma separated arguments in args to the linker</p>
<p>E.g. clang  &lt;compiler_options&gt; <strong>-Wl,-Map=test.map,-e=main</strong></p>
<p>where -Map and -e are linker specific options/args.</p>
<p>These args will be passed to the underlying linker used for processing.</p>
<p>Alternatively, user can also use <strong>“-Xlinker &lt;arg&gt;”</strong> option to pass argument one
at a time to linker.</p>
<p>-Xlinker &lt;arg&gt;</p>
<p>Pass arg to the linker.</p>
<p>E.g. clang  &lt;compiler_options&gt; <strong>-Xlinker -Map=test.map -Xlinker -e=main</strong></p>
</div>
<div class="section" id="how-to-remove-unused-functions-from-the-final-elf">
<h3><a class="toc-backref" href="#id18"><span class="section-number">17.1.2. </span>How to remove unused functions from the final ELF ?</a><a class="headerlink" href="#how-to-remove-unused-functions-from-the-final-elf" title="Permalink to this heading"></a></h3>
<p>This can be achieved in two ways:</p>
<ul>
<li><dl>
<dt>With LTO</dt><dd><ul>
<li><p>All source files should be compiled with compiler option “-flto”.</p></li>
<li><p>During linking stage, enable LTO optimization by specifying “-flto” option.</p>
<p>E.g. clang &lt;compiler_options&gt; <strong>-flto -c</strong> foo.c -o foo.o</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When -flto option is used during compilation, the output object file
(say, foo.o) is not in ELF format.It will be in LLVM-IR bitcode binary
format.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang<span class="w"> </span>&lt;compiler_options&gt;<span class="w"> </span>-flto<span class="w"> </span>-c<span class="w"> </span>bar.c<span class="w"> </span>-o<span class="w"> </span>bar.o
ld.eld<span class="w"> </span>&lt;other_linker_options&gt;<span class="w"> </span>-flto<span class="w"> </span>foo.o<span class="w"> </span>bar.o<span class="w"> </span>-e<span class="w"> </span>&lt;entry_point&gt;<span class="w"> </span>-o<span class="w"> </span>final.out
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>Without LTO</dt><dd><ul>
<li><p>All source files should be compiled with compiler option “-ffunction-sections”.</p></li>
<li><p>During linking stage, enable garbage collection by specifying “–gc-sections” option.
Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang<span class="w"> </span>&lt;compiler_options&gt;<span class="w"> </span>-ffunction-sections<span class="w"> </span>-c<span class="w"> </span>foo.c<span class="w"> </span>-o<span class="w"> </span>foo.o
clang<span class="w"> </span>&lt;compiler_options&gt;<span class="w"> </span>-ffunction-sections<span class="w"> </span>-c<span class="w"> </span>bar.c<span class="w"> </span>-o<span class="w"> </span>bar.o
ld.eld<span class="w"> </span>&lt;other_linker_options&gt;<span class="w"> </span>--gc-sections<span class="w"> </span>-e<span class="w"> </span>&lt;entry_point&gt;<span class="w"> </span>foo.o<span class="w"> </span>bar.o<span class="w"> </span>-o<span class="w"> </span>final.out
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="how-do-i-trace-a-symbol">
<h3><a class="toc-backref" href="#id19"><span class="section-number">17.1.3. </span>How do I trace a symbol ?</a><a class="headerlink" href="#how-do-i-trace-a-symbol" title="Permalink to this heading"></a></h3>
<p>The user can trace a symbol with –trace-symbol &lt;symbolname&gt; or –trace=symbol=&lt;symbolname&gt;</p>
<p>Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ cat 1.c
int foo() {return 0;}
int bar() {return 1;}
$ cat 2.c
int baz() {return foo() + bar ();}
$ ld.eld 1.o 2.o --trace-symbol bar # equivalent to --trace=symbol=bar
Note: Symbol `bar&#39; from Input file `1.o&#39; with info `(ELF)(FUNCTION)(DEFINE)[Global]{DEFAULT}&#39; being added to Namepool
Note: Symbol `bar&#39; from Input file `2.o&#39; with info `(ELF)(NOTYPE)(UNDEFINED)[Global]{DEFAULT}&#39; being added to Namepool
Note: Symbol `bar&#39; from Input file `1.o&#39; with info `(ELF)(FUNCTION)(DEFINE)[Global]{DEFAULT}&#39; being resolved from Namepool
Symbol bar, application site: 0x2c
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-trace-a-relocation">
<h3><a class="toc-backref" href="#id20"><span class="section-number">17.1.4. </span>How do I trace a relocation ?</a><a class="headerlink" href="#how-do-i-trace-a-relocation" title="Permalink to this heading"></a></h3>
<p>The user can trace a relocation with the option –trace=reloc=”&lt;relocname&gt;”</p>
</div>
<div class="section" id="figure-out-garbage-collected-symbols">
<h3><a class="toc-backref" href="#id21"><span class="section-number">17.1.5. </span>Figure out garbage collected symbols</a><a class="headerlink" href="#figure-out-garbage-collected-symbols" title="Permalink to this heading"></a></h3>
<p>The user can find the list of sections that the linker garbage collected using
the option <em>–print-gc-sections</em> option.</p>
<p>The user then needs to go over the sections in the input files, and list the
symbols using objdump tool.</p>
</div>
<div class="section" id="linker-is-garbage-collecting-a-symbol">
<h3><a class="toc-backref" href="#id22"><span class="section-number">17.1.6. </span>Linker is garbage collecting a symbol</a><a class="headerlink" href="#linker-is-garbage-collecting-a-symbol" title="Permalink to this heading"></a></h3>
<p>The linker can garbage collect the symbol only if the symbol is not referenced.
You can use the option –trace=live-edges and see if you are finding a reference
to the section that contains the symbol.</p>
<p>If you don’t see the section that contains the symbol, there might be a missing
link.</p>
<p>You might want to use the option</p>
<blockquote>
<div><ul class="simple">
<li><p>–entry=&lt;entry symbol&gt;</p></li>
<li><p>Use the KEEP linker script directive to add to the list of sections that needs
to be kept.</p></li>
<li><p>-u <em>symbol_name</em> to keep a symbol from being garbage collected</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="print-timing-information">
<h3><a class="toc-backref" href="#id23"><span class="section-number">17.1.7. </span>Print Timing Information</a><a class="headerlink" href="#print-timing-information" title="Permalink to this heading"></a></h3>
<p>Linker can print timing information with the option –print-timing-stats.
This option can be used to see where the linker is spending most of its time.</p>
</div>
<div class="section" id="linker-is-taking-a-long-time-to-link">
<h3><a class="toc-backref" href="#id24"><span class="section-number">17.1.8. </span>Linker is taking a long time to link</a><a class="headerlink" href="#linker-is-taking-a-long-time-to-link" title="Permalink to this heading"></a></h3>
<p>The linker may be taking a long time to link due to the following patterns</p>
<ul class="simple">
<li><dl class="simple">
<dt>A lot of linker script rules</dt><dd><ul>
<li><p>Linker script rules with EXCLUDE_FILE</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>A lot of object files</p></li>
<li><p>Bad image layout</p></li>
</ul>
<p>For figuring out any of the above, you should check the Map file and see the
statistics when the link is successful.</p>
</div>
<div class="section" id="how-to-figure-out-why-a-archive-member-is-being-loaded-by-the-linker">
<h3><a class="toc-backref" href="#id25"><span class="section-number">17.1.9. </span>How to figure out why a archive member is being loaded by the linker</a><a class="headerlink" href="#how-to-figure-out-why-a-archive-member-is-being-loaded-by-the-linker" title="Permalink to this heading"></a></h3>
<p>If you are trying to figure out why an archive member is being loaded you need
to look at the archive records.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>bar<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>baz<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>bar<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!


clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span>-ffunction-sections
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>mylib.a<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span><span class="m">3</span>.o
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>mylib.a<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p>If you see the map file section for archive reference records, you will find
this information :-</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Archive<span class="w"> </span>member<span class="w"> </span>included<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>file<span class="w"> </span><span class="o">(</span>symbol<span class="o">)</span>
mylib.a<span class="o">(</span><span class="m">2</span>.o<span class="o">)</span>
<span class="w">                </span><span class="m">1</span>.o<span class="w"> </span><span class="o">(</span>bar<span class="o">)</span>
mylib.a<span class="o">(</span><span class="m">3</span>.o<span class="o">)</span>
<span class="w">                </span>mylib.a<span class="o">(</span><span class="m">2</span>.o<span class="o">)</span><span class="w"> </span><span class="o">(</span>baz<span class="o">)</span>
</pre></div>
</div>
<p>You can interpret the information as below :-</p>
<ul class="simple">
<li><p>There was a reference in 1.o for bar, hence mylib.a(2.o) was loaded.</p></li>
<li><p>There was a reference in 2.o for baz, hence mylib.a(3.o) was loaded.</p></li>
</ul>
</div>
<div class="section" id="controlling-page-size">
<h3><a class="toc-backref" href="#id26"><span class="section-number">17.1.10. </span>Controlling Page size</a><a class="headerlink" href="#controlling-page-size" title="Permalink to this heading"></a></h3>
<p>You can use the option z max-page-size=&lt;x&gt; to set the page size used by the
linker.</p>
</div>
<div class="section" id="how-to-fail-a-build-for-linker-warnings">
<h3><a class="toc-backref" href="#id27"><span class="section-number">17.1.11. </span>How to fail a build for linker warnings</a><a class="headerlink" href="#how-to-fail-a-build-for-linker-warnings" title="Permalink to this heading"></a></h3>
<p>A linker warning may be considered fatal when the switch –fatal-warnings is
used.</p>
<p>You can turn off this behavior –no-fatal-warnings or removing the switch
–fatal-warnings.</p>
</div>
<div class="section" id="weak-references-and-definitions">
<h3><a class="toc-backref" href="#id28"><span class="section-number">17.1.12. </span>Weak references and definitions</a><a class="headerlink" href="#weak-references-and-definitions" title="Permalink to this heading"></a></h3>
<p>Symbols can be given weak binding by the compiler and assembler. Weak references
and definitions are typically references to library functions.</p>
<p>The linker does not load an object from a library to resolve a weak reference.
It is able to resolve the weak reference only if the definition is included in
the image explicitly.</p>
<p>This can be done by specifying the object file containing the definition on the
link command line.</p>
<p>Alternatively, using “–whole-archive &lt;archive-file&gt; –no-whole-archive” linker
options includes all objects files in the archive to the link.</p>
<p>Also, removing the weak attribute on the symbol will make it a normal or non-weak.
For non-weak symbols, linker will scan the library/archive and loads the
required member(s).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An unresolved weak function call is replaced with a no-operation instruction,
NOP (only for aarch64 and if the linker has not reserved a PLT).</p>
</div>
<p><strong>An example showing that the linker does not load an object from a library to
resolve a weak reference.</strong></p>
<p>By inspecting the disassembly of “a.out”, user can observe that call to bar()
in main() is replaced with a NOP.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>cat &gt; 1.c &lt;&lt; \!
__attribute__((weak))  int bar();
int main() {
 bar();
 return 0;
}
!

cat &gt; 2.c &lt;&lt; \!
int bar() { return 0; }
!

clang -c 1.c 2.c -target aarch64
rm -f lib2.a
llvm-ar cr lib2.a 2.o
ld.eld 1.o lib2.a -t -march aarch64
</pre></div>
</div>
</div>
<div class="section" id="reproducing-a-failure">
<h3><a class="toc-backref" href="#id29"><span class="section-number">17.1.13. </span>Reproducing a failure</a><a class="headerlink" href="#reproducing-a-failure" title="Permalink to this heading"></a></h3>
<p>If you are having an issue, and you want to pass the link step for someone else
to debug, you can use the <em>–reproduce &lt;tarball&gt;</em>  option.</p>
<p>The <em>–-reproduce &lt;tarball&gt;</em>  option creates a tar ball with all the inputs that
were fed to the linker, and rewrites the link command to make it easy for users
to reproduce the problem.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the tarball is big and you want the linker to compress the tarball
automatically, you can use the switch -reproduce-compressed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are having a link time failure and the problem does not reproduce everytime,
but in specific builds, it may be because of non determinism in the builds.
In that case use the option –reproduce-on-fail.</p>
</div>
<p>The reproduce-on-fail switch only creates a tarball when the link step fails.</p>
</div>
<div class="section" id="multiple-ways-to-invoke-eld-linker">
<h3><a class="toc-backref" href="#id30"><span class="section-number">17.1.14. </span>Multiple ways to invoke ELD linker</a><a class="headerlink" href="#multiple-ways-to-invoke-eld-linker" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>arm-link can be invoked since it is a symbolic link to ld.eld</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>cat<span class="w"> </span>bar.c
int<span class="w"> </span>main<span class="o">(){</span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="o">}</span>

clang<span class="w"> </span>-target<span class="w">  </span>armv7-none-eabi<span class="w">  </span>-g<span class="w">  </span>-c<span class="w"> </span>bar.c<span class="w">  </span>-o<span class="w"> </span>bar.o
arm-link<span class="w"> </span>-m<span class="w"> </span>armelf_linux_eabi<span class="w"> </span>-dynamic-linker<span class="w"> </span>/lib/ld-linux.so.3<span class="w"> </span>-o<span class="w"> </span>bar.elf<span class="w"> </span>--strip-debug<span class="w"> </span>bar.o
</pre></div>
</div>
<ul class="simple">
<li><p>Pass -fuse-ld=eld flag to clang driver, so that eld is used for linking</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang<span class="w"> </span>-target<span class="w"> </span>armv7-none-eabi<span class="w"> </span>-fuse-ld<span class="o">=</span>eld<span class="w"> </span>-fuse-baremetal-sysroot<span class="w"> </span>bar.c<span class="w"> </span>-o<span class="w"> </span>bar.elf<span class="w"> </span>-fno-use-baremetal-crt
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ELD linker flags can be passed to clang driver using -Wl prefix.
Example : clang …… -Wl,-shared -Wl,-gc-sections bar.o -o bar.elf</p>
</div>
<ul class="simple">
<li><p>Pass -v (verbose) when linking using clang binary, pick the link command line,
edit and execute it</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-target<span class="w"> </span>armv7-none-eabi<span class="w"> </span>-fuse-ld<span class="o">=</span>eld<span class="w"> </span>-fuse-baremetal-sysroot<span class="w"> </span>bar.o<span class="w"> </span>-o<span class="w"> </span>bar.elf<span class="w"> </span>-fno-use-baremetal-crt<span class="w"> </span>-v
clang<span class="w"> </span>version<span class="w"> </span><span class="m">16</span>.0.0
Snapdragon<span class="w"> </span>LLVM<span class="w"> </span>ARM<span class="w"> </span>Compiler<span class="w"> </span><span class="m">16</span>.0.0
Target:<span class="w"> </span>armv7-none-unknown-eabi
Thread<span class="w"> </span>model:<span class="w"> </span>posix
InstalledDir:<span class="w"> </span>/pkg/qct/software/llvm/release/arm/16.0.0/bin
<span class="w"> </span><span class="s2">&quot;/pkg/qct/software/llvm/release/arm/16.0.0/bin/ld.eld&quot;</span><span class="w"> </span>-EL<span class="w"> </span>-X<span class="w"> </span>--eh-frame-hdr<span class="w"> </span>-m<span class="w"> </span>armelf_linux_eabi<span class="w"> </span>-dynamic-linker<span class="w"> </span>/lib/ld-linux.so.3<span class="w"> </span>-o<span class="w"> </span>bar.elf<span class="w"> </span>bar.o<span class="w"> </span>-L/pkg/qct/software/llvm/release/arm/16.0.0/armv7-none-eabi/libc/lib<span class="w"> </span>-L/afs/localcell/cm/gv2.6/sysname/pkg.@sys/qct/software/llvm/release/arm/16.0.0/lib/clang/16.0.0/lib/baremetal<span class="w"> </span>--start-group<span class="w"> </span>-lc<span class="w"> </span>-lclang_rt.builtins-armv7<span class="w"> </span>--end-group<span class="w"> </span>-lc

$<span class="w"> </span>ld.eld<span class="w"> </span>-EL<span class="w"> </span>-X<span class="w"> </span>--eh-frame-hdr<span class="w"> </span>-m<span class="w"> </span>armelf_linux_eabi<span class="w"> </span>-dynamic-linker<span class="w"> </span>/lib/ld-linux.so.3<span class="w"> </span>-o<span class="w"> </span>bar.elf<span class="w"> </span>bar.o<span class="w"> </span>-L/pkg/qct/software/llvm/release/arm/16.0.0/armv7-none-eabi/libc/lib<span class="w"> </span>-L/afs/localcell/cm/gv2.6/sysname/pkg.@sys/qct/software/llvm/release/arm/16.0.0/lib/clang/16.0.0/lib/baremetal<span class="w"> </span>--start-group<span class="w"> </span>-lc<span class="w"> </span>-lclang_rt.builtins-armv7<span class="w"> </span>--end-group<span class="w"> </span>-lc<span class="w"> </span>--strip-debug
</pre></div>
</div>
</div>
<div class="section" id="ignore-multiple-definition-errors-and-continue-with-the-link">
<h3><a class="toc-backref" href="#id31"><span class="section-number">17.1.15. </span>Ignore multiple definition errors and continue with the link</a><a class="headerlink" href="#ignore-multiple-definition-errors-and-continue-with-the-link" title="Permalink to this heading"></a></h3>
<p>Sometimes a developer might want to ignore all multiple definition errors and
continue with the link.</p>
<p>This can be achived by using –allow-multiple-definition switch.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

<span class="c1">#compile</span>
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span><span class="m">2</span>.c
<span class="c1">#produces error</span>
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">2</span>.o
<span class="c1">#produces a successful link</span>
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span>--allow-multiple-definition
</pre></div>
</div>
</div>
<div class="section" id="multiple-ways-to-provide-entry-point-to-linker">
<h3><a class="toc-backref" href="#id32"><span class="section-number">17.1.16. </span>Multiple ways to provide entry point to linker</a><a class="headerlink" href="#multiple-ways-to-provide-entry-point-to-linker" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Using linker flag : -e &lt;value&gt;   –&gt; Name of entry point symbol</p></li>
<li><p>Specifying ENTRY(symbol) command in a linker script</p></li>
<li><p>Initialising the value of linker symbol “start”</p></li>
<li><p>Specifying the start address for the first input section in linker script
(eg: .text : AT(0))</p></li>
</ul>
</div>
<div class="section" id="how-to-obtain-a-non-executable-stack">
<h3><a class="toc-backref" href="#id33"><span class="section-number">17.1.17. </span>How to obtain a non-executable stack</a><a class="headerlink" href="#how-to-obtain-a-non-executable-stack" title="Permalink to this heading"></a></h3>
<p>Non-executable stack (NX) is a virtual memory protection mechanism to block
shell code injection from executing on the stack by restricting a particular
memory and implementing the NX bit.</p>
<p>ELD has the following equivalent option :</p>
<p><strong>-z noexecstack</strong> : Mark the executable as not requiring an executable stack</p>
</div>
<div class="section" id="what-is-the-difference-between-section-type-nobits-and-progbits">
<h3><a class="toc-backref" href="#id34"><span class="section-number">17.1.18. </span>What is the difference between section type NOBITS and PROGBITS</a><a class="headerlink" href="#what-is-the-difference-between-section-type-nobits-and-progbits" title="Permalink to this heading"></a></h3>
<p>NOBITS section do not occupy size on the disk.</p>
<p>PROGBITS section occupies space on disk.</p>
</div>
<div class="section" id="how-to-link-libraries-to-resolve-circular-dependencies">
<h3><a class="toc-backref" href="#id35"><span class="section-number">17.1.19. </span>How to link libraries to resolve circular dependencies</a><a class="headerlink" href="#how-to-link-libraries-to-resolve-circular-dependencies" title="Permalink to this heading"></a></h3>
<p>The order in which the libraries are loaded matter. Incorrect order leads to
“undefined reference” errors.</p>
<p>Keeping the libraries to linked within “–start-group” and “–end-group” linker
flags takes care of the circular dependencies, so that the user need not worry
about the order in which libs are loaded.</p>
<p>Circular Dependies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
extern<span class="w"> </span>int<span class="w"> </span>bar<span class="o">()</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>bar<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
extern<span class="w"> </span>int<span class="w"> </span>fred<span class="o">()</span><span class="p">;</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>fred<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">4</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
extern<span class="w"> </span>int<span class="w"> </span>baz<span class="o">()</span><span class="p">;</span>
int<span class="w"> </span>fred<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>baz<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span><span class="m">4</span>.c
<span class="c1"># lib2.a creates a dependency of fred in lib4.a in a different group</span>
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib2.a<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span><span class="m">3</span>.o
<span class="c1"># lib3.a creates a reverse-dependency to lib2.a which was previously visited</span>
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib3.a<span class="w"> </span><span class="m">4</span>.o
<span class="c1"># problem</span>
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>--start-group<span class="w"> </span>lib2.a<span class="w"> </span>--end-group<span class="w"> </span>--start-group<span class="w"> </span>lib3.a<span class="w"> </span>--end-group
<span class="c1"># solution 1</span>
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>--start-group<span class="w"> </span>lib2.a<span class="w"> </span>--end-group<span class="w"> </span>--start-group<span class="w"> </span>lib3.a<span class="w"> </span>lib2.a<span class="w"> </span>--end-group
<span class="c1"># solution 2</span>
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>--start-group<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span><span class="m">3</span>.o<span class="w"> </span>--end-group<span class="w"> </span>--start-group<span class="w"> </span>lib3.a<span class="w"> </span>--end-grou
</pre></div>
</div>
</div>
<div class="section" id="how-to-disable-use-of-standard-system-startup-files">
<h3><a class="toc-backref" href="#id36"><span class="section-number">17.1.20. </span>How to disable use of standard system startup files</a><a class="headerlink" href="#how-to-disable-use-of-standard-system-startup-files" title="Permalink to this heading"></a></h3>
<p>“-nostartfiles” : Does not use the standard system startup files when linking.</p>
<p>If this option is specified, user has to specify their own program entry point
and write their own start files</p>
</div>
<div class="section" id="how-to-disable-use-of-standard-system-libraries">
<h3><a class="toc-backref" href="#id37"><span class="section-number">17.1.21. </span>How to disable use of standard system libraries</a><a class="headerlink" href="#how-to-disable-use-of-standard-system-libraries" title="Permalink to this heading"></a></h3>
<p>“-nostdlib” : Disable default search path for libraries</p>
<p>This option will prevent the compiler from picking the standard libraries,
rtlibs provided by the toolchain. User has to come up with their own definitions
or libs so that there are no undefined reference errors reported.</p>
<p>The compiler rt libraries have to be specified explicitly if there are calls
to __aeabi* functions and are not defined by the users.</p>
</div>
<div class="section" id="how-to-remove-a-section-from-a-obj-file">
<h3><a class="toc-backref" href="#id38"><span class="section-number">17.1.22. </span>How to remove a section from a OBJ file</a><a class="headerlink" href="#how-to-remove-a-section-from-a-obj-file" title="Permalink to this heading"></a></h3>
<p>llvm-objcopy tool can be used to remove a section from an ELF file.</p>
</div>
<div class="section" id="how-to-extract-obj-files-from-an-archive">
<h3><a class="toc-backref" href="#id39"><span class="section-number">17.1.23. </span>How to extract OBJ files from an archive</a><a class="headerlink" href="#how-to-extract-obj-files-from-an-archive" title="Permalink to this heading"></a></h3>
<p>llvm-ar is the utility to extract obj files from the archive</p>
</div>
<div class="section" id="how-to-obtain-a-deterministic-output-from-linker">
<h3><a class="toc-backref" href="#id40"><span class="section-number">17.1.24. </span>How to obtain a deterministic output from linker</a><a class="headerlink" href="#how-to-obtain-a-deterministic-output-from-linker" title="Permalink to this heading"></a></h3>
<p>By default deterministic behaviour is supported. To get maximum throughput from
linker, –enable-threads=all linker option must be passed.</p>
</div>
<div class="section" id="how-to-obtain-memory-statistics-from-an-elf-file-or-obj-file">
<h3><a class="toc-backref" href="#id41"><span class="section-number">17.1.25. </span>How to obtain memory statistics from an ELF file or OBJ file</a><a class="headerlink" href="#how-to-obtain-memory-statistics-from-an-elf-file-or-obj-file" title="Permalink to this heading"></a></h3>
<p>llvm-size utility can provide details of size of .text, .data, .rodata, .bss, etc.</p>
</div>
<div class="section" id="how-to-compare-layout-of-two-output-images">
<h3><a class="toc-backref" href="#id42"><span class="section-number">17.1.26. </span>How to compare layout of two output images</a><a class="headerlink" href="#how-to-compare-layout-of-two-output-images" title="Permalink to this heading"></a></h3>
<p>Mapfile contains the layout of the image. You can compare the layout section of
mapfiles of the two output images which you are interested in.</p>
<p>By default, mapfiles layout section also contains virtual addresses associated
with the layout. This brings in too much unnecessary noise when comparing the two
layouts, because a small change in the layout can result in change of virtual
address of many sections. This can be fixed by using ‘-MapDetail only-layout’
option.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>//<span class="w"> </span>Run<span class="w"> </span>link<span class="w"> </span>commands<span class="w"> </span>with<span class="w"> </span><span class="s1">&#39;-MapDetail only-layout&#39;</span><span class="w"> </span>when<span class="w"> </span>generating<span class="w"> </span>the<span class="w"> </span>two<span class="w"> </span>output<span class="w"> </span>images.
vim<span class="w"> </span>-d<span class="w"> </span>image1.map<span class="w"> </span>image2.map<span class="w"> </span><span class="c1"># To compare the two output images layouts.</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-embed-a-binary-and-use-it-in-c-code">
<h3><a class="toc-backref" href="#id43"><span class="section-number">17.1.27. </span>How to embed a binary and use it in ‘C’ code</a><a class="headerlink" href="#how-to-embed-a-binary-and-use-it-in-c-code" title="Permalink to this heading"></a></h3>
<p>You can include a binary file and use it in ‘C’ code to reference the binary content.</p>
<p>Here is an example which builds a simple table and embeds that table in ‘C’ code.</p>
</div>
<div class="section" id="simple-python-code-to-create-a-binary-file">
<h3><a class="toc-backref" href="#id44"><span class="section-number">17.1.28. </span>Simple python code to create a binary file</a><a class="headerlink" href="#simple-python-code-to-create-a-binary-file" title="Permalink to this heading"></a></h3>
<p>The below python code when run creates a binary file by name table.bin</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;table.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;w+b&#39;</span><span class="p">)</span>
<span class="n">byte_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">binary_format</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">byte_arr</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">binary_format</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-simple-assembly-file-to-include-this-binary-file">
<h3><a class="toc-backref" href="#id45"><span class="section-number">17.1.29. </span>Create a simple assembly file to include this binary file</a><a class="headerlink" href="#create-a-simple-assembly-file-to-include-this-binary-file" title="Permalink to this heading"></a></h3>
<p>This snippet of assembly creates a section named table and includes</p>
</div>
<div class="section" id="include-this-assembly-file-to-build-a-static-executable">
<h3><a class="toc-backref" href="#id46"><span class="section-number">17.1.30. </span>Include this assembly file to build a static executable</a><a class="headerlink" href="#include-this-assembly-file-to-build-a-static-executable" title="Permalink to this heading"></a></h3>
<p>The program snippet below prints the contents of the binary file to stdout.</p>
<p>Linker defines a variable __start_&lt;section&gt; and __stop_&lt;section&gt; if the linker
is going to create an output section that matches a ‘C’ identifier.</p>
<p>Using the snippet above, and a simple assembly file, you will be able to iterate
over the binary file in ‘C’ code</p>
</div>
<div class="section" id="where-should-note-gnu-property-section-map-to-in-elf">
<h3><a class="toc-backref" href="#id47"><span class="section-number">17.1.31. </span>Where should .note.gnu.property section map to in elf</a><a class="headerlink" href="#where-should-note-gnu-property-section-map-to-in-elf" title="Permalink to this heading"></a></h3>
<p>The .note.gnu.property section is mapped to PT_NOTE segment by default which
should have only read permission.</p>
</div>
<div class="section" id="how-to-garbage-collect-symbols-in-a-shared-library">
<h3><a class="toc-backref" href="#id48"><span class="section-number">17.1.32. </span>How to garbage-collect symbols in a shared library?</a><a class="headerlink" href="#how-to-garbage-collect-symbols-in-a-shared-library" title="Permalink to this heading"></a></h3>
<p>One way to garbage-collect symbols in a shared library is to mark the symbols as
hidden. Hidden symbols are garbage collected from a shared library if they are
not used from any of the entry symbols in the shared library (entry symbols are
symbols that are marked with visibility default).</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">// can not be garbage-collected</span>
<span class="s">int foo() {</span>
<span class="s">  return 1;</span>
<span class="s">}</span>

<span class="s">// can be garbage-collected</span>
<span class="s">__attribute__((visibility(&quot;hidden&quot;)))</span>
<span class="s">int bar() {</span>
<span class="s">  return 2;</span>
<span class="s">}</span>

<span class="s">int baz() {</span>
<span class="s">  return 0;</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c<span class="w"> </span>-fPIC<span class="w"> </span>-ffunction-sections
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.elf<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>--gc-sections<span class="w"> </span>--print-gc-sections<span class="w"> </span>-e<span class="w"> </span>baz
</pre></div>
</div>
<p>Running the above script gives the below output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fPIC
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-shared<span class="w"> </span>--gc-sections<span class="w"> </span>--print-gc-sections<span class="w"> </span>-e<span class="w"> </span>baz
Trace:<span class="w"> </span>GC<span class="w"> </span>:<span class="w"> </span><span class="m">1</span>.o<span class="o">[</span>.text<span class="o">]</span>
Trace:<span class="w"> </span>GC<span class="w"> </span>:<span class="w"> </span><span class="m">1</span>.o<span class="o">[</span>.text.foo<span class="o">]</span>
</pre></div>
</div>
<p>We can see that ‘foo’, a hidden symbol, got garbage-collected during the link
process as it was not reachable from the entry point (baz).</p>
</div>
<div class="section" id="how-are-zero-sized-sections-handled">
<h3><a class="toc-backref" href="#id49"><span class="section-number">17.1.33. </span>How are zero-sized sections handled?</a><a class="headerlink" href="#how-are-zero-sized-sections-handled" title="Permalink to this heading"></a></h3>
<p>How are zero-sized sections handled?</p>
<ul class="simple">
<li><p>A relocation refers to the zero sized section</p></li>
<li><p>A symbol is present in the zero sized section</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Releases</p>
<dl class="simple">
<dt>This change is observed on the below toolchain / patch releases on Hexagon :-</dt><dd><ul class="simple">
<li><p>Hexagon 8.7.04</p></li>
</ul>
</dd>
</dl>
<p>Releases that will be published after summer of 2023, will also have this support.</p>
</div>
<div class="section" id="relocation-referring-to-a-zero-sized-section">
<h4><a class="toc-backref" href="#id50"><span class="section-number">17.1.33.1. </span>Relocation referring to a zero sized section</a><a class="headerlink" href="#relocation-referring-to-a-zero-sized-section" title="Permalink to this heading"></a></h4>
<p>In the below example, the section .text.baz has size zero and is a relocation
target for .text.c1, hence .text.baz is useful and is made a part of the layout.</p>
<p>Example:</p>
<p>The example illustrates a reference to the section .text.baz references by the
section .text.c1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>x.s<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">.section .text.foo</span>
<span class="s">.global foo</span>
<span class="s">.set foo, bar</span>
<span class="s">.section .text.bar</span>
<span class="s">bar:</span>
<span class="s">.word 100</span>
<span class="s">.section .text.baz</span>
<span class="s">.section .text.c1</span>
<span class="s">.word .text.baz</span>
<span class="s">.section .text.empty</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">int main() { return foo(); }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">SECTIONS {</span>
<span class="s"> . = 0x10000;</span>
<span class="s"> .foo : {</span>
<span class="s">  *(.text.*)</span>
<span class="s">  *(.text)</span>
<span class="s"> }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Compile and Link step</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w"> </span>x.s<span class="w">  </span>main.c
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>x.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p>Image layout</p>
<p>The image layout is adjusted to keep <strong>.text.baz</strong> in the output, as there is
a relocation that is referred from the section .text.c1</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output Section and Layout</span>
.<span class="o">(</span>0x10000<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10000<span class="p">;</span><span class="w"> </span><span class="c1"># . = 0x10000; script.t</span>

.foo<span class="w">    </span>0x10000<span class="w"> </span>0x24<span class="w"> </span><span class="c1"># Offset: 0x1000, LMA: 0x10000, Alignment: 0x10, Flags: SHF_ALLOC|SHF_EXECINSTR, Type: SHT_PROGBITS</span>
*<span class="o">(</span>.text.*<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 1, script.t [9:0]</span>
.text.foo<span class="w">       </span>0x10000<span class="w"> </span>0x0<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
.text.bar<span class="w">       </span>0x10000<span class="w"> </span>0x4<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
<span class="w">        </span>0x10000<span class="w">         </span>bar
<span class="w">        </span>0x10000<span class="w">         </span>foo
.text.baz<span class="w">       </span>0x10004<span class="w"> </span>0x0<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
.text.c1<span class="w">        </span>0x10004<span class="w"> </span>0x4<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
*<span class="o">(</span>.text<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 2, script.t [2:0]</span>
PADDING_ALIGNMENT<span class="w">       </span>0x10008<span class="w"> </span>0x8<span class="w">     </span>0x0
.text<span class="w">   </span>0x10010<span class="w"> </span>0x14<span class="w">    </span>main.o<span class="w">  </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,16</span>
<span class="w">        </span>0x10010<span class="w">         </span>main
*<span class="o">(</span>.foo<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 3, Internal-LinkerScript (Implicit rule inserted by Linker) [0:0]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-section-has-associated-symbols">
<h4><a class="toc-backref" href="#id51"><span class="section-number">17.1.33.2. </span>The section has associated symbols</a><a class="headerlink" href="#the-section-has-associated-symbols" title="Permalink to this heading"></a></h4>
<p>Sections containing symbols are preserved in the layout. Such sections are not
considered to be empty sections.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Such cases should be avoided at all times due to the following reasons</p>
<blockquote>
<div><ul class="simple">
<li><p>The code is very sensitive to layout for it to work properly.</p></li>
<li><p>When link time garbage collection is enabled, this may end up garbage
collecting sections which would rather be needed at runtime.</p></li>
</ul>
</div></blockquote>
</div>
<p>Example:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In the below example</p>
<ul>
<li><p>The code is very sensitive to layout for it to work properly because the
program relies on .text.foo and .text.bar to be placed together</p></li>
<li><p>When link time garbage collection is enabled, this may end up garbage
collecting sections which would rather be needed at runtime</p>
<blockquote>
<div><ul class="simple">
<li><p>In the example below the linker may end up garbage collecting .text.bar</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>x.s<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
.section<span class="w"> </span>.text.foo
.type<span class="w"> </span>foo,<span class="w"> </span>@function
.global<span class="w"> </span>foo
foo:
.section<span class="w"> </span>.text.bar
.type<span class="w"> </span>bar,<span class="w"> </span>@function
.global<span class="w"> </span>bar
bar:
nop
!

cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>main<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>foo<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10000<span class="p">;</span>
<span class="w"> </span>.text:<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>*<span class="o">(</span>.text.*<span class="o">)</span>
<span class="w">  </span>*<span class="o">(</span>.text<span class="o">)</span>
<span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!
</pre></div>
</div>
<p>Compile and link step</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w"> </span>x.s<span class="w">  </span>main.c
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>x.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p>Image Layout</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output Section and Layout</span>
.<span class="o">(</span>0x10000<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10000<span class="p">;</span><span class="w"> </span><span class="c1"># . = 0x10000; script.t</span>

.text<span class="w">   </span>0x10000<span class="w"> </span>0x24<span class="w"> </span><span class="c1"># Offset: 0x1000, LMA: 0x10000, Alignment: 0x10, Flags: SHF_ALLOC|SHF_EXECINSTR, Type: SHT_PROGBITS</span>
*<span class="o">(</span>.text.*<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 1, script.t [6:0]</span>
.text.foo<span class="w">       </span>0x10000<span class="w"> </span>0x0<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
<span class="w">        </span>0x10000<span class="w">         </span>foo
.text.bar<span class="w">       </span>0x10000<span class="w"> </span>0x4<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
<span class="w">        </span>0x10000<span class="w">         </span>bar
*<span class="o">(</span>.text<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 2, script.t [2:0]</span>
PADDING_ALIGNMENT<span class="w">       </span>0x10004<span class="w"> </span>0xc<span class="w">     </span>0x0
.text<span class="w">   </span>0x10010<span class="w"> </span>0x14<span class="w">    </span>main.o<span class="w">  </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,16</span>
<span class="w">        </span>0x10010<span class="w">         </span>main
*<span class="o">(</span>.text<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 3, Internal-LinkerScript (Implicit rule inserted by Linker) [0:0]</span>
</pre></div>
</div>
</div>
<div class="section" id="can-a-zero-sized-section-ever-affect-the-layout-yes-it-can">
<h4><a class="toc-backref" href="#id52"><span class="section-number">17.1.33.3. </span>Can a zero-sized section ever affect the layout?  - Yes it can</a><a class="headerlink" href="#can-a-zero-sized-section-ever-affect-the-layout-yes-it-can" title="Permalink to this heading"></a></h4>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>x.s<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">.section .text.foo</span>
<span class="s">.global foo</span>
<span class="s">.set foo, bar</span>
<span class="s">.section .text.bar</span>
<span class="s">bar:</span>
<span class="s">.word 100</span>
<span class="s">.section .text.baz</span>
<span class="s">.p2align 4</span>
<span class="s">.section .text.baz1</span>
<span class="s">.section .text.baz2</span>
<span class="s">.section .text.c1</span>
<span class="s">.word .text.baz</span>
<span class="s">.section .text.empty</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">int main() { return foo(); }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">    . = 0x10003;</span>
<span class="s">    .baz :  {</span>
<span class="s">        . = 0x10005;</span>
<span class="s">        *(.text.baz1)</span>
<span class="s">        . = . + 16;</span>
<span class="s">        *(.text.baz)</span>
<span class="s">        . = . + 28;</span>
<span class="s">        *(.text.baz2)</span>
<span class="s">        . = . + 40;</span>
<span class="s">    }</span>
<span class="s">    .foo : {</span>
<span class="s">        *(.text.foo)</span>
<span class="s">        *(.text*)</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Compile and Link Step:</p>
<p>Image Layout</p>
<p><strong>Image Layout from xmap:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output Section and Layout</span>
.<span class="o">(</span>0x10003<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10003<span class="p">;</span><span class="w"> </span><span class="c1"># . = 0x10003; script.t</span>

.baz<span class="w">    </span>0x10010<span class="w"> </span>0x54<span class="w"> </span><span class="c1"># Offset: 0x1010, LMA: 0x10010, Alignment: 0x10, Flags: SHF_ALLOC|SHF_EXECINSTR, Type: SHT_PROGBITS</span>
<span class="w">        </span>.<span class="o">(</span>0x10005<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10005<span class="p">;</span><span class="w"> </span><span class="c1"># . = 0x10005; script.t</span>
*<span class="o">(</span>.text.baz1<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 1, script.t [1:0]</span>
<span class="w">        </span>.<span class="o">(</span>0x100010015<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="o">(</span>0x100010005<span class="o">)</span><span class="w"> </span>+<span class="w"> </span>0x10<span class="p">;</span><span class="w"> </span><span class="c1"># . = . + 0x10; script.t</span>
*<span class="o">(</span>.text.baz<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 2, script.t [1:0]</span>
PADDING_ALIGNMENT<span class="w">       </span>0x10015<span class="w"> </span>0xb<span class="w">     </span>0x0
.text.baz<span class="w">       </span>0x10020<span class="w"> </span>0x0<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,16</span>
<span class="w">        </span>.<span class="o">(</span>0x1003c<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="o">(</span>0x10020<span class="o">)</span><span class="w"> </span>+<span class="w"> </span>0x1c<span class="p">;</span><span class="w"> </span><span class="c1"># . = . + 0x1c; script.t</span>
*<span class="o">(</span>.text.baz2<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 3, script.t [1:0]</span>
PADDING<span class="w"> </span>0x100010005<span class="w">     </span>0x10<span class="w">    </span>0x0
PADDING<span class="w"> </span>0x1003c<span class="w"> </span>0x28<span class="w">    </span>0x0
<span class="w">        </span>.<span class="o">(</span>0x10064<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="o">(</span>0x1003c<span class="o">)</span><span class="w"> </span>+<span class="w"> </span>0x28<span class="p">;</span><span class="w"> </span><span class="c1"># . = . + 0x28; script.t</span>
*<span class="o">(</span>.baz<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 4, Internal-LinkerScript (Implicit rule inserted by Linker) [0:0]</span>

.foo<span class="w">    </span>0x10070<span class="w"> </span>0x1c<span class="w"> </span><span class="c1"># Offset: 0x1070, LMA: 0x10070, Alignment: 0x10, Flags: SHF_ALLOC|SHF_EXECINSTR, Type: SHT_PROGBITS</span>
*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 5, script.t [1:0]</span>
.text.foo<span class="w">       </span>0x10070<span class="w"> </span>0x0<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
*<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="c1">#Rule 6, script.t [9:0]</span>
.text<span class="w">   </span>0x10070<span class="w"> </span>0x14<span class="w">    </span>main.o<span class="w">  </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,16</span>
<span class="w">        </span>0x10070<span class="w">         </span>main
.text.bar<span class="w">       </span>0x10084<span class="w"> </span>0x4<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
<span class="w">        </span>0x10084<span class="w">         </span>bar
<span class="w">        </span>0x10084<span class="w">         </span>foo
.text.c1<span class="w">        </span>0x10088<span class="w"> </span>0x4<span class="w">     </span>x.o<span class="w">     </span><span class="c1">#SHT_PROGBITS,SHF_ALLOC|SHF_EXECINSTR,1</span>
</pre></div>
</div>
<p><em>Here because of p2align directive for .text.baz the PADDING_ALIGNMENT of size 0xb
at address 0x100015 was added</em></p>
</div>
<div class="section" id="debugging-zero-sized-sections-related-issues">
<h4><a class="toc-backref" href="#id53"><span class="section-number">17.1.33.4. </span>Debugging zero-sized sections related issues</a><a class="headerlink" href="#debugging-zero-sized-sections-related-issues" title="Permalink to this heading"></a></h4>
<p>ELD has 2 ways that help in debugging issues wrt to zero-sized sections</p>
<ul>
<li><p>Linker Diagnostics as warnings tied to option -Wall &amp; -Wzero-sized-sections
* Please look for traces containing “Warning: Zero sized fragment” for</p>
<blockquote>
<div><p>zero-sized section-related warnings</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>x.s<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">.section .text.baz</span>
<span class="s">.type baz, %function</span>
<span class="s">.global baz</span>
<span class="s">baz:</span>
<span class="s">.section .text.bar</span>
<span class="s">.type bar, %function</span>
<span class="s">.global bar</span>
<span class="s">bar:</span>
<span class="s">nop</span>
<span class="s">.section .foo,&quot;a&quot;,%progbits</span>
<span class="s">.local sym</span>
<span class="s">sym:</span>
<span class="s">.size sym, 40</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">int main() { return baz(); }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span><span class="s">&lt;&lt; \EOF</span>
<span class="s">SECTIONS {</span>
<span class="s"> . = 0x10000;</span>
<span class="s"> .text: {</span>
<span class="s">  *(.text.*)</span>
<span class="s">  *(.text)</span>
<span class="s"> }</span>
<span class="s">}</span>
<span class="s">EOF</span>

$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w"> </span>x.s<span class="w">  </span>main.c
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>x.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
Warning:<span class="w"> </span>Zero<span class="w"> </span>sized<span class="w"> </span>fragment<span class="w"> </span>.foo<span class="w"> </span><span class="k">for</span><span class="w"> </span>non<span class="w"> </span>zero<span class="w"> </span>sized<span class="w"> </span>symbol<span class="w"> </span>sym<span class="w"> </span>from<span class="w"> </span>input<span class="w"> </span>file<span class="w"> </span>x.o
</pre></div>
</div>
</li>
<li><p>Linker stats emitted in the map file as
* ZeroSizedSections
* ZeroSizedSectionsGarbageCollected</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>x.s<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
.section<span class="w"> </span>.text.foo
.global<span class="w"> </span>foo
.set<span class="w"> </span>foo,<span class="w"> </span>bar
.section<span class="w"> </span>.text.bar
bar:
.word<span class="w"> </span><span class="m">100</span>
.section<span class="w"> </span>.text.baz
.section<span class="w"> </span>.text.c1
.word<span class="w"> </span>.text.baz
.section<span class="w"> </span>.text.empty
<span class="w"> </span>!

cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>main<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>foo<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10000<span class="p">;</span>
<span class="w"> </span>.text:<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>*<span class="o">(</span>.text.*<span class="o">)</span>
<span class="w">  </span>*<span class="o">(</span>.text<span class="o">)</span>
<span class="o">}</span>
<span class="o">}</span>
!

$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w"> </span>x.s<span class="w">  </span>main.c
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>x.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
$<span class="w"> </span>cat<span class="w"> </span>x
...
<span class="c1"># LinkStats Begin</span>
<span class="c1"># ObjectFiles : 2</span>
<span class="c1"># LinkerScripts : 2</span>
<span class="c1"># ThreadCount : 64</span>
<span class="c1"># NumInputSections : 29</span>
<span class="c1"># ZeroSizedSections : 17</span>
<span class="c1"># SectionsGarbageCollected : 5</span>
<span class="c1"># ZeroSizedSectionsGarbageCollected : 4</span>
<span class="c1"># NumLinkerScriptRules : 2</span>
<span class="c1"># NumOutputSections : 6</span>
<span class="c1"># NumOrphans : 5</span>
<span class="c1"># NoRuleMatches : 2</span>
<span class="c1"># LinkStats End</span>
...
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-interpret-the-new-trampoline-naming-convention">
<h3><a class="toc-backref" href="#id54"><span class="section-number">17.1.34. </span>How to interpret the new trampoline naming convention?</a><a class="headerlink" href="#how-to-interpret-the-new-trampoline-naming-convention" title="Permalink to this heading"></a></h3>
<p>The Linker trampoline naming convention has been updated to the following format</p>
<p>trampoline_for_&lt;target symbol name&gt;_from_&lt;source input section name&gt;_&lt;Input file
ordinality of the source input section&gt;#&lt;Optional: relocation addend&gt;_&lt;Optional:
Additional trampoline count&gt;</p>
<p>The trampoline naming convention can be broadly classified into 4 cases:</p>
<div class="section" id="case-1">
<h4><a class="toc-backref" href="#id55"><span class="section-number">17.1.34.1. </span>Case 1:</a><a class="headerlink" href="#case-1" title="Permalink to this heading"></a></h4>
<p><strong>Format:</strong> trampoline_for_&lt;target symbol name&gt;_from_&lt;source input section name&gt;
_&lt;Input file ordinality of the source input section&gt;</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
int<span class="w"> </span>main<span class="w"> </span><span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="p">;</span>
<span class="o">}</span>
!
cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS
<span class="o">{</span>
<span class="w">  </span>.text<span class="w">           </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.main<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span><span class="o">=</span>0x00c0007f
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x08000000<span class="p">;</span>
<span class="w">  </span>.text.baz<span class="w"> </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.baz<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!
</pre></div>
</div>
<p>Compile and Link Steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w">  </span>main.c<span class="w"> </span>-ffunction-sections
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p>Symbols from readelf:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-s<span class="w"> </span>a.out
Symbol<span class="w"> </span>table<span class="w"> </span><span class="s1">&#39;.symtab&#39;</span><span class="w"> </span>contains<span class="w"> </span><span class="m">9</span><span class="w"> </span>entries:
<span class="w">   </span>Num:<span class="w">    </span>Value<span class="w">  </span>Size<span class="w"> </span>Type<span class="w">    </span>Bind<span class="w">   </span>Vis<span class="w">       </span>Ndx<span class="w"> </span>Name
<span class="w">     </span><span class="m">0</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>UND
<span class="w">     </span><span class="m">1</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>.text
<span class="w">     </span><span class="m">2</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">3</span><span class="w"> </span>.comment
<span class="w">     </span><span class="m">3</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>.text.baz
<span class="w">     </span><span class="m">4</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>FILE<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>main.c
<span class="w">     </span><span class="m">5</span>:<span class="w"> </span><span class="m">00000014</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>trampoline_for_baz_from_.text.main_25
<span class="w">     </span><span class="m">6</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">    </span><span class="m">20</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>main
<span class="w">     </span><span class="m">7</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">    </span><span class="m">12</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>baz
<span class="w">     </span><span class="m">8</span>:<span class="w"> </span><span class="m">08000011</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>__end
</pre></div>
</div>
<p><strong>Trampoline Symbol:</strong> <a href="#id184"><span class="problematic" id="id185">trampoline_for_baz_from_</span></a>.text.main_25 → call baz from main</p>
<p>This is the most vanilla case where the target symbol name, source input section
and input file are used to coin the trampoline name.</p>
</div>
<div class="section" id="case2">
<h4><a class="toc-backref" href="#id56"><span class="section-number">17.1.34.2. </span>Case2:</a><a class="headerlink" href="#case2" title="Permalink to this heading"></a></h4>
<p><strong>Format:</strong> trampoline_for_&lt;target symbol name&gt;_from_&lt;source input section name&gt;_
&lt;Input file ordinality of the source input section&gt;_&lt;Additional trampoline count&gt;</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>far<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
int<span class="w"> </span>callfar<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span>far<span class="o">()</span><span class="w"> </span>+<span class="w"> </span>far<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>
int<span class="w"> </span>main<span class="w"> </span><span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span>callfar<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>noreuse<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
<span class="o">{</span>
<span class="w">    </span>far<span class="p">;</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS
<span class="o">{</span>
<span class="w">  </span>.text<span class="w">           </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.main<span class="o">)</span>
<span class="w">    </span>*<span class="o">(</span>.text.callfar<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span><span class="o">=</span>0x00c0007f
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x08000000<span class="p">;</span>
<span class="w">  </span>.text.far<span class="w"> </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.far<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!
</pre></div>
</div>
<p><strong>Compile and Link Steps:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w">  </span>main.c<span class="w"> </span>-ffunction-sections
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x<span class="w"> </span>-no-reuse-trampolines-file<span class="o">=</span>noreuse
</pre></div>
</div>
<p><strong>Symbols from readelf:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-s<span class="w"> </span>a.out
Symbol<span class="w"> </span>table<span class="w"> </span><span class="s1">&#39;.symtab&#39;</span><span class="w"> </span>contains<span class="w"> </span><span class="m">11</span><span class="w"> </span>entries:
<span class="w">   </span>Num:<span class="w">    </span>Value<span class="w">  </span>Size<span class="w"> </span>Type<span class="w">    </span>Bind<span class="w">   </span>Vis<span class="w">       </span>Ndx<span class="w"> </span>Name
<span class="w">     </span><span class="m">0</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>UND
<span class="w">     </span><span class="m">1</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>.text
<span class="w">     </span><span class="m">2</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">3</span><span class="w"> </span>.comment
<span class="w">     </span><span class="m">3</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>.text.far
<span class="w">     </span><span class="m">4</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>FILE<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>main.c
<span class="w">     </span><span class="m">5</span>:<span class="w"> </span><span class="m">00000040</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>trampoline_for_far_from_.text.callfar_25
<span class="w">     </span><span class="m">6</span>:<span class="w"> </span><span class="m">00000048</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>trampoline_for_far_from_.text.callfar_25_1
<span class="w">     </span><span class="m">7</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">    </span><span class="m">20</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>main
<span class="w">     </span><span class="m">8</span>:<span class="w"> </span><span class="m">00000020</span><span class="w">    </span><span class="m">32</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>callfar1
<span class="w">     </span><span class="m">9</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">    </span><span class="m">12</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>far
<span class="w">    </span><span class="m">10</span>:<span class="w"> </span><span class="m">08000011</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>__end
</pre></div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>Trampoline Symbol:<a href="#id3"><span class="problematic" id="id4">**</span></a><a href="#id186"><span class="problematic" id="id187">trampoline_for_far_from_</span></a>.text.callfar1_25_1 → call far from callfar1</p>
<p>The additional trampoline count is added as a suffix in cases where the reuse of
the existing trampoline is not possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The reuse was not possible because of -no-reuse-trampolines-file=noreuse</p>
</div>
</div>
<div class="section" id="case3">
<h4><a class="toc-backref" href="#id57"><span class="section-number">17.1.34.3. </span>Case3:</a><a class="headerlink" href="#case3" title="Permalink to this heading"></a></h4>
<p><strong>Format:</strong> trampoline_for_&lt;target symbol name&gt;_from_&lt;source input section name&gt;_#(relocation addend)</p>
<p><strong>Example:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
static<span class="w"> </span>int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
int<span class="w"> </span>main<span class="w"> </span><span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span>baz<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS
<span class="o">{</span>
<span class="w">  </span>.text<span class="w">           </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.main<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span><span class="o">=</span>0x00c0007f
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x08000000<span class="p">;</span>
<span class="w">  </span>.text.baz<span class="w"> </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.baz<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!
</pre></div>
</div>
<p><strong>Compile and Link Steps:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w">  </span>main.c<span class="w"> </span>-ffunction-sections
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p><strong>Symbols from readelf:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-s<span class="w"> </span>a.out
Symbol<span class="w"> </span>table<span class="w"> </span><span class="s1">&#39;.symtab&#39;</span><span class="w"> </span>contains<span class="w"> </span><span class="m">9</span><span class="w"> </span>entries:
<span class="w">   </span>Num:<span class="w">    </span>Value<span class="w">  </span>Size<span class="w"> </span>Type<span class="w">    </span>Bind<span class="w">   </span>Vis<span class="w">       </span>Ndx<span class="w"> </span>Name
<span class="w">     </span><span class="m">0</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>UND
<span class="w">     </span><span class="m">1</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>.text
<span class="w">     </span><span class="m">2</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">3</span><span class="w"> </span>.comment
<span class="w">     </span><span class="m">3</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>.text.baz
<span class="w">     </span><span class="m">4</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>FILE<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>main.c
<span class="w">     </span><span class="m">5</span>:<span class="w"> </span><span class="m">00000014</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>trampoline_for_.text.baz_from_.text.main_25#<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="w">     </span><span class="m">6</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">    </span><span class="m">12</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>baz
<span class="w">     </span><span class="m">7</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">    </span><span class="m">20</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>main
<span class="w">     </span><span class="m">8</span>:<span class="w"> </span><span class="m">08000011</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>__end
</pre></div>
</div>
<p><strong>Trampoline Symbol:</strong> <a href="#id188"><span class="problematic" id="id189">trampoline_for_</span></a>.text.bar_from_.text.main_25#(0) →
call to bar from main here #(0) → represents the relocation addend</p>
<p>The relocation addend 0 is added to the trampoline symbol name in case the
trampoline jumps to the section symbol for the symbol</p>
</div>
<div class="section" id="case4">
<h4><a class="toc-backref" href="#id58"><span class="section-number">17.1.34.4. </span>Case4:</a><a class="headerlink" href="#case4" title="Permalink to this heading"></a></h4>
<p><strong>Format:</strong> trampoline_for_&lt;target symbol name&gt;_from_&lt;source input section name&gt;
_&lt;Input file ordinality of the source input section&gt;#&lt;relocation addend&gt;
_&lt;Additional trampoline count&gt;</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>main.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
static<span class="w"> </span>int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
int<span class="w"> </span>main<span class="w"> </span><span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span>baz<span class="o">()</span><span class="w"> </span>+<span class="w"> </span>baz<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>noreuse<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
<span class="o">{</span>
<span class="w">    </span>baz<span class="p">;</span>
<span class="w">    </span>.text.baz<span class="p">;</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS
<span class="o">{</span>
<span class="w">  </span>.text<span class="w">           </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.main<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span><span class="o">=</span>0x00c0007f
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x08000000<span class="p">;</span>
<span class="w">  </span>.text.baz<span class="w"> </span>:
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.baz<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!
</pre></div>
</div>
<p><strong>Compile and Link Steps:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang<span class="w"> </span>-c<span class="w">  </span>main.c<span class="w"> </span>-ffunction-sections
$<span class="w"> </span>ld.eld<span class="w"> </span>main.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x<span class="w"> </span>-no-reuse-trampolines-file<span class="o">=</span>noreuse
</pre></div>
</div>
<p><strong>Symbols from readelf:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-s<span class="w"> </span>a.out
Symbol<span class="w"> </span>table<span class="w"> </span><span class="s1">&#39;.symtab&#39;</span><span class="w"> </span>contains<span class="w"> </span><span class="m">10</span><span class="w"> </span>entries:
<span class="w">   </span>Num:<span class="w">    </span>Value<span class="w">  </span>Size<span class="w"> </span>Type<span class="w">    </span>Bind<span class="w">   </span>Vis<span class="w">       </span>Ndx<span class="w"> </span>Name
<span class="w">     </span><span class="m">0</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>UND
<span class="w">     </span><span class="m">1</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>.text
<span class="w">     </span><span class="m">2</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">3</span><span class="w"> </span>.comment
<span class="w">     </span><span class="m">3</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>.text.baz
<span class="w">     </span><span class="m">4</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>FILE<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>main.c
<span class="w">     </span><span class="m">5</span>:<span class="w"> </span><span class="m">00000028</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>trampoline_for_.text.baz_from_.text.main_25#<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="w">     </span><span class="m">6</span>:<span class="w"> </span><span class="m">00000030</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>trampoline_for_.text.baz_from_.text.main_25#<span class="o">(</span><span class="m">0</span><span class="o">)</span>_1
<span class="w">     </span><span class="m">7</span>:<span class="w"> </span><span class="m">08000000</span><span class="w">    </span><span class="m">12</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>baz
<span class="w">     </span><span class="m">8</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">    </span><span class="m">40</span><span class="w"> </span>FUNC<span class="w">    </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>main
<span class="w">     </span><span class="m">9</span>:<span class="w"> </span><span class="m">08000011</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>__end
</pre></div>
</div>
<p><strong>Trampoline Symbol:</strong> <a href="#id190"><span class="problematic" id="id191">trampoline_for_</span></a>.text.bar_from_.text.main_25#(0)_1 → 2nd call for bar from main</p>
<p>The duplicate trampoline count was added as a prefix since the symbol name
.text.bar was added to the noreuse list.</p>
<p><strong>Benefits of the new trampoline naming convention:</strong></p>
<p>The new format has benefits as follows</p>
<ul class="simple">
<li><p>Helps determine/infer a huge amount of info about the target symbol and the
source sections inherently</p></li>
<li><p>Helps make diff between map files easier since the naming convention is now
more context-based</p></li>
</ul>
</div>
</div>
<div class="section" id="understanding-loadable-segments-are-unsorted-by-virtual-address-warning-from-llvm-readelf">
<h3><a class="toc-backref" href="#id59"><span class="section-number">17.1.35. </span>Understanding “loadable segments are unsorted by virtual address” warning from llvm-readelf</a><a class="headerlink" href="#understanding-loadable-segments-are-unsorted-by-virtual-address-warning-from-llvm-readelf" title="Permalink to this heading"></a></h3>
<p>The llvm-readelf can sometimes emit a warning: “loadable segments are unsorted
by virtual address”. This occurs in very specific scenarios where below items
are involved</p>
<ul class="simple">
<li><p>Dynamic sections</p></li>
<li><p>“-shared” in linker commandline</p></li>
<li><p>The virtual addresses of dynamic sections not in increasing order</p></li>
</ul>
<p>Below is a small example to illustrate this:</p>
<p><strong>Example:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">    </span>B<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">    </span>DYN<span class="w"> </span>PT_DYNAMIC<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">      </span>.dynsym<span class="w"> </span><span class="o">(</span>0x900<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.dynsym<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">      </span>.dynamic<span class="w"> </span><span class="o">(</span>0x800<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.dynamic<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B<span class="w"> </span>:DYN
<span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-shared
llvm-readelf<span class="w"> </span>-S<span class="w"> </span>-W<span class="w"> </span>a.out
</pre></div>
</div>
<p>Important thing to note in above script is the non-increasing order of virtual
addresses of the dynamic sections</p>
<p>When the <em>“llvm-readelf”</em> in above script runs, a specific code branch for
dynamic images in ELF.cpp emits this warning</p>
<p><strong>Output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>llvm-readelf:<span class="w"> </span>warning:<span class="w"> </span><span class="s1">&#39;a.out&#39;</span>:<span class="w"> </span>loadable<span class="w"> </span>segments<span class="w"> </span>are<span class="w"> </span>unsorted<span class="w"> </span>by<span class="w"> </span>virtual<span class="w"> </span>address
</pre></div>
</div>
<p>This warning in its current form is rather vague and very general as it doesn’t
inform the user about the specific dynamic builds this warning is meant for.</p>
<p>Currently, there is <strong>no</strong> option available to suppress this warning.</p>
</div>
<div class="section" id="linker-overlap-checks">
<h3><a class="toc-backref" href="#id60"><span class="section-number">17.1.36. </span>Linker overlap checks</a><a class="headerlink" href="#linker-overlap-checks" title="Permalink to this heading"></a></h3>
<p>Linker has been improved to detect overlaps in the image layout. Linker does this by default.
The following overlaps are detected by the linker.
* Virtual address overlaps
* Physical address overlaps
* File offset overlaps</p>
<p>If the overlaps are known and you want to turn this behavior OFF, you can use
<em>–no-check-sections</em> flag.</p>
</div>
</div>
<div class="section" id="input-file-to-linker">
<h2><a class="toc-backref" href="#id61"><span class="section-number">17.2. </span>Input File to Linker</a><a class="headerlink" href="#input-file-to-linker" title="Permalink to this heading"></a></h2>
<p>The linker takes the following kinds of input files as input :-</p>
<ul class="simple">
<li><p>Object files</p></li>
<li><p>Shared libraries</p></li>
<li><p>Linker scripts</p></li>
<li><p>Multiple command line options</p></li>
<li><dl class="simple">
<dt>Other kinds of input files such as</dt><dd><ul>
<li><p>Extern list</p></li>
<li><p>dynamic list</p></li>
<li><p>version scripts</p></li>
<li><p>linker plugin configuration files</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Most recently the linker also was modified to support taking fully built static
executables as part of the link step.</p>
<div class="section" id="elf-executable-as-input-files-to-the-linker">
<h3><a class="toc-backref" href="#id62"><span class="section-number">17.2.1. </span>ELF executable as input files to the linker</a><a class="headerlink" href="#elf-executable-as-input-files-to-the-linker" title="Permalink to this heading"></a></h3>
<p>Linker allows a fully built static executable as input to the linker.</p>
<p>The LLVM community linker does not support this option. GNU linker used to support
but now does not as per the below bug</p>
<p><a class="reference external" href="https://sourceware.org/bugzilla/show_bug.cgi?id=26223">https://sourceware.org/bugzilla/show_bug.cgi?id=26223</a></p>
<p>ELD allows fully built static executables as input to the linker as per the below example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x2000<span class="p">;</span>
<span class="w">  </span>anotherelf<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>anotherexec.elf<span class="o">(</span>.bar<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>foo.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
extern<span class="w"> </span>int<span class="w"> </span>bar<span class="o">()</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>bar<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>bar.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
__attribute__<span class="o">((</span>section<span class="o">(</span><span class="s2">&quot;.bar&quot;</span><span class="o">)))</span><span class="w"> </span>int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

<span class="nv">$clang</span><span class="w"> </span>-O2<span class="w"> </span>-c<span class="w"> </span>bar.c<span class="w"> </span>-fno-exceptions<span class="w"> </span>-fno-asynchronous-unwind-tables
<span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span>foo.c<span class="w"> </span>-fno-exceptions<span class="w"> </span>-fno-asynchronous-unwind-tables
<span class="nv">$link</span><span class="w"> </span>bar.o<span class="w"> </span>-o<span class="w"> </span>anotherexec.elf<span class="w"> </span>-Ttext<span class="o">=</span>0x2000
<span class="nv">$link</span><span class="w"> </span>foo.o<span class="w"> </span>anotherexec.elf<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is strongly discouraged by the community and got accidentally removed in the GNU linker.</p>
<p>It is upto the user to make sure that the linker script places the executable
code previously linked at the same address.</p>
<p>Linking dynamic executables is not possible with this functionality and will not be supported</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you really need to link with executables, we recommend to use the –just-symbols option</p>
</div>
</div>
</div>
<div class="section" id="linker-script-general-questions">
<h2><a class="toc-backref" href="#id63"><span class="section-number">17.3. </span>Linker Script General Questions</a><a class="headerlink" href="#linker-script-general-questions" title="Permalink to this heading"></a></h2>
<div class="section" id="debugging-section-placements">
<h3><a class="toc-backref" href="#id64"><span class="section-number">17.3.1. </span>Debugging section placements</a><a class="headerlink" href="#debugging-section-placements" title="Permalink to this heading"></a></h3>
</div>
<div class="section" id="linker-script-rules">
<h3><a class="toc-backref" href="#id65"><span class="section-number">17.3.2. </span>Linker Script Rules</a><a class="headerlink" href="#linker-script-rules" title="Permalink to this heading"></a></h3>
<p>Input sections can be stored in files or archives. They are specified in the SECTIONS
command with the following syntax:</p>
<p><em>[path][archive:][file](section…)</em></p>
<p>The standard wildcard characters (*, ?, etc.) can be used anywhere in an input section
specification to do the following:</p>
<ul class="simple">
<li><p>Specify multiple paths, archives, or files where sections will be searched for</p></li>
<li><p>Specify multiple sections as input sections</p></li>
</ul>
</div>
<div class="section" id="fill-values">
<h3><a class="toc-backref" href="#id66"><span class="section-number">17.3.3. </span>Fill Values</a><a class="headerlink" href="#fill-values" title="Permalink to this heading"></a></h3>
<div class="section" id="output-section-fill">
<h4><a class="toc-backref" href="#id67"><span class="section-number">17.3.3.1. </span>Output Section Fill</a><a class="headerlink" href="#output-section-fill" title="Permalink to this heading"></a></h4>
<p>You can set the fill pattern for an entire section by using ‘=fillexp’.
fillexp is an expression.</p>
<p>Any otherwise unspecified regions of memory within the output section
(for example, gaps left due to the required alignment of input sections)
will be filled with the value, repeated as necessary.</p>
<p><strong>In all cases, the number specified by the fillexp is big-endian.</strong></p>
<p>Here is a simple example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SECTIONS<span class="w"> </span><span class="o">{</span><span class="w"> </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">=</span>0x90909090<span class="w"> </span><span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="i-am-getting-an-error-no-linker-script-rule-for-bss">
<h3><a class="toc-backref" href="#id68"><span class="section-number">17.3.4. </span>I am getting an error, no linker script rule for “.bss”</a><a class="headerlink" href="#i-am-getting-an-error-no-linker-script-rule-for-bss" title="Permalink to this heading"></a></h3>
<p>The way that you would investigate this is to figure out if there is an actual
.bss section that is present in the input files, not selected by any linker
script rule. Emit the Map file and look at the section .bss and see what kind
of sections are present.</p>
<ul>
<li><p>If it shows that a input file with a particular section is being listed and
not present in any of the patterns, you will likely need to go and add a rule
such as</p>
<blockquote>
<div><ul class="simple">
<li><p>*(.bss) so that you are sure of where you want to place it.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If all the input file and sections are selected, you should go and look at if
the section corresponds to a common symbol</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>You will most probably be missing a rule as below</dt><dd><ul>
<li><p>*(COMMON)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Try to do the link step again with any of the above changes and your error
should have gone.</p></li>
</ul>
</div>
<div class="section" id="i-am-getting-an-error-no-linker-script-rule-for-data-bar">
<h3><a class="toc-backref" href="#id69"><span class="section-number">17.3.5. </span>I am getting an error, no linker script rule for “.data.bar”</a><a class="headerlink" href="#i-am-getting-an-error-no-linker-script-rule-for-data-bar" title="Permalink to this heading"></a></h3>
<p>This is most often a problem if there is a compiler flag that has changed in
your environment or a change of tools. You would need to fix the linker script
and add a rule as below.</p>
<ul class="simple">
<li><p>*(.data.bar)</p></li>
</ul>
</div>
<div class="section" id="is-there-a-way-to-find-all-used-unused-rules-in-the-linker-script">
<h3><a class="toc-backref" href="#id70"><span class="section-number">17.3.6. </span>Is there a way to find all used/unused rules in the Linker script ?</a><a class="headerlink" href="#is-there-a-way-to-find-all-used-unused-rules-in-the-linker-script" title="Permalink to this heading"></a></h3>
<p>You can use a simple grep pattern to check for used/unused rules in the Map file.</p>
<div class="section" id="unused-rules">
<h4><a class="toc-backref" href="#id71"><span class="section-number">17.3.6.1. </span>UnUsed Rules</a><a class="headerlink" href="#unused-rules" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep<span class="w"> </span><span class="s2">&quot;Rule.*\[0:&quot;</span><span class="w"> </span>link.map<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>Implicit
</pre></div>
</div>
</div>
<div class="section" id="used-rules">
<h4><a class="toc-backref" href="#id72"><span class="section-number">17.3.6.2. </span>Used Rules</a><a class="headerlink" href="#used-rules" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep<span class="w"> </span><span class="s2">&quot;Rule.*\[[1-9]*:&quot;</span><span class="w"> </span>link.map<span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>Implicit
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-do-i-exclude-sections-from-object-files-archive-files">
<h3><a class="toc-backref" href="#id73"><span class="section-number">17.3.7. </span>How do I exclude sections from object files/archive files</a><a class="headerlink" href="#how-do-i-exclude-sections-from-object-files-archive-files" title="Permalink to this heading"></a></h3>
<div class="section" id="excluding-sections-from-object-files">
<h4><a class="toc-backref" href="#id74"><span class="section-number">17.3.7.1. </span>Excluding sections from object files</a><a class="headerlink" href="#excluding-sections-from-object-files" title="Permalink to this heading"></a></h4>
<p>The example illustrates users trying to exclude all text sections from being
placed in section .text1 and when the input file is an object file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>a.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!


cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text1<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="o">)</span><span class="w"> </span>.text.*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.text2<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>a.c<span class="w"> </span>-G0
rm<span class="w"> </span>-f<span class="w"> </span>lib1.a
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib1.a<span class="w"> </span>a.o
hexagon-link<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>a.o<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
</div>
<div class="section" id="exclude-all-patterns-of-text-section-from-one-file">
<h4><a class="toc-backref" href="#id75"><span class="section-number">17.3.7.2. </span>Exclude all patterns of text section from one file</a><a class="headerlink" href="#exclude-all-patterns-of-text-section-from-one-file" title="Permalink to this heading"></a></h4>
<p>The example illustrates an user trying to exclude all text sections from being
placed in section .text1.</p>
<p>In this example, all code from lib1.a/a.o is not emitted to the the .text1 section</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>a.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!


cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text1<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*lib1.a:<span class="o">(</span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="o">)</span><span class="w"> </span>.text.*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.text2<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-c<span class="w"> </span>a.c
rm<span class="w"> </span>-f<span class="w"> </span>lib1.a
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib1.a<span class="w"> </span>a.o
hexagon-link<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--whole-archive<span class="w"> </span>lib1.a
</pre></div>
</div>
</div>
<div class="section" id="excluding-all-patterns-of-text-section-from-more-than-one-file">
<h4><a class="toc-backref" href="#id76"><span class="section-number">17.3.7.3. </span>Excluding all patterns of text section from more than one file</a><a class="headerlink" href="#excluding-all-patterns-of-text-section-from-more-than-one-file" title="Permalink to this heading"></a></h4>
<p>The example illustrates an user trying to exclude all text sections from being
placed in section .text1.</p>
<p>In this example, all code from lib1.a/a.o and lib1.a/b.o is not emitted to the
.text1 section</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>a.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>b.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!


cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text1<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*lib1.a:<span class="o">(</span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="w"> </span>b.o<span class="o">)</span><span class="w"> </span>.text.*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.text2<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>a.c<span class="w"> </span>-G0
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>b.c<span class="w"> </span>-G0
rm<span class="w"> </span>-f<span class="w"> </span>lib1.a
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib1.a<span class="w"> </span>a.o<span class="w"> </span>b.o
hexagon-link<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--whole-archive<span class="w"> </span>lib1.a<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
</div>
<div class="section" id="specifying-multiple-exclude-patterns">
<h4><a class="toc-backref" href="#id77"><span class="section-number">17.3.7.4. </span>Specifying multiple exclude patterns</a><a class="headerlink" href="#specifying-multiple-exclude-patterns" title="Permalink to this heading"></a></h4>
<p>You can specify more than one EXCLUDE_FILE pattern in a linker script rule.</p>
<p>This example below illustrates a way that the user can specify multiple
EXCLUDE_FILE linker script commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>a.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>b.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!


cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text1<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*lib1.a:<span class="o">(</span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="o">)</span><span class="w"> </span>.text.foo<span class="w"> </span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="o">)</span><span class="w"> </span>.text.bar<span class="w"> </span>EXCLUDE_FILE<span class="o">(</span>b.o<span class="o">)</span><span class="w"> </span>.text.baz<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.text2<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>a.c<span class="w"> </span>-G0
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>b.c<span class="w"> </span>-G0
rm<span class="w"> </span>-f<span class="w"> </span>lib1.a
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib1.a<span class="w"> </span>a.o<span class="w"> </span>b.o
hexagon-link<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--whole-archive<span class="w"> </span>lib1.a<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
</div>
<div class="section" id="common-mistakes-with-exclude-files">
<h4><a class="toc-backref" href="#id78"><span class="section-number">17.3.7.5. </span>Common mistakes with exclude files</a><a class="headerlink" href="#common-mistakes-with-exclude-files" title="Permalink to this heading"></a></h4>
<p>Specifying more than one pattern</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A common mistake users do is when they specify more than one pattern with one
occurrence of an EXCLUDE_FILE rule.
Only the first pattern following the EXCLUDE_FILE rule is used for matching</p>
</div>
<p>In the above example if the user did the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text1<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*lib1.a:<span class="o">(</span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="o">)</span><span class="w"> </span>.text.foo<span class="w"> </span>.text.bar<span class="w"> </span>EXCLUDE_FILE<span class="o">(</span>b.o<span class="o">)</span><span class="w"> </span>.text.baz<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.text2<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function specified by .text.bar would be placed in .text1 since .text.bar
is following the pattern .text.foo.</p>
</div>
</div>
<div class="section" id="not-specifying-all-the-files-in-the-exclude-file-pattern">
<h4><a class="toc-backref" href="#id79"><span class="section-number">17.3.7.6. </span>Not specifying all the files in the EXCLUDE_FILE pattern</a><a class="headerlink" href="#not-specifying-all-the-files-in-the-exclude-file-pattern" title="Permalink to this heading"></a></h4>
<p>When the file pattern does not match the filename specified in EXCLUDE_FILE,
pattern following the EXCLUDE_FILE is used to select input sections that do not
originate from that file.</p>
<p>Below example illustrates that. In this example .text.baz from file b.o is
selected by the rule, which results in .text1 housing .text.baz.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>a.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>b.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!


cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text1<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*lib1.a:<span class="o">(</span>EXCLUDE_FILE<span class="o">(</span>a.o<span class="o">)</span><span class="w"> </span>.text.*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="w">  </span>.text2<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text*<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>a.c<span class="w"> </span>-G0
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-c<span class="w"> </span>b.c<span class="w"> </span>-G0
rm<span class="w"> </span>-f<span class="w"> </span>lib1.a
hexagon-ar<span class="w"> </span>cr<span class="w"> </span>lib1.a<span class="w"> </span>a.o<span class="w"> </span>b.o
hexagon-link<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--whole-archive<span class="w"> </span>lib1.a<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
</div>
<div class="section" id="specifying-exclude-file-directive-that-applies-to-multiple-section-patterns">
<h4><a class="toc-backref" href="#id80"><span class="section-number">17.3.7.7. </span>Specifying EXCLUDE_FILE directive that applies to multiple section patterns</a><a class="headerlink" href="#specifying-exclude-file-directive-that-applies-to-multiple-section-patterns" title="Permalink to this heading"></a></h4>
<p>We can specify EXCLUDE_FILE  directive that applies to multiple section patterns
by placing EXCLUDE_FILE before the corresponding &lt;file-patterns&gt;(&lt;section-patterns&gt;).</p>
<p>For Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">int foo() { return 1; }</span>
<span class="s">int baz() { return 3; }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;2.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">int bar() { return 3; }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  FOO_BAZ : { EXCLUDE_FILE(2.o) *(.text.foo .text.baz .text.bar) }</span>
<span class="s">  BAR : { *(*.text*) }</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c<span class="w"> </span>-ffunction-sections
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>-c<span class="w"> </span>-ffunction-sections
hexagon-link<span class="w"> </span>-o<span class="w"> </span>a.out<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>In the above example, EXCLUDE_FILE(2.o) applies to all the section patterns
present in the sub-rule: *(.text.foo .text.baz .text.bar)</p>
</div>
<div class="section" id="nocrossrefs">
<h4><a class="toc-backref" href="#id81"><span class="section-number">17.3.7.8. </span>NOCROSSREFS</a><a class="headerlink" href="#nocrossrefs" title="Permalink to this heading"></a></h4>
<p>The NOCROSSREFS command takes a list of output section names. If the linker
detects any cross references between the sections, it reports an error and
returns a non-zero exit status. Note that the NOCROSSREFS command uses output
section names, not input section names.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
extern<span class="w"> </span>int<span class="w"> </span>bar<span class="o">()</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>bar<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
NOCROSSREFS<span class="o">(</span>.foo<span class="w"> </span>.bar<span class="o">)</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">  </span>.bar<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!

clang<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>-ffunction-sections
ld.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>The above linker script usage of <strong>NOCROSSREFS</strong> produces an error because content
in output section foo is calling into bar.</p>
</div>
</div>
<div class="section" id="how-to-discard-an-input-section">
<h3><a class="toc-backref" href="#id82"><span class="section-number">17.3.8. </span>How to discard an input section?</a><a class="headerlink" href="#how-to-discard-an-input-section" title="Permalink to this heading"></a></h3>
<p>Input sections can be explicitly discarded from the output image by assigning
the input section to a special output section named ‘/DISCARD/’. It can also
discard sections marked with the ELF flag SHF_GNU_RETAIN which would otherwise
have been saved from linker garbage collection.</p>
<p>For Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">__attribute__((retain)) int foo() { return 0; }</span>
<span class="s">int bar() { return 0; }</span>
<span class="s">int main() { return 0; }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;1.linker.script<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  /DISCARD/ : { *(.text.foo) }</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.elf<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>--gc-sections<span class="w"> </span>--print-gc-sections<span class="w"> </span>-e<span class="w"> </span>main
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.with_script.elf<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span><span class="m">1</span>.linker.script<span class="w"> </span>--gc-sections<span class="w"> </span>--print-gc-sections<span class="w"> </span>-e<span class="w"> </span>main<span class="w"> </span>--trace-section<span class="w"> </span>.text.foo
</pre></div>
</div>
<p><strong>hexagon-link -o 1.elf 1.o –gc-sections –print-gc-sections -e main</strong></p>
<p>Running the above command gives the following output:</p>
<p>Trace: GC : 1.o[.text]
| Trace: GC : 1.o[.text.bar]</p>
<p>Please note that ‘.text.foo’ is preserved even though there are no references
to the function foo from the entry point. It is because ‘.text.foo’ is marked
with the ELF flag SHF_GNU_RETAIN using ‘__attribute__((retain))’.</p>
<p>The above command can be run with the verbose option to see the
‘retain section…’ diagnostic for ‘.text.foo’:</p>
<p>Verbose: Retaining section .text.foo from file 1.o</p>
<p>‘.text.foo’ can be discarded by assigning it to /DISCARD/ special output section.</p>
<p>hexagon-link -o 1.with_script.elf 1.o -T 1.linker.script –gc-sections –print-gc-sections -e main –trace-section .text.foo</p>
<p>Running the above command gives the following output:</p>
<p>Note: Input Section : .text.foo InputFile : 1.o Alignment : 0x10 Size : 0xc Flags : SHF_ALLOC|SHF_EXECINSTR
| Note: Input Section : .text.foo Symbol : foo
| Note: Section : .text.foo is being discarded. Section originated from input : 1.o
| Trace: GC : 1.o[.text]
| Trace: GC : 1.o[.text.bar]</p>
<p>We can see in the ‘Note’ diagnostic that ‘.text.foo’ has been discarded.</p>
</div>
<div class="section" id="marking-a-loadable-output-section-as-non-loadable">
<h3><a class="toc-backref" href="#id83"><span class="section-number">17.3.9. </span>Marking a loadable output section as non loadable</a><a class="headerlink" href="#marking-a-loadable-output-section-as-non-loadable" title="Permalink to this heading"></a></h3>
<p>Linker now supports loadable sections to be listed after non loadable sections,
so the linker is able to place them in a loadable segment.</p>
<p>There have been various assumptions in the past that customers relied on their linker
scripts, about linker not supporting loadable sections after non loadable sections.</p>
<p>If these assumptions are still valid for your use case(s) :</p>
<ul class="simple">
<li><p>Make sure to list the ouput section to be of type INFO
* Example : OutputSection <strong>(INFO)</strong>
* This will mark the output section non loadable</p></li>
<li><p>Always inspect the output of your section to segment mapping before loading the image
* llvm-readelf -l -W <em>outputfile</em></p></li>
</ul>
<p><strong>If you have been waiting for this feature, remove the virtual address assigned
to the section.</strong></p>
<p>Most users have these output sections listed in the linker script to use a
virtual address of 0. You will need to remove it.</p>
<p>Always inspect the output image to check for any discrepancies.</p>
</div>
<div class="section" id="what-does-keep-mean-for-input-section-descriptions-in-discard-added-in-hex-8-8">
<h3><a class="toc-backref" href="#id84"><span class="section-number">17.3.10. </span>What does KEEP mean for input section descriptions in /DISCARD/? (Added in HEX 8.8)</a><a class="headerlink" href="#what-does-keep-mean-for-input-section-descriptions-in-discard-added-in-hex-8-8" title="Permalink to this heading"></a></h3>
<p>KEEP marks all the input sections matched by an input section description as an
entry section. Entry sections are not subject to garbage-collection and are used
to calculate live-edges for garbage-collection. However, entry sections can still
be discarded. Therefore, behavior of KEEP is the same for input section description
of all output sections, including the /DISCARD/ output section. Important thing
to remember is when KEEP is used for input section descriptions in the/DISCARD/
output section then the matched input sections are treated as entry sections for
live-edge computation but are still discarded nonetheless.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">int bar() {</span>
<span class="s">  return 1;</span>
<span class="s">}</span>

<span class="s">int foo() {</span>
<span class="s">  return bar();</span>
<span class="s">}</span>

<span class="s">int baz() {</span>
<span class="s">  return 3;</span>
<span class="s">}</span>

<span class="s">int abc() {</span>
<span class="s">  return 5;</span>
<span class="s">}</span>

<span class="s">int main() {</span>
<span class="s">  return baz();</span>
<span class="s">}</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  /DISCARD/ : { KEEP(*(*.foo)) }</span>
<span class="s">  .text : { *(.text.*) }</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.elf<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--gc-sections<span class="w"> </span>--print-gc-sections<span class="w"> </span>-e<span class="w"> </span>main<span class="w"> </span>-Map<span class="w"> </span><span class="m">1</span>.map.tx
</pre></div>
</div>
<p>In this example, bar  is not garbage-collected because it is reachable by foo.
foo  is an entry section due to KEEP specifier even though it is discarded. Map
file can be used to confirm the behavior.</p>
</div>
<div class="section" id="how-to-build-executables-by-linking-symbols-from-an-another-elf-file">
<h3><a class="toc-backref" href="#id85"><span class="section-number">17.3.11. </span>How to build executables by linking symbols from an another ELF file?</a><a class="headerlink" href="#how-to-build-executables-by-linking-symbols-from-an-another-elf-file" title="Permalink to this heading"></a></h3>
<p>Users can build executables by linking symbols from another ELF file by using
the SYMDEF feature.</p>
<p>ELD mimics the functionality available in the ARM linker for this.</p>
<p>This method is also used by ARM baremetal builds for linking against symbols
that exist in another image.</p>
<div class="section" id="symdef-file">
<h4><a class="toc-backref" href="#id86"><span class="section-number">17.3.11.1. </span>SymDef file</a><a class="headerlink" href="#symdef-file" title="Permalink to this heading"></a></h4>
<p>A symdef file is a file that consists of all global symbols that can be used in
future link steps.</p>
<p>The linker produces a symdefs file during a successful final link stage. It is
not produced for partial linking or for unsuccessful final linking.</p>
<p>The symdef file is produced by using the linker symdef option.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;1.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="k">return</span><span class="w"> </span>bar<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>boo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>baz<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>image.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0xF0000000<span class="p">;</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!

<span class="nv">$CLANG</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections
<span class="nv">$CLANG</span><span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span>-ffunction-sections
<span class="nv">$CLANG</span><span class="w"> </span>-c<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span>-ffunction-sections
<span class="nv">$LINK</span><span class="w"> </span>-o<span class="w"> </span>otherimage.elf<span class="w"> </span><span class="m">3</span>.o<span class="w"> </span>--symdef-file<span class="w"> </span>r.symdef<span class="w"> </span>-T<span class="w"> </span>image.t
<span class="c1"># otherimage.elf should be preserved for the below link command to work</span>
<span class="nv">$LINK</span><span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">2</span>.o<span class="w"> </span>r.symdef<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-o<span class="w"> </span>out.elf
</pre></div>
</div>
<p>The symdef file gets produced that contains the address of bar and baz in the image.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#&lt;SYMDEFS&gt;#</span>
<span class="c1">#DO NOT EDIT#</span>
0xf0000000<span class="w">      </span>FUNC<span class="w">    </span>bar
0xf0000010<span class="w">      </span>FUNC<span class="w">    </span>baz
</pre></div>
</div>
<p>Later the file is used in the secondary link to generate the complete binary.</p>
</div>
</div>
<div class="section" id="how-to-specify-load-memory-address-lma-of-a-section">
<h3><a class="toc-backref" href="#id87"><span class="section-number">17.3.12. </span>How to specify Load Memory Address (LMA) of a section?</a><a class="headerlink" href="#how-to-specify-load-memory-address-lma-of-a-section" title="Permalink to this heading"></a></h3>
<p>Load Memory Address (LMA) of a section can be specified using the ‘AT’ command.
Please note that it is different from the virtual memory address.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FOO<span class="w"> </span>0x1000<span class="w"> </span>:<span class="w"> </span>AT<span class="o">(</span>0x4000<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>*foo*<span class="o">)</span>
<span class="w"> </span><span class="o">}</span>
</pre></div>
</div>
<p>In the above example, ‘0x1000’ is the virtual memory address (VMA) of the output
section ‘FOO’, and ‘0x4000’ is the load memory address (lma).</p>
<p>A concrete example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">int foo() { return 1; }</span>
<span class="s">int bar() { return 3; }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  FOO 0x1000 : AT(0x4000) {</span>
<span class="s">    *(*foo*)</span>
<span class="s">  }</span>

<span class="s">  BAR 0x2000 : AT(0x6000) {</span>
<span class="s">    *(*bar*)</span>
<span class="s">  }</span>
<span class="s">}</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;script.without_at.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  FOO 0x1000 : { *(*foo*) }</span>
<span class="s">  BAR 0x2000 : { *(*bar*) }</span>
<span class="s">}</span>
<span class="s">EOF</span>

<span class="nv">CCs</span><span class="o">=(</span><span class="s2">&quot;clang -target hexagon&quot;</span><span class="w"> </span>clang-15<span class="w"> </span>clang-15<span class="o">)</span>
<span class="nv">LDs</span><span class="o">=(</span>hexagon-link<span class="w"> </span>ld.bfd<span class="w"> </span>ld.lld<span class="o">)</span>
<span class="nv">SFs</span><span class="o">=(</span>eld<span class="w"> </span>bfd<span class="w"> </span>lld<span class="o">)</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c<span class="w"> </span>-ffunction-sections
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.elf<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
hexagon-llvm-objdump<span class="w"> </span>-h<span class="w"> </span><span class="m">1</span>.elf

<span class="c1"># Output:</span>
<span class="c1"># 1.eld.elf:     file format elf32-hexagon</span>
<span class="c1">#</span>
<span class="c1"># Sections:</span>
<span class="c1"># Idx Name          Size     VMA      LMA      Type</span>
<span class="c1">#  0               00000000 00000000 00000000</span>
<span class="c1">#  1 FOO           0000000c 00001000 00004000 TEXT</span>
<span class="c1">#  2 BAR           0000000c 00002000 00006000 TEXT</span>
<span class="c1">#  3 .comment      00000106 00000000 00000000</span>
<span class="c1">#  4 .shstrtab     0000002c 00000000 00000000</span>
<span class="c1">#  5 .symtab       00000080 00000000 00000000</span>
<span class="c1">#  6 .strtab       00000024 00000000 00000000</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Please<span class="w"> </span>note<span class="w"> </span>the<span class="w"> </span>VMA<span class="w"> </span>and<span class="w"> </span>LMA<span class="w"> </span>of<span class="w"> </span>output<span class="w"> </span>sections<span class="w"> </span>FOO<span class="w"> </span>and<span class="w"> </span>BAR:

FOO<span class="w">           </span>0000000c<span class="w"> </span><span class="m">00001000</span><span class="w"> </span><span class="m">00004000</span>
BAR<span class="w">           </span>0000000c<span class="w"> </span><span class="m">00002000</span><span class="w"> </span><span class="m">00006000</span>
</pre></div>
</div>
</div>
<div class="section" id="image-layout-using-lma">
<h3><a class="toc-backref" href="#id88"><span class="section-number">17.3.13. </span>Image layout using LMA</a><a class="headerlink" href="#image-layout-using-lma" title="Permalink to this heading"></a></h3>
<p>When sections are placed in a segment, the LMA address of the section is
calculated as the sum of LMA address of the segment  and virtual address offset
of the section from the beginning of the segment.</p>
<p>User can query the LMA address of the section using the linker script keyword
LOADADDR.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>bss<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
int<span class="w"> </span>data<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span>AT<span class="o">(</span>0x1000<span class="o">)</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w">  </span>:A
<span class="w">  </span>.bar<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss.bss*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w">  </span>:A
<span class="w">  </span>.baz<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss.data*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w">  </span>:A
<span class="w">  </span>.nothing<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span><span class="nv">load_addr_baz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LOADADDR<span class="o">(</span>.nothing<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
!

<span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0<span class="w"> </span>-fno-asynchronous-unwind-tables
<span class="nv">$link</span><span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p>With the above example you can see that the linker sets the value of load_addr_baz
to the load address of the section .nothing.</p>
<p>For Hexagon architecture, you can see that the load address thats calculated
accounts to be 0x1330.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00001000<span class="w"> </span>0x0000c<span class="w"> </span>0x00330<span class="w"> </span>RWE<span class="w"> </span>0x1000
</pre></div>
</div>
<p>This change in behavior is observed from linkers on release</p>
<ul class="simple">
<li><p>Hexagon 8.9 and above</p></li>
<li><p>RISC-V 18.0 release</p></li>
</ul>
<p>If you have a linker script that assumes the behavior of LOADADDR, you might want
to fix that with the recent change to behavior.</p>
</div>
<div class="section" id="what-are-byte-short-long-quad-squad-linker-script-commands">
<h3><a class="toc-backref" href="#id89"><span class="section-number">17.3.14. </span>What are BYTE/SHORT/LONG/QUAD/SQUAD linker script commands?</a><a class="headerlink" href="#what-are-byte-short-long-quad-squad-linker-script-commands" title="Permalink to this heading"></a></h3>
<p>These commands allow including explicit bytes of data in an output section.
Each of these commands is followed by an expression in parentheses providing the
value to store. The value is stored at the current value of the location counter</p>
<p>The BYTE, SHORT, LONG, and QUAD commands store one, two, four, and eight bytes (respectively).
After storing the bytes, the location counter is incremented by the number of bytes stored.</p>
<p>An example demonstrating these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">int foo() { return 1; }</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  FIVE: { BYTE(0x5) }</span>
<span class="s">  SIXTEEN : { LONG(0x10) }</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.elf<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
hexagon-readelf<span class="w"> </span>-x<span class="w"> </span><span class="s1">&#39;FIVE&#39;</span><span class="w"> </span><span class="m">1</span>.elf
hexagon-readelf<span class="w"> </span>-x<span class="w"> </span><span class="s1">&#39;SIXTEEN&#39;</span><span class="w"> </span><span class="m">1</span>.elf
</pre></div>
</div>
</div>
<div class="section" id="what-is-the-order-of-linker-script-assignment-evaluations">
<h3><a class="toc-backref" href="#id90"><span class="section-number">17.3.15. </span>What is the order of linker script assignment evaluations?</a><a class="headerlink" href="#what-is-the-order-of-linker-script-assignment-evaluations" title="Permalink to this heading"></a></h3>
<p>Linker script contains assignment expressions. Assignment expressions can be
categorized into 3 distinct categories: before-sections, in-sections and after-sections.
We will use the term outside-sections to collectively refer before-sections and
after-sections categories. When an assignment expression gets evaluated depends
on the assignment expression category.</p>
<p>First, all the assignment expressions outside the SECTIONS commands are evaluated
and then the assignment expressions within the SECTIONS command are evaluated.
There are few catches, which we will soon explore.</p>
<p>Let’s look at some concrete examples to understand assignment evaluation order behavior.</p>
<div class="section" id="basic">
<h4><a class="toc-backref" href="#id91"><span class="section-number">17.3.15.1. </span>Basic</a><a class="headerlink" href="#basic" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">bar = 0x3;</span>
<span class="s">SECTIONS {</span>
<span class="s">  baz = bar;</span>
<span class="s">}</span>
<span class="s">EOF</span>

touch<span class="w"> </span><span class="m">1</span>.c
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.out<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
hexagon-readelf<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.out
<span class="c1"># Output:</span>
<span class="c1"># Symbol table &#39;.symtab&#39; contains 7 entries:</span>
<span class="c1">#   Num:    Value  Size Type    Bind   Vis       Ndx Name</span>
<span class="c1">#     // ...</span>
<span class="c1">#     // ...</span>
<span class="c1">#     5: 00000003     0 NOTYPE  GLOBAL DEFAULT   ABS bar</span>
<span class="c1">#     6: 00000003     0 NOTYPE  GLOBAL DEFAULT   ABS baz</span>
</pre></div>
</div>
<p>Both bar and baz have the value 0x3 as expected.</p>
</div>
<div class="section" id="use-an-after-sections-variable-to-initialize-an-in-sections-variable">
<h4><a class="toc-backref" href="#id92"><span class="section-number">17.3.15.2. </span>Use an after-sections variable to initialize an in-sections variable</a><a class="headerlink" href="#use-an-after-sections-variable-to-initialize-an-in-sections-variable" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  baz = bar;</span>
<span class="s">}</span>
<span class="s">bar = 0x3;</span>
<span class="s">EOF</span>

touch<span class="w"> </span><span class="m">1</span>.c
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.out<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
hexagon-readelf<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.out
<span class="c1"># Output:</span>
<span class="c1"># Symbol table &#39;.symtab&#39; contains 7 entries:</span>
<span class="c1">#   Num:    Value  Size Type    Bind   Vis       Ndx Name</span>
<span class="c1">#     // ...</span>
<span class="c1">#     // ...</span>
<span class="c1">#     5: 00000003     0 NOTYPE  GLOBAL DEFAULT   ABS bar</span>
<span class="c1">#     6: 00000003     0 NOTYPE  GLOBAL DEFAULT   ABS baz</span>
</pre></div>
</div>
<p>Both bar and baz have the value 0x3 even though at first glance it seems that
bar is defined later than baz.</p>
<p>That’s not true. Remember that all outside-sections assignments are evaluated
before in-sections assignments. Hence, bar is evaluated before baz.</p>
</div>
<div class="section" id="use-a-variable-that-is-defined-in-both-before-sections-and-after-sections-assignment-to-initialize-an-in-sections-variable">
<h4><a class="toc-backref" href="#id93"><span class="section-number">17.3.15.3. </span>Use a variable, that is defined in both before-sections and after-sections assignment, to initialize an in-sections variable</a><a class="headerlink" href="#use-a-variable-that-is-defined-in-both-before-sections-and-after-sections-assignment-to-initialize-an-in-sections-variable" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">bar = 0x3;</span>
<span class="s">SECTIONS {</span>
<span class="s">  baz = bar;</span>
<span class="s">}</span>
<span class="s">bar = 0x5;</span>
<span class="s">EOF</span>

touch<span class="w"> </span><span class="m">1</span>.c
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.out<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
hexagon-readelf<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.out
<span class="c1"># Output:</span>
<span class="c1"># Symbol table &#39;.symtab&#39; contains 7 entries:</span>
<span class="c1">#   Num:    Value  Size Type    Bind   Vis       Ndx Name</span>
<span class="c1">#     // ...</span>
<span class="c1">#     // ...</span>
<span class="c1">#     5: 00000005     0 NOTYPE  GLOBAL DEFAULT   ABS bar</span>
<span class="c1">#     6: 00000005     0 NOTYPE  GLOBAL DEFAULT   ABS baz</span>
</pre></div>
</div>
<p>Now, that’s a little interesting. If the assignments were evaluated in the
natural-order then we would have seen baz value as 0x3 and bar value as 0x5.
However, this is not what we have observed.</p>
<p>The reason is that outside-sections assignments are evaluated before in-sections
assignments. Hence, the order of evaluations is:</p>
<ol class="arabic simple">
<li><p>bar = 0x3</p></li>
<li><p>bar = 0x5</p></li>
<li><p>baz = bar</p></li>
</ol>
<p><strong>So remember that the golden rule is outside-sections assignments are evaluated
before in-sections assignments.</strong></p>
</div>
<div class="section" id="using-a-defsym-symbol-in-linker-script-assignment-expression">
<h4><a class="toc-backref" href="#id94"><span class="section-number">17.3.15.4. </span>Using a defsym symbol in linker script assignment expression</a><a class="headerlink" href="#using-a-defsym-symbol-in-linker-script-assignment-expression" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">SECTIONS {</span>
<span class="s">  baz = bar;</span>
<span class="s">}</span>
<span class="s">EOF</span>

touch<span class="w"> </span><span class="m">1</span>.c
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c
hexagon-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.out<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--defsym<span class="w"> </span><span class="nv">bar</span><span class="o">=</span>0x5
hexagon-readelf<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.out
<span class="c1"># Output:</span>
<span class="c1"># Symbol table &#39;.symtab&#39; contains 7 entries:</span>
<span class="c1">#   Num:    Value  Size Type    Bind   Vis       Ndx Name</span>
<span class="c1">#     // ...</span>
<span class="c1">#     // ...</span>
<span class="c1">#     5: 00000005     0 NOTYPE  GLOBAL DEFAULT   ABS bar</span>
<span class="c1">#     6: 00000005     0 NOTYPE  GLOBAL DEFAULT   ABS baz</span>
</pre></div>
</div>
<p><em>defsym</em>  symbols are treated as outside-sections symbols, and hence they are
always evaluated before in-sections symbols. This explains the readelf output
that we see.</p>
</div>
<div class="section" id="what-linker-script-changes-are-required-for-supporting-thread-local-storage-tls">
<h4><a class="toc-backref" href="#id95"><span class="section-number">17.3.15.5. </span>What linker script changes are required for supporting thread-local storage (TLS)?</a><a class="headerlink" href="#what-linker-script-changes-are-required-for-supporting-thread-local-storage-tls" title="Permalink to this heading"></a></h4>
<p>If any of the linker inputs use thread-local storage (TLS), then some linker script
changes are required to correctly support thread-local storage functionality.</p>
<p>To properly understand these linker script changes, it is helpful to understand
the TLS functionality and how TLS is allocated and initialized.</p>
<p>Thread-local storage functionality makes a variable local to each thread.
This means that each thread has its own copy of the variable. This is unlike
ordinary global/static variables that are shared across all threads.
The runtime library allocates thread-local storage for each thread and
it initializes the thread-local storage to the region pointed by the
<code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code> segment. Among other things, <code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code> segment
describes to the runtime library where to find the initial contents
of the thread-local storage and the alignment requirements.</p>
<p>The runtime library needs <code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code> segment for properly initializing
TLS region for each block. Thus, the linker needs to emit <code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code>
segment for the images that are utilizing TLS functionality. The linker
script changes are required for instructing the linker how to properly
emit <code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code> segment. In particular, we need to add a <code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code>
program header and put the TLS sections (<code class="code docutils literal notranslate"><span class="pre">.tdata</span></code> and <code class="code docutils literal notranslate"><span class="pre">.tbss</span></code>)
into both the <code class="code docutils literal notranslate"><span class="pre">PT_TLS</span></code> and a <code class="code docutils literal notranslate"><span class="pre">PT_LOAD</span></code> section. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>...
<span class="w">  </span>DATA<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>TLS<span class="w"> </span>PT_TLS<span class="p">;</span>
<span class="w">  </span>...
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>...
<span class="w">  </span>.tbss<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>*.tbss<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:DATA<span class="w"> </span>:TLS
<span class="w">  </span>.tdata<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>*.tdata<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:DATA<span class="w"> </span>:TLS
<span class="w">  </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>*.data<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:DATA<span class="w"> </span>//<span class="w"> </span>It<span class="w"> </span>is<span class="w"> </span>important<span class="w"> </span>to<span class="w"> </span>specify<span class="w"> </span>:DATA<span class="w"> </span>here
<span class="w">                              </span>//<span class="w"> </span>otherwise<span class="w"> </span><span class="s1">&#39;:DATA :TLS&#39;</span><span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>assumed
<span class="w">  </span>...
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="why-am-i-getting-the-warning-space-between-archive-member-file-pattern-is-deprecated">
<h3><a class="toc-backref" href="#id96"><span class="section-number">17.3.16. </span>Why am I getting the warning ‘Space between archive:member file pattern is deprecated’</a><a class="headerlink" href="#why-am-i-getting-the-warning-space-between-archive-member-file-pattern-is-deprecated" title="Permalink to this heading"></a></h3>
<p>Linker script allows to specify archive members in input section descriptions
using the <cite>&lt;archive-pattern&gt;:&lt;member-pattern&gt;</cite> syntax. For example in the below
linker script <cite>SECTIONS</cite> command snippet, <cite>foo_text</cite> output section contains the
<cite>.text*</cite> sections from the <cite>foo.o</cite> member of <cite>libfoobar.a</cite> archive.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>foo_text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>libfoobar.a:foo.o<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Please note that there should be no space between the <cite>&lt;archive-pattern&gt;:</cite>
and the <cite>&lt;member-pattern&gt;</cite>. Previously, the linker accepted the space
between the two patterns for convenience. This behavior is now
deprecated and will be removed in the future.</p>
<p>The below linker script snippet demonstrates some of the cases where
the warning will be emitted and why.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
<span class="w"> </span>int<span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">;</span>
<span class="w"> </span>!

<span class="w"> </span>cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
<span class="w"> </span>SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span>/*<span class="w"> </span>The<span class="w"> </span>warning<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>displayed<span class="w"> </span>because<span class="w"> </span>there<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>space<span class="w"> </span>between
<span class="w">         </span><span class="s1">&#39;*lib1.a:&#39;</span><span class="w"> </span>and<span class="w"> </span><span class="s1">&#39;1.o&#39;</span><span class="w"> </span>*/
<span class="w">     </span>*lib1.a:<span class="w"> </span><span class="m">1</span>.o<span class="o">(</span>.*data*<span class="o">)</span>
<span class="w">      </span>/*<span class="w"> </span>No<span class="w"> </span>warning.<span class="w"> </span>When<span class="w"> </span>member-pattern<span class="w"> </span>is<span class="w"> </span>missing,<span class="w"> </span>all<span class="w"> </span>members<span class="w"> </span>of<span class="w"> </span>the
<span class="w">         </span>matched<span class="w"> </span>archives<span class="w"> </span>are<span class="w"> </span>matched.<span class="w"> </span>*/
<span class="w">     </span>/tmp/lib1.a*:<span class="w"> </span><span class="o">(</span>.*data*<span class="o">)</span>
<span class="w">     </span>*lib1.a:<span class="w"> </span><span class="o">(</span>.*data*<span class="o">)</span>
<span class="w">     </span>/*<span class="w"> </span>The<span class="w"> </span>warning<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>displayed<span class="w"> </span>because<span class="w"> </span>there<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>space<span class="w"> </span>between
<span class="w">        </span><span class="s1">&#39;*lib1.a:&#39;</span><span class="w"> </span>and<span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="w"> </span>*/
<span class="w">     </span>*lib1.a:<span class="w"> </span>*<span class="o">(</span>.*data*<span class="o">)</span>
<span class="w">     </span>/*<span class="w"> </span>No<span class="w"> </span>warning.<span class="w"> </span><span class="s1">&#39;*lib1.a:&#39;</span><span class="w"> </span>and<span class="w"> </span><span class="s1">&#39;*(.data*)&#39;</span><span class="w"> </span>are<span class="w"> </span>considered<span class="w"> </span>as<span class="w"> </span>separate
<span class="w">        </span>input<span class="w"> </span>section<span class="w"> </span>descriptions.<span class="w"> </span>*/
<span class="w">     </span>*lib1.a:
<span class="w">     </span>*<span class="o">(</span>.data*<span class="o">)</span>
<span class="w">   </span><span class="o">}</span>
<span class="w"> </span><span class="o">}</span>
<span class="w"> </span>!

clang<span class="w"> </span>-c<span class="w">   </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-g
llvm-ar<span class="w"> </span>cr<span class="w"> </span>lib1.a<span class="w"> </span><span class="m">1</span>.o
ld.eld<span class="w"> </span>--whole-archive<span class="w"> </span>lib1.a<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x<span class="w"> </span>-Wlinker-script
</pre></div>
</div>
</div>
</div>
<div class="section" id="linker-script-phdrs">
<h2><a class="toc-backref" href="#id97"><span class="section-number">17.4. </span>Linker Script PHDRS</a><a class="headerlink" href="#linker-script-phdrs" title="Permalink to this heading"></a></h2>
<div class="section" id="when-should-i-use-phdrs-command">
<h3><a class="toc-backref" href="#id98"><span class="section-number">17.4.1. </span>When should I use PHDRS command</a><a class="headerlink" href="#when-should-i-use-phdrs-command" title="Permalink to this heading"></a></h3>
<p>PHDRS command should be used only when you want to control how segments are
created by the linker.</p>
<p>If you don’t list a segment in the linker script when using PHDR’s, the segment
will not be created by the linker.</p>
<p>What this means, is that the user needs to explicit specify a segment in the
linker script for any specific needs of the loader or the image at runtime.</p>
</div>
<div class="section" id="my-output-file-is-big">
<h3><a class="toc-backref" href="#id99"><span class="section-number">17.4.2. </span>My output file is big!</a><a class="headerlink" href="#my-output-file-is-big" title="Permalink to this heading"></a></h3>
<p>An output file may become huge or big depending on how you have created the
linker script file. Most use cases</p>
<ul class="simple">
<li><p>Will show that the user uses the linker script directive PHDRS.</p></li>
<li><p>The user has specified a virtual address hardcoded in the linker script</p></li>
</ul>
<p>For figuring out the issue, its always useful to look at the Map file.</p>
<p>Look for the section where the Map file shows a bigger offset than expected.
Most often you will need to change the linker script to remove the hardcoded
virtual address for the output section.</p>
</div>
<div class="section" id="loadable-section-not-in-any-load-segment">
<h3><a class="toc-backref" href="#id100"><span class="section-number">17.4.3. </span>Loadable section not in any load segment</a><a class="headerlink" href="#loadable-section-not-in-any-load-segment" title="Permalink to this heading"></a></h3>
<p>This error is experienced when the user has a loadable section, but the user has
not assigned a PT_LOAD segment for it. You might want to look at the list of
segments and the segment assignments for each output section.</p>
</div>
<div class="section" id="segments-need-to-be-mentioned-contiguously-in-the-linker-script">
<h3><a class="toc-backref" href="#id101"><span class="section-number">17.4.4. </span>Segments need to be mentioned contiguously in the linker script</a><a class="headerlink" href="#segments-need-to-be-mentioned-contiguously-in-the-linker-script" title="Permalink to this heading"></a></h3>
<p>Segments need to be contiguous in the linker script, or the virtual address
assigned to the segment need to be correctly assigned based on where the previous
segment ended for that particular segment.</p>
<p>This is because file size and memory size of the segment needs to be calculated
correctly, and the segment needs to be declared contiguously.</p>
<p>The file size / memory size is calculated by the difference between the first output
section in the segmet and the last output section in the segment.</p>
<p>If there are segments declared in between, they will create these kinds of
duplicate sections.</p>
<p>Below is an example that has duplicate sections in the segment list.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>bss<span class="o">[</span><span class="m">10000</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
int<span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>B<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bss<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="w">  </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.data*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
!
clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
hexagon-link<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p><strong>readelf output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.outElf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>are<span class="w"> </span><span class="m">2</span><span class="w"> </span>program<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span>52Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x09c54<span class="w"> </span>0x09c54<span class="w"> </span>RWE<span class="w"> </span>0x1000
<span class="w">  </span>LOAD<span class="w">           </span>0x00b010<span class="w"> </span>0x00000010<span class="w"> </span>0x00000010<span class="w"> </span>0x00000<span class="w"> </span>0x09c40<span class="w"> </span>RW<span class="w">  </span>0x1000<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.text<span class="w"> </span>.bss<span class="w"> </span>.data
<span class="w">   </span><span class="m">01</span><span class="w">     </span>.bss
</pre></div>
</div>
</div>
<div class="section" id="getting-file-header-and-program-header-to-be-loaded">
<h3><a class="toc-backref" href="#id102"><span class="section-number">17.4.5. </span>Getting file header and program header to be loaded</a><a class="headerlink" href="#getting-file-header-and-program-header-to-be-loaded" title="Permalink to this heading"></a></h3>
<p>Often times, it may be required by the runtime loader to inspect the file header
and the program header.</p>
<p>You can use FILEHDRS and PHDRS as part of using PHDRS command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>text<span class="w"> </span>PT_LOAD<span class="w"> </span>FILEHDR<span class="w"> </span>PHDRS<span class="p">;</span>
<span class="w">  </span>data<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>SIZEOF_HEADERS<span class="p">;</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:text
<span class="w">  </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.data.data<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:data
<span class="o">}</span>
!

<span class="nv">$CLANG</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
<span class="nv">$LD</span><span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>To verify that the linker did the right thing, you can use readelf output to
figure out.</p>
<p><strong>readelf output</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>are<span class="w"> </span><span class="m">2</span><span class="w"> </span>program<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x000000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x0008c<span class="w"> </span>0x0008c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000
<span class="w">  </span>LOAD<span class="w">           </span>0x00008c<span class="w"> </span>0x0000008c<span class="w"> </span>0x0000008c<span class="w"> </span>0x00004<span class="w"> </span>0x00004<span class="w"> </span>RW<span class="w">  </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.foo
<span class="w">   </span><span class="m">01</span><span class="w">     </span>.data
</pre></div>
</div>
<p>If you see the above, the first load segment starts from offset 0, which means
the file header gets loaded when the executable runs.</p>
<p>Often times this may be required for building shared libraries, as the dynamic
loader needs the file header and program header for relocating it.</p>
</div>
<div class="section" id="using-at-along-with-loading-file-headers-and-program-headers">
<h3><a class="toc-backref" href="#id103"><span class="section-number">17.4.6. </span>Using AT along with loading file headers and program headers</a><a class="headerlink" href="#using-at-along-with-loading-file-headers-and-program-headers" title="Permalink to this heading"></a></h3>
<p>Users need to be careful when including file headers and program headers to be
loaded using PHDRS linker script command, and also set a physical address for
the section.</p>
<p>Since the file headers and program headers are loaded, linker needs to account
for the physical address when creating the segments.</p>
<p>Below is an example that shows an image built with a linker script and uses AT
linker script directive.</p>
<p><strong>PHDRS with AT Command</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="w"> </span>FILEHDR<span class="w"> </span>PHDRS<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0xd820000<span class="p">;</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="w"> </span>+<span class="w"> </span>SIZEOF_HEADERS<span class="p">;</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span>AT<span class="o">(</span>0xd820000<span class="o">)</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
!

clang<span class="w"> </span>-c<span class="w"> </span>-target<span class="w"> </span>aarch64<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w">  </span>-ffunction-sections<span class="w"> </span>-fno-asynchronous-unwind-tables
ld.eld<span class="w"> </span>-march<span class="w"> </span>aarch64<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>Here the linker script shows that the text section has a physical address of
0xd820000, but the user also has said that the FILEHDR and PHDRS to be loaded as
part of the load segment.</p>
<p>Linker automatically moves the physical address of the segment to satisfy that
the text section has a physical address that can be met as per user needs.</p>
<p>To fix the problem and account for the adjustment of physical addresses, the
user needs to make sure that the physical address assigned accounts for the
SIZEOF_HEADERS increase.</p>
<p>Recommendation : The user also can drop the usage of AT which seems to be
unnecessary to simplify the build step.</p>
<p><strong>Linker Script Fix</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="w"> </span>FILEHDR<span class="w"> </span>PHDRS<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0xd820000<span class="p">;</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="w"> </span>+<span class="w"> </span>SIZEOF_HEADERS<span class="p">;</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span>AT<span class="o">(</span>0xd820080<span class="o">)</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
!
</pre></div>
</div>
</div>
<div class="section" id="using-phdr-flags">
<h3><a class="toc-backref" href="#id104"><span class="section-number">17.4.7. </span>Using PHDR flags</a><a class="headerlink" href="#using-phdr-flags" title="Permalink to this heading"></a></h3>
<p>Developers can use PHDR flags to convey information from the elf image built to
the loader.</p>
<p>The ELF specification provides a convenient way to record this information using
phdr flags.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#define PF_MASKOS       0x0ff00000      /* OS-specific */</span>
<span class="c1">#define PF_MASKPROC     0xf0000000      /* Processor-specific */</span>
</pre></div>
</div>
<p>All bits included in the <em>PF_MASKOS</em> mask are reserved for operating system-specific
semantics.</p>
<p>All bits included in the PF_MASKPROC mask are reserved for processor-specific
semantics. If meanings are specified, the processor supplement explains them.</p>
<p>An example of setting this flag is as below :-</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="w"> </span>FLAGS<span class="w"> </span><span class="o">(</span>0x03000000<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.*<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
</pre></div>
</div>
<p>Using the above linker script, you have a segment “A” that contains loadable text
but with a OS specific property recorded in the program header.</p>
</div>
<div class="section" id="loading-only-the-program-header">
<h3><a class="toc-backref" href="#id105"><span class="section-number">17.4.8. </span>Loading only the program header</a><a class="headerlink" href="#loading-only-the-program-header" title="Permalink to this heading"></a></h3>
<p>In the above example, we illustrated how an user can load the file header and
the program header.</p>
<p>Sometimes it may be required that the user does not want file header but only
program header to be loaded.</p>
<p>Below example illustrates the behavior:</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">;</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>text<span class="w"> </span>PT_LOAD<span class="w"> </span>PHDRS<span class="p">;</span>
<span class="w">  </span>data<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>SIZEOF_HEADERS<span class="p">;</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:text
<span class="w">  </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.data.data<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:data
<span class="o">}</span>
!

<span class="nv">$CC</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
<span class="nv">$LD</span><span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>You can inspect the resulting executable to see if program headers have been
loaded.</p>
<p><strong>readelf output</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>are<span class="w"> </span><span class="m">2</span><span class="w"> </span>program<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x000034<span class="w"> </span>0x00000034<span class="w"> </span>0x00000034<span class="w"> </span>0x00058<span class="w"> </span>0x00058<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000
<span class="w">  </span>LOAD<span class="w">           </span>0x00008c<span class="w"> </span>0x0000008c<span class="w"> </span>0x0000008c<span class="w"> </span>0x00004<span class="w"> </span>0x00004<span class="w"> </span>RW<span class="w">  </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.foo
<span class="w">   </span><span class="m">01</span><span class="w">     </span>.data
</pre></div>
</div>
<p>If you see the above, the first load segment starts from offset 34, which means
the program header gets loaded when the executable runs.</p>
</div>
</div>
<div class="section" id="string-merging">
<h2><a class="toc-backref" href="#id106"><span class="section-number">17.5. </span>String Merging</a><a class="headerlink" href="#string-merging" title="Permalink to this heading"></a></h2>
<div class="section" id="merging-order">
<h3><a class="toc-backref" href="#id107"><span class="section-number">17.5.1. </span>Merging order</a><a class="headerlink" href="#merging-order" title="Permalink to this heading"></a></h3>
<p>On 8.7, the linker deduplicates strings according to link order. On &gt;= 8.8
duplicate strings are decided by script rule order. Example below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.s<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
.section<span class="w"> </span>.rodata1.str1.1,<span class="s2">&quot;aMS&quot;</span>,@progbits,1
.string<span class="w"> </span><span class="s2">&quot;abc&quot;</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.s<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
.section<span class="w"> </span>.rodata1.str1.2,<span class="s2">&quot;aMS&quot;</span>,@progbits,1
.string<span class="w"> </span><span class="s2">&quot;abc&quot;</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.rodata<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="m">2</span>.o<span class="o">(</span>.rodata*<span class="o">)</span>
<span class="w">      </span><span class="m">1</span>.o<span class="o">(</span>.rodata*<span class="o">)</span>
<span class="w">   </span><span class="o">}</span>
<span class="o">}</span>
!

<span class="c1"># link order 1.o, 2.o</span>
<span class="c1"># rule order 2.o, 1.o</span>
ld.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">2</span>.o
</pre></div>
</div>
<p>On 8.7, the string “abc” from 1.o will be included and the string from 2.o will
be merged with it (according to link order). On &gt;=8.8, the string from 2.o will
be included and string from 1.o merged with it (according to rule order). This
difference is reflected in the map file.</p>
</div>
</div>
<div class="section" id="hexagon">
<h2><a class="toc-backref" href="#id108"><span class="section-number">17.6. </span>Hexagon</a><a class="headerlink" href="#hexagon" title="Permalink to this heading"></a></h2>
<div class="section" id="convert-binary-file-to-hexagon">
<h3><a class="toc-backref" href="#id109"><span class="section-number">17.6.1. </span>Convert binary file to Hexagon</a><a class="headerlink" href="#convert-binary-file-to-hexagon" title="Permalink to this heading"></a></h3>
<p>If you want to convert a binary file file1.bin to hexagon, you can use objcopy.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hexagon-llvm-objcopy<span class="w"> </span>-I<span class="w"> </span>binary<span class="w"> </span>file1.bin<span class="w"> </span>-O<span class="w"> </span>elf32-hexagon<span class="w"> </span>test.o
</pre></div>
</div>
</div>
<div class="section" id="hexagon-specific-behavior">
<h3><a class="toc-backref" href="#id110"><span class="section-number">17.6.2. </span>Hexagon specific behavior</a><a class="headerlink" href="#hexagon-specific-behavior" title="Permalink to this heading"></a></h3>
<div class="section" id="phdrs">
<h4><a class="toc-backref" href="#id111"><span class="section-number">17.6.2.1. </span>PHDRS</a><a class="headerlink" href="#phdrs" title="Permalink to this heading"></a></h4>
<p>Hexagon static link and dynamic linked executables dont rely on PHDR’s to be
available for the dynamic loader.</p>
<p>If there is a need for you to load PHDR’s, you need to look at
Gettingfileheaderandprogramheadertobeloaded</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>PHDRS not covered by load segment</strong></p>
<p>Often times, if you are using readelf on a dynamic executable for hexagon, you may get an error</p>
<p>readelf: Error: the PHDR segment is not covered by a LOAD segment</p>
<p>This is because of the above assumption that Hexagon dynamic executables dont rely on PHDR’s to be loaded and available to the dynamic loader.</p>
<p>Use hexagon-llvm-readelf to overcome this error.</p>
</div>
</div>
<div class="section" id="why-common-input-section-description-does-not-affect-all-the-common-symbols">
<h4><a class="toc-backref" href="#id112"><span class="section-number">17.6.2.2. </span>Why <em>COMMON</em> input section description does not affect all the common symbols?</a><a class="headerlink" href="#why-common-input-section-description-does-not-affect-all-the-common-symbols" title="Permalink to this heading"></a></h4>
<p>For the hexagon target, by default, the linker maps small common symbols to
internal sections, .scommon.x, where x can be 1, 2, 4 and 8. The x represents
the size of the common symbol in bytes. For example, .scommon.4 will match common
symbols having size 4 bytes. Therefore, to write rules for small common symbols,
.scommon.x input section description should be used. This allows writing rules
affecting common symbols with greater precision</p>
<p>For Example, to match:</p>
<ul class="simple">
<li><p>all common symbols of size less than or equal to 2 bytes to the output section
<em>.small_commons_2</em></p></li>
<li><p>all common symbols of size greater than 2 bytes but less than or equal to 8
bytes to the output section <em>.small_commons_8.</em></p></li>
</ul>
<p>The following linker script SECTIONS command can be used:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>*<span class="o">(</span>.text*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">    </span>.small_commons_2:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.scommon.1<span class="w"> </span>.scommon.2<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">    </span>.small_commons_8:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.scommon.4<span class="w"> </span>.scommon.8<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">    </span>.bss:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>COMMON<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>*(COMMON) input section description will match all common symbols of size greater than 8 bytes.</p>
<p><strong>To verify the linker script</strong></p>
<p>Test C code</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="kt">short</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="kt">double</span><span class="w"> </span><span class="n">e</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</pre></div>
</div>
<p>Compile and Link Step:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-c<span class="w"> </span>test.c<span class="w"> </span>-o<span class="w"> </span>test.o
hexagon-link<span class="w"> </span>test.o<span class="w"> </span>-o<span class="w"> </span>test.elf<span class="w"> </span>-T<span class="w"> </span>test.linker.script
</pre></div>
</div>
<p>Verify:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hexagon-readelf<span class="w"> </span>-Ss<span class="w"> </span>common.elf
</pre></div>
</div>
<p>readelf output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>There<span class="w"> </span>are<span class="w"> </span><span class="m">8</span><span class="w"> </span>section<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span>0x11c0:

Section<span class="w"> </span>Headers:
<span class="w">  </span><span class="o">[</span>Nr<span class="o">]</span><span class="w"> </span>Name<span class="w">              </span>Type<span class="w">            </span>Address<span class="w">  </span>Off<span class="w">    </span>Size<span class="w">   </span>ES<span class="w"> </span>Flg<span class="w"> </span>Lk<span class="w"> </span>Inf<span class="w"> </span>Al
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w">                   </span>NULL<span class="w">            </span><span class="m">00000000</span><span class="w"> </span><span class="m">000000</span><span class="w"> </span><span class="m">000000</span><span class="w"> </span><span class="m">00</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">0</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">1</span><span class="o">]</span><span class="w"> </span>.small_commons_2<span class="w">  </span>NOBITS<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">001000</span><span class="w"> </span><span class="m">000004</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>WA<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">2</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>.small_commons_8<span class="w">  </span>NOBITS<span class="w">          </span><span class="m">00000008</span><span class="w"> </span><span class="m">001000</span><span class="w"> </span><span class="m">000010</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>WA<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">8</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">3</span><span class="o">]</span><span class="w"> </span>.bss<span class="w">              </span>NOBITS<span class="w">          </span><span class="m">00000018</span><span class="w"> </span><span class="m">001000</span><span class="w"> </span><span class="m">000320</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>WA<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">8</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">4</span><span class="o">]</span><span class="w"> </span>.comment<span class="w">          </span>PROGBITS<span class="w">        </span><span class="m">00000000</span><span class="w"> </span><span class="m">001000</span><span class="w"> </span><span class="m">000065</span><span class="w"> </span><span class="m">01</span><span class="w">  </span>MS<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">5</span><span class="o">]</span><span class="w"> </span>.shstrtab<span class="w">         </span>STRTAB<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">001065</span><span class="w"> </span>00004b<span class="w"> </span><span class="m">00</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">6</span><span class="o">]</span><span class="w"> </span>.symtab<span class="w">           </span>SYMTAB<span class="w">          </span><span class="m">00000000</span><span class="w"> </span>0010b0<span class="w"> </span>0000c0<span class="w"> </span><span class="m">10</span><span class="w">      </span><span class="m">7</span><span class="w">   </span><span class="m">6</span><span class="w">  </span><span class="m">4</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">7</span><span class="o">]</span><span class="w"> </span>.strtab<span class="w">           </span>STRTAB<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">001170</span><span class="w"> </span>00004a<span class="w"> </span><span class="m">00</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>
Key<span class="w"> </span>to<span class="w"> </span>Flags:
<span class="w">  </span>W<span class="w"> </span><span class="o">(</span>write<span class="o">)</span>,<span class="w"> </span>A<span class="w"> </span><span class="o">(</span>alloc<span class="o">)</span>,<span class="w"> </span>X<span class="w"> </span><span class="o">(</span>execute<span class="o">)</span>,<span class="w"> </span>M<span class="w"> </span><span class="o">(</span>merge<span class="o">)</span>,<span class="w"> </span>S<span class="w"> </span><span class="o">(</span>strings<span class="o">)</span>,<span class="w"> </span>I<span class="w"> </span><span class="o">(</span>info<span class="o">)</span>,
<span class="w">  </span>L<span class="w"> </span><span class="o">(</span>link<span class="w"> </span>order<span class="o">)</span>,<span class="w"> </span>O<span class="w"> </span><span class="o">(</span>extra<span class="w"> </span>OS<span class="w"> </span>processing<span class="w"> </span>required<span class="o">)</span>,<span class="w"> </span>G<span class="w"> </span><span class="o">(</span>group<span class="o">)</span>,<span class="w"> </span>T<span class="w"> </span><span class="o">(</span>TLS<span class="o">)</span>,
<span class="w">  </span>C<span class="w"> </span><span class="o">(</span>compressed<span class="o">)</span>,<span class="w"> </span>x<span class="w"> </span><span class="o">(</span>unknown<span class="o">)</span>,<span class="w"> </span>o<span class="w"> </span><span class="o">(</span>OS<span class="w"> </span>specific<span class="o">)</span>,<span class="w"> </span>E<span class="w"> </span><span class="o">(</span>exclude<span class="o">)</span>,
<span class="w">  </span>R<span class="w"> </span><span class="o">(</span>retain<span class="o">)</span>,<span class="w"> </span>p<span class="w"> </span><span class="o">(</span>processor<span class="w"> </span>specific<span class="o">)</span>

Symbol<span class="w"> </span>table<span class="w"> </span><span class="s1">&#39;.symtab&#39;</span><span class="w"> </span>contains<span class="w"> </span><span class="m">12</span><span class="w"> </span>entries:
<span class="w">   </span>Num:<span class="w">    </span>Value<span class="w">  </span>Size<span class="w"> </span>Type<span class="w">    </span>Bind<span class="w">   </span>Vis<span class="w">       </span>Ndx<span class="w"> </span>Name
<span class="w">     </span><span class="m">0</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>UND
<span class="w">     </span><span class="m">1</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>.small_commons_2
<span class="w">     </span><span class="m">2</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">4</span><span class="w"> </span>.comment
<span class="w">     </span><span class="m">3</span>:<span class="w"> </span><span class="m">00000008</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>.small_commons_8
<span class="w">     </span><span class="m">4</span>:<span class="w"> </span><span class="m">00000018</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>SECTION<span class="w"> </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">     </span><span class="m">3</span><span class="w"> </span>.bss
<span class="w">     </span><span class="m">5</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>FILE<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>common.c
<span class="w">     </span><span class="m">6</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">     </span><span class="m">1</span><span class="w"> </span>OBJECT<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>a
<span class="w">     </span><span class="m">7</span>:<span class="w"> </span><span class="m">00000002</span><span class="w">     </span><span class="m">2</span><span class="w"> </span>OBJECT<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">1</span><span class="w"> </span>b
<span class="w">     </span><span class="m">8</span>:<span class="w"> </span><span class="m">00000008</span><span class="w">     </span><span class="m">4</span><span class="w"> </span>OBJECT<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>c
<span class="w">     </span><span class="m">9</span>:<span class="w"> </span><span class="m">00000010</span><span class="w">     </span><span class="m">8</span><span class="w"> </span>OBJECT<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">2</span><span class="w"> </span>d
<span class="w">    </span><span class="m">10</span>:<span class="w"> </span><span class="m">00000018</span><span class="w">   </span><span class="m">800</span><span class="w"> </span>OBJECT<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">     </span><span class="m">3</span><span class="w"> </span>e
<span class="w">    </span><span class="m">11</span>:<span class="w"> </span><span class="m">00000339</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>NOTYPE<span class="w">  </span>GLOBAL<span class="w"> </span>DEFAULT<span class="w">   </span>ABS<span class="w"> </span>__end
</pre></div>
</div>
<p>readelf output shows what we expected:</p>
<ul class="simple">
<li><p>symbols a, and b are matched to the output section <em>.small_commons_2</em></p></li>
<li><p>symbols c, and d are matched to the output section <em>.small_commons_8</em></p></li>
<li><p>symbol e is matched to the output section <em>.bss.</em></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The linker option -G&lt;size&gt; can be used to specify the maximum size for the
small common symbols. For example, -G4 option specifies the maximum size for the
small common symbols to be 4 bytes. By default, the linker assumes the maximum
size of the small common symbols to be 8 bytes.</p>
</div>
</div>
<div class="section" id="how-to-disable-small-common-symbol-functionality">
<h4><a class="toc-backref" href="#id113"><span class="section-number">17.6.2.3. </span>How to disable small common symbol functionality?</a><a class="headerlink" href="#how-to-disable-small-common-symbol-functionality" title="Permalink to this heading"></a></h4>
<p>Small common symbol functionality can effectively be disabled by using -G0 linker
command-line option. -G&lt;size&gt; option specifies the maximum size for the small
common symbols.</p>
<p><em>-G0</em> will have the following effects:</p>
<ul class="simple">
<li><p>Small common symbols will map to COMMON input section description instead of
.scommon.x input section descriptions in the linker script</p></li>
<li><p>If not specified otherwise, small common symbols will be stored in .bss output
section instead of .sdata output section.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="risc-v">
<h2><a class="toc-backref" href="#id114"><span class="section-number">17.7. </span>RISC-V</a><a class="headerlink" href="#risc-v" title="Permalink to this heading"></a></h2>
<div class="section" id="show-linker-relaxation-output">
<h3><a class="toc-backref" href="#id115"><span class="section-number">17.7.1. </span>Show Linker relaxation output</a><a class="headerlink" href="#show-linker-relaxation-output" title="Permalink to this heading"></a></h3>
<p>The linker shows relaxation output by using the option –verbose. In future there
will be a better option to annotate where linker performed relaxation.</p>
</div>
<div class="section" id="disable-relaxation">
<h3><a class="toc-backref" href="#id116"><span class="section-number">17.7.2. </span>Disable Relaxation</a><a class="headerlink" href="#disable-relaxation" title="Permalink to this heading"></a></h3>
<p>You can disable relaxation in the linker using the option, –no-relax. This option
disables all of linker relaxation except handling of alignment.</p>
</div>
<div class="section" id="disable-compressed-relaxation">
<h3><a class="toc-backref" href="#id117"><span class="section-number">17.7.3. </span>Disable compressed relaxation</a><a class="headerlink" href="#disable-compressed-relaxation" title="Permalink to this heading"></a></h3>
<p>You can disable linker relaxing to compressed instructions by using –no-c-relax flag.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id118"><span class="section-number">17.8. </span>Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p><strong>Response Files</strong></p>
<ul>
<li><p>Run ld.eld &#64;&lt;response-file&gt; -o &lt;elf&gt;
* Response-file contains the command line arguments. Any valid linker argument</p>
<blockquote>
<div><p>can be passed to the linker through the response-file and they are expanded
and placed at “&#64;&lt;response-file&gt;” position.</p>
</div></blockquote>
<ul class="simple">
<li><p>For e.g. ld.eld –help, the “–help” can go in a file x.cmd and passed to the linker using the ‘&#64;’ symbol.
* <strong>ld.eld &#64;x.cmd -o &lt;elf&gt;</strong></p></li>
<li><p>&#64;&lt;response-file&gt; removes the constraint of max command line length, so, a long
list of arguments can be passed to the linker this way.</p></li>
<li><p>A “&#64;response-file” can appear inside another response-file as well, allowing recursive processing of arguments.</p></li>
<li><p>Unrecognized arguments in the file will be ignored with a warning message, e.g. Warning: Unrecognized option ‘–bad’.</p></li>
<li><p>Invalid argument or missing response-file will cause linker to error out.</p></li>
</ul>
</li>
<li><p>Reference: <a class="reference external" href="https://llvm.org/docs/CommandLine.html#response-files">https://llvm.org/docs/CommandLine.html#response-files</a></p></li>
</ul>
</div>
<div class="section" id="linker-plugin-framework">
<h2><a class="toc-backref" href="#id119"><span class="section-number">17.9. </span>Linker Plugin Framework</a><a class="headerlink" href="#linker-plugin-framework" title="Permalink to this heading"></a></h2>
<div class="section" id="what-are-the-differences-between-sectionmatcherplugin-and-sectioniteratorplugin">
<h3><a class="toc-backref" href="#id120"><span class="section-number">17.9.1. </span>What are the differences between SectionMatcherPlugin and SectionIteratorPlugin?</a><a class="headerlink" href="#what-are-the-differences-between-sectionmatcherplugin-and-sectioniteratorplugin" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>SectionMatcherPlugin is run before rule-matching and garbage-collection whereas
SectionIteratorPlugin is run after rule-matching and garbage-collection.As a
consequence of this, SectionIteratorPlugin callbacks have access to garbage-collected
sections, discarded sections and rule matching information among other things.</p></li>
<li><p>SectionIteratorPlugin does not call ‘SectionIteratorPlugin::Process’ callback
hook for garbage-collected sections. It is though called for discarded sections.
On the other hand, SectionMatcherPlugin call ‘SectionMatcherPlugin::Process’ callback
hook for each input section.</p></li>
</ul>
</div>
</div>
<div class="section" id="symbol-resolution">
<h2><a class="toc-backref" href="#id121"><span class="section-number">17.10. </span>Symbol Resolution</a><a class="headerlink" href="#symbol-resolution" title="Permalink to this heading"></a></h2>
<div class="section" id="symbol-wrapping">
<h3><a class="toc-backref" href="#id122"><span class="section-number">17.10.1. </span>Symbol wrapping</a><a class="headerlink" href="#symbol-wrapping" title="Permalink to this heading"></a></h3>
<div class="section" id="what-is-symbol-wrapping-and-how-to-use-it">
<h4><a class="toc-backref" href="#id123"><span class="section-number">17.10.1.1. </span>What is symbol wrapping and how to use it?</a><a class="headerlink" href="#what-is-symbol-wrapping-and-how-to-use-it" title="Permalink to this heading"></a></h4>
<p>Symbol wrapping allows to use a wrapper symbol in-place of the original symbol,
without any modification to the source code. When symbol wrapping is used for
the symbol ‘symbol’, then all undefined references to ‘symbol’ is resolved
to ‘__wrap_symbol’, and all undefined references to ‘__real_symbol’ is resolved
to ‘symbol’. To enable symbol wrapping, use ‘–wrap=symbol’ option.</p>
</div>
<div class="section" id="where-is-symbol-wrapping-helpful">
<h4><a class="toc-backref" href="#id124"><span class="section-number">17.10.1.2. </span>Where is symbol wrapping helpful?</a><a class="headerlink" href="#where-is-symbol-wrapping-helpful" title="Permalink to this heading"></a></h4>
<p>Symbol wrapping is typically used for wrapping system/standard function calls.
For example, a ‘malloc’ wrapper function can be used to keep track of bytes
allocated by ‘malloc’, and a ‘printf’ wrapper function can be used to add a
timestamp in the printf output.</p>
</div>
<div class="section" id="example">
<h4><a class="toc-backref" href="#id125"><span class="section-number">17.10.1.3. </span>Example</a><a class="headerlink" href="#example" title="Permalink to this heading"></a></h4>
<p>The below program provides a wrapper function for ‘my_malloc’ function.
The wrapper function prints the number of bytes that is requested by user using
‘my_malloc’, and then calls ‘my_malloc’ to do the actual memory allocation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">#include &lt;stdio.h&gt;</span>

<span class="s">void *my_malloc(size_t sz);</span>

<span class="s">int main() {</span>
<span class="s">  int *p = my_malloc(sizeof(int)); // Resolves to __wrap_my_malloc</span>
<span class="s">  *p = 11;</span>
<span class="s">  printf(&quot;p: %d\n&quot;, *p);</span>
<span class="s">  return *p;</span>
<span class="s">}</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;2.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">#include &lt;stdlib.h&gt;</span>
<span class="s">#include &lt;stdio.h&gt;</span>

<span class="s">void *my_malloc(size_t sz) { return malloc(sz); }</span>

<span class="s">void *__real_my_malloc(size_t sz);</span>
<span class="s">void *__wrap_my_malloc(size_t sz) {</span>
<span class="s">  printf(&quot;&#39;%u&#39; bytes requested using my_malloc\n&quot;, sz);</span>
<span class="s">  return __real_my_malloc(sz); // Resolves to &#39;my_malloc&#39;</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-target<span class="w"> </span>hexagon<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.wrapped.elf<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span><span class="m">2</span>.c<span class="w"> </span><span class="m">3</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-g<span class="w"> </span>-Wl,--wrap<span class="o">=</span>my_malloc
hexagon-sim<span class="w"> </span><span class="m">1</span>.wrapped.elf
<span class="c1"># Output:</span>
<span class="c1"># &#39;4&#39; bytes requested using my_malloc</span>
<span class="c1"># p: 11</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="build-time-issues">
<h2><a class="toc-backref" href="#id126"><span class="section-number">17.11. </span>Build time issues</a><a class="headerlink" href="#build-time-issues" title="Permalink to this heading"></a></h2>
<div class="section" id="common-to-all-targets">
<h3><a class="toc-backref" href="#id127"><span class="section-number">17.11.1. </span>Common to all targets</a><a class="headerlink" href="#common-to-all-targets" title="Permalink to this heading"></a></h3>
<div class="section" id="lto-is-showing-undefined-symbol-when-symbol-is-defined">
<h4><a class="toc-backref" href="#id128"><span class="section-number">17.11.1.1. </span>LTO is showing undefined symbol when symbol is defined</a><a class="headerlink" href="#lto-is-showing-undefined-symbol-when-symbol-is-defined" title="Permalink to this heading"></a></h4>
<p>The questions to answer when there is an issue like this is to, see if the symbol
is in an archive library or an object file.</p>
<p>If its an archive library, make sure that the library is built using <strong>llvm-ar</strong></p>
<p>The default archiver which handles ELF files does not handle <strong>Bitcode</strong> which is
the format that LLVM uses.</p>
<p>This is a must for LTO use.</p>
<p>If you have a reproducer using the reproduce option, you can use this snippet to
replace all your archive files using llvm-ar</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>grep<span class="w"> </span><span class="s2">&quot;\.lib&quot;</span><span class="w"> </span>mapping.ini<span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/.*=//&#39;</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$file</span><span class="p">;</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span>cp<span class="w"> </span>../<span class="nv">$file</span><span class="w"> </span>.<span class="p">;</span><span class="w"> </span>ar<span class="w"> </span>x<span class="w"> </span><span class="nv">$file</span><span class="p">;</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$file</span><span class="p">;</span><span class="w"> </span>llvm-ar<span class="w"> </span>cr<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>*.o<span class="p">;</span><span class="w"> </span>cp<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>..<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="lto-is-showing-could-not-set-section-name-for-the-symbol">
<h4><a class="toc-backref" href="#id129"><span class="section-number">17.11.1.2. </span>LTO is showing could not set section name for the symbol</a><a class="headerlink" href="#lto-is-showing-could-not-set-section-name-for-the-symbol" title="Permalink to this heading"></a></h4>
<p>This note is emitted while reading the bitcode files (only part of LTO flow, as
in non-LTO flow object files are read) for symbols defined using the ‘.set’ directive.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>extern void someSymbol_relocated (void) __attribute__((__visibility__(“hidden”)));</p>
<p>__asm(“.set someSymbol_relocated, 0x00005730”);</p>
</div>
<p>This note means that no input section was found for this symbol in the input bitcode
file as these symbols are found to be undefined, due to assembler directive usage</p>
<p>The LTO flow, though, happens at link time but doesn’t have visibility to mapping
symbol address set with .set directive to symbols.</p>
</div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id130"><span class="section-number">17.12. </span>Hexagon</a><a class="headerlink" href="#id5" title="Permalink to this heading"></a></h2>
<div class="section" id="relocation-overflows-to-function-symbols">
<h3><a class="toc-backref" href="#id131"><span class="section-number">17.12.1. </span>Relocation overflows to function symbols</a><a class="headerlink" href="#relocation-overflows-to-function-symbols" title="Permalink to this heading"></a></h3>
<p>A relocation overflow can show up when the linker cannot insert a trampoline to
reach that symbol.</p>
<p>Most often the problems would be that the symbol may be <em>Undefined Weak.</em></p>
<p>The programmer would have specified a <em>__attribute__((weak))</em> while declaring the function in the header file.</p>
<p>Also look at Weakreferencesanddefinitions why the linker was not seeing the definition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A common work around for this sort of problem is to remove the __attribute__((weak)) from the prototype of the function.</p>
</div>
</div>
<div class="section" id="debugging-linker-crash-issues">
<h3><a class="toc-backref" href="#id132"><span class="section-number">17.12.2. </span>Debugging Linker crash issues</a><a class="headerlink" href="#debugging-linker-crash-issues" title="Permalink to this heading"></a></h3>
<div class="section" id="step-1">
<h4><a class="toc-backref" href="#id133"><span class="section-number">17.12.2.1. </span>Step 1</a><a class="headerlink" href="#step-1" title="Permalink to this heading"></a></h4>
<p>Look for the error message produced by the linker, if it says Unexpected Linker
behavior continue to the next step.</p>
<p>If it shows the problem was in the user plugin, debug the plugin and figure out
what the issue is.</p>
</div>
<div class="section" id="step-2">
<h4><a class="toc-backref" href="#id134"><span class="section-number">17.12.2.2. </span>Step 2</a><a class="headerlink" href="#step-2" title="Permalink to this heading"></a></h4>
<p>Check to see if there any system environment variables set. Important variables to note are :-</p>
<ul class="simple">
<li><p>LD_LIBRARY_PATH</p></li>
<li><p>PATH (Windows)</p></li>
</ul>
<p>Remove the values set and see if the error disappears</p>
</div>
<div class="section" id="step-3">
<h4><a class="toc-backref" href="#id135"><span class="section-number">17.12.2.3. </span>Step 3</a><a class="headerlink" href="#step-3" title="Permalink to this heading"></a></h4>
<p>If the linker is still crashing, check to see if the cause is due to multithreading plugins.</p>
<p>You can then use –no-threads and see if the error disappears</p>
</div>
<div class="section" id="step-4">
<h4><a class="toc-backref" href="#id136"><span class="section-number">17.12.2.4. </span>Step 4</a><a class="headerlink" href="#step-4" title="Permalink to this heading"></a></h4>
<p>Sometimes the plugin may write some data into linker memory and corrupt some data structures.</p>
<p>Build the plugin with sanitizer enabled, and see if you can spot any sanitizer issues in the plugin.</p>
</div>
<div class="section" id="step-5">
<h4><a class="toc-backref" href="#id137"><span class="section-number">17.12.2.5. </span>Step 5</a><a class="headerlink" href="#step-5" title="Permalink to this heading"></a></h4>
<p>If it still is crashing then contact the support teams for help debugging the issue.</p>
</div>
</div>
</div>
<div class="section" id="arm">
<h2><a class="toc-backref" href="#id138"><span class="section-number">17.13. </span>ARM</a><a class="headerlink" href="#arm" title="Permalink to this heading"></a></h2>
<div class="section" id="sbrel-relocations-fixing-relocation-error-when-applying-relocation-r-arm-sbrel32">
<h3><a class="toc-backref" href="#id139"><span class="section-number">17.13.1. </span>SBREL relocations : Fixing relocation error when applying relocation ‘R_ARM_SBREL32’</a><a class="headerlink" href="#sbrel-relocations-fixing-relocation-error-when-applying-relocation-r-arm-sbrel32" title="Permalink to this heading"></a></h3>
<p>SBREL relocation stands for segment base relative relocations. There needs to be
only one segment defined that is segment base relative in the image.</p>
<p>All variables and access to the variables need to be placed in that segment.</p>
<p>Example and how to fix :-</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="p">;</span>
int<span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">;</span>
int<span class="w"> </span>main<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>foo<span class="w"> </span>+<span class="w"> </span>bar<span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>TEXT<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>SBREL_SEGMENT<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>SOMETHING_ELSE<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:TEXT
<span class="w">  </span>.ARM.exidx<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.ARM.exidx*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">  </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.data.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:SBREL_SEGMENT
<span class="w">  </span>.bss<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>COMMON<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:SOMETHING_ELSE
<span class="o">}</span>
!

clang<span class="w"> </span>-c<span class="w"> </span>-frwpi<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-target<span class="w"> </span>arm<span class="w"> </span>-fdata-sections<span class="w"> </span>-g3
ld.eld<span class="w"> </span>-march<span class="w"> </span>arm<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span>x
</pre></div>
</div>
<p>Error: R_ARM_SBREL32 Relocation Mismatch for symbol bar defined in 1.o[.text] has a different load segment
Error: Relocation error when applying relocation <a href="#id6"><span class="problematic" id="id7">`</span></a>R_ARM_SBREL32’ for symbol <a href="#id8"><span class="problematic" id="id9">`</span></a>bar’ referred from 1.o[.text] symbol defined in 1.o[.data.bar]
Error: R_ARM_SBREL32 Relocation Mismatch for symbol bar defined in 1.o[.debug_info] has a different load segment
Error: Relocation error when applying relocation <a href="#id10"><span class="problematic" id="id11">`</span></a>R_ARM_SBREL32’ for symbol <a href="#id12"><span class="problematic" id="id13">`</span></a>bar’ referred from 1.o[.debug_info] symbol defined in 1.o[.data.bar]
Fatal: Linking had errors.</p>
<p><strong>Fixed linker script for this example</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>TEXT<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>SBREL_SEGMENT<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>SOMETHING_ELSE<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:TEXT
<span class="w">  </span>.ARM.exidx<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.ARM.exidx*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">  </span>.data<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.data.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:SBREL_SEGMENT
<span class="w">  </span>.bss<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>COMMON<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:SBREL_SEGMENT
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-resolve-the-warning-compact-option-needs-physical-address-aligned-with-file-offsets">
<h3><a class="toc-backref" href="#id140"><span class="section-number">17.13.2. </span>How to resolve the warning ‘Compact Option needs physical address aligned with File offsets’</a><a class="headerlink" href="#how-to-resolve-the-warning-compact-option-needs-physical-address-aligned-with-file-offsets" title="Permalink to this heading"></a></h3>
<p>Before we see how to resolve this warning, let’s first discuss what is <a class="reference internal" href="options/ARMLinkerOptions.html#cmdoption-compact"><code class="xref std std-option docutils literal notranslate"><span class="pre">--compact</span></code></a> option and
the reason for this warning.</p>
<p><a class="reference internal" href="options/ARMLinkerOptions.html#cmdoption-compact"><code class="xref std std-option docutils literal notranslate"><span class="pre">--compact</span></code></a> option, as the name suggests, allows to generate more compact (smaller) images.
However, this benefit comes with the added restriction that for each <code class="docutils literal notranslate"><span class="pre">LOAD</span></code> segment,
physical addresses must be aligned with the file offsets. This means the
the difference between physical address and file offset should should be the same
for each byte within a <code class="docutils literal notranslate"><span class="pre">LOAD</span></code> segment.</p>
<p>This implies that the physical addresses must also be aligned with
virtual memory addresses within a <code class="docutils literal notranslate"><span class="pre">LOAD</span></code> segment. This is because
the linker ensures that virtual memory addresses are always aligned with file offsets.</p>
<p>It is user’s responsibility to ensure that this restriction is satisfied. The linker reports the warning
<em>Compact Option needs physical address aligned with File offsets</em> if the restriction is not satified.
This warning should not be ignored because images not satisfying this restriction may have runtime errors.</p>
<p>Let’s analyze this issue with the help of an example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

cat<span class="w"> </span>&gt;1.c<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">int foo = 1;</span>

<span class="s">__attribute__((aligned(8)))</span>
<span class="s">int bar = 3;</span>

<span class="s">int baz = 5;</span>
<span class="s">EOF</span>

cat<span class="w"> </span>&gt;script.t<span class="w"> </span><span class="s">&lt;&lt;\EOF</span>
<span class="s">PHDRS {</span>
<span class="s">  TEXT PT_LOAD;</span>
<span class="s">}</span>

<span class="s">SECTIONS {</span>
<span class="s">  FOO 0x1000 : AT(0x4) { *(*foo*) } :TEXT</span>
<span class="s">  BAR : { *(*bar*) } :TEXT</span>
<span class="s">  BAZ : { *(*baz*) } :TEXT</span>
<span class="s">}</span>
<span class="s">EOF</span>

clang<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections
arm-link<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span>.out<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-Map<span class="w"> </span><span class="m">1</span>.map.txt<span class="w"> </span>--compact
</pre></div>
</div>
<p>We get the following warnings on running this example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">Physical</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">segment</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">congruent</span><span class="w"> </span><span class="n">modulo</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">segment</span><span class="p">.</span><span class="w"> </span><span class="n">Mismatch</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">segment</span><span class="w"> </span><span class="n">FOO</span>
<span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">Compact</span><span class="w"> </span><span class="n">Option</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">physical</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">aligned</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">offsets</span><span class="p">.</span><span class="w"> </span><span class="n">Mismatch</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">BAR</span>
<span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">Compact</span><span class="w"> </span><span class="n">Option</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">physical</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">aligned</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">offsets</span><span class="p">.</span><span class="w"> </span><span class="n">Mismatch</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">BAZ</span>
</pre></div>
</div>
<p>Why do we get this warning here and how do we fix it? Let’s see.</p>
<p>For brevity, I will use VMA for virtual memory address and LMA (load memory address) for physical address.</p>
<p><code class="docutils literal notranslate"><span class="pre">FOO</span></code> size is 0x4, VMA is 0x1000 and LMA is 0x4. The difference between the
VMA and the LMA is 0xffc. We may expect <code class="docutils literal notranslate"><span class="pre">BAR</span></code> VMA to be 0x1004 (0x1000 + 0x4)
and the LMA to be 0x8 (0x4 + 0x4). However, the linker has to bump this VMA to 0x1008 to
satisfy <code class="docutils literal notranslate"><span class="pre">BAR</span></code> 8-byte alignment requirement. No bump is required for the LMA as it is
already 8-byte aligned. This bump to VMA causes misalignment between VMA and LMA, as
seen from VMA - LMA = 0x1000, whereas previously the difference was 0xffc. Hence we
also have misalignment between file offsets and LMA
(VMA and file offsets are <em>always</em> aligned) and the <a class="reference internal" href="options/ARMLinkerOptions.html#cmdoption-compact"><code class="xref std std-option docutils literal notranslate"><span class="pre">--compact</span></code></a> option
alignment restriction is violated!</p>
<p>Note that the linker cannot simply bump the LMA by 0x4 as well to align with the VMA bump because
then the LMA (0xc) will not be 8-byte aligned.</p>
<p>To fix this issue, we have to ensure that for each <code class="docutils literal notranslate"><span class="pre">LOAD</span></code> segment,
<strong>the VMA is congruent to the LMA, modulo the maximum alignment of any section within the segment</strong>.</p>
<p>For this particular case, this means that <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> segment VMA and LMA must be congruent modulo 8.
8 is the alignment of <code class="docutils literal notranslate"><span class="pre">BAR</span></code> section and is the maximum alignment requirement of sections within <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>.
This congruency ensures that no bump for satisfying alignment will cause misalignment between VMA and LMA.
Hence, to fix this issue we can change VMA to 0x1004 (0x1004 and 0x4 are congruent to each other, modulo 8),
or change LMA to 0x8 (0x1000 and 0x8 are congruent to each other, modulo 8). Any other value of VMA and LMA
satifying this congruency is, of course, valid as well.</p>
</div>
</div>
<div class="section" id="runtime-issues">
<h2><a class="toc-backref" href="#id141"><span class="section-number">17.14. </span>Runtime issues</a><a class="headerlink" href="#runtime-issues" title="Permalink to this heading"></a></h2>
<div class="section" id="id14">
<h3><a class="toc-backref" href="#id142"><span class="section-number">17.14.1. </span>ARM</a><a class="headerlink" href="#id14" title="Permalink to this heading"></a></h3>
</div>
<div class="section" id="crash-with-load-stores">
<h3><a class="toc-backref" href="#id143"><span class="section-number">17.14.2. </span>Crash with load / stores</a><a class="headerlink" href="#crash-with-load-stores" title="Permalink to this heading"></a></h3>
<p>Things to look at when there is a crash :-</p>
<ul>
<li><p>Look at the point of crash, and the memory from where the instruction is
loading from or storing to</p></li>
<li><p>If the load or store is happening with a variable stored in the stack
* Bounce the problem to the compiler</p></li>
<li><p>If not, these are the next steps
* Look at variable, where its located from the Linker map file.
* Check for alignment restrictions
* Check for TLB permissions
* Check Linker script, if linker script is overriding any default alignment for</p>
<blockquote>
<div><p>the section that the variable is housed in.</p>
</div></blockquote>
<ul class="simple">
<li><p>Check for page alignment
* Sometimes the underlying operating system may require a higher page alignment
* User can change the default page size using <strong>-z max-page-size</strong> option.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="improving-your-image-build">
<h2><a class="toc-backref" href="#id144"><span class="section-number">17.15. </span>Improving your image/build</a><a class="headerlink" href="#improving-your-image-build" title="Permalink to this heading"></a></h2>
<p>The below section documents how users can improve the image / build by looking
into build time warning messages emitted by the linker.</p>
<div class="section" id="warnings">
<h3><a class="toc-backref" href="#id145"><span class="section-number">17.15.1. </span>Warnings</a><a class="headerlink" href="#warnings" title="Permalink to this heading"></a></h3>
<div class="section" id="convert-warning-to-error">
<h4><a class="toc-backref" href="#id146"><span class="section-number">17.15.1.1. </span>Convert warning to error</a><a class="headerlink" href="#convert-warning-to-error" title="Permalink to this heading"></a></h4>
<p>Users can add <code class="code docutils literal notranslate"><span class="pre">-Werror</span></code> to convert all warnings that the linker emits
into non-fatal errors.  A stronger form is <code class="code docutils literal notranslate"><span class="pre">--fatal-warnings</span></code>, which
promotes warnings to fatal errors.</p>
<p>This is synonymous to using <code class="code docutils literal notranslate"><span class="pre">-Wall</span> <span class="pre">-Werror</span></code> with the compiler</p>
</div>
<div class="section" id="non-allocatable-section-assigned-to-an-output-section">
<h4><a class="toc-backref" href="#id147"><span class="section-number">17.15.1.2. </span>Non allocatable section assigned to an output section</a><a class="headerlink" href="#non-allocatable-section-assigned-to-an-output-section" title="Permalink to this heading"></a></h4>
<p>Users might want to avoid assigning a non allocatable section to an output section
which is allocatable.</p>
<p>Though this is not a serious issue to be looked into, some of the issues which
this will result in are :-</p>
<ul class="simple">
<li><p>It may be that tools may be not be able to decode or disassemble contents from
the object files properly when there is a bug.</p></li>
<li><dl class="simple">
<dt>The build also may become flaky</dt><dd><ul>
<li><p>When section which converts the output section to be allocatable garbage
collected, which will make the section that user added as a non allocatable
section.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Non allocatable sections are not loaded by the linker</p></li>
<li><p>Relocations in non allocatable sections are not performed in the way allocatable
sections are treated.</p></li>
</ul>
<p>Linker detects that a non allocatable section is being assigned to an output
section which is allocatable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>code.s<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
.section<span class="w"> </span>.foo
sym:
nop
.section<span class="w"> </span>.text
call<span class="w"> </span>sym
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.text<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text<span class="o">)</span>
<span class="w">    </span>*<span class="o">(</span>.foo<span class="o">)</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
!

<span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span>code.s
<span class="nv">$link</span><span class="w"> </span>code.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>-o<span class="w"> </span>code.out
</pre></div>
</div>
<p>Linker would issue the below warning in this case.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Warning: Non-allocatable section ‘.foo’ from input file ‘code.o’ is being merged
into loadable output section ‘.text’</p>
</div>
<p>These warnings can be converted to errors with –fatal-warnings switch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$link</span><span class="w"> </span>code.o<span class="w"> </span>-T<span class="w"> </span>script.t<span class="w"> </span>--fatal-warnings
</pre></div>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Fatal: Non-allocatable section ‘.foo’ from input file ‘code.o’ is being merged
into loadable output section ‘.text’</p>
</div>
</div>
</div>
</div>
<div class="section" id="linkerplugin-api">
<h2><a class="toc-backref" href="#id148"><span class="section-number">17.16. </span>LinkerPlugin API</a><a class="headerlink" href="#linkerplugin-api" title="Permalink to this heading"></a></h2>
<div class="section" id="build-errors">
<h3><a class="toc-backref" href="#id149"><span class="section-number">17.16.1. </span>Build Errors</a><a class="headerlink" href="#build-errors" title="Permalink to this heading"></a></h3>
<div class="section" id="why-am-i-receiving-the-error-functions-that-differ-only-in-their-return-type-cannot-be-overloaded-error-while-building-plugins">
<h4><a class="toc-backref" href="#id150"><span class="section-number">17.16.1.1. </span>Why am I receiving the error ‘functions that differ only in their return type cannot be overloaded’ error while building plugins?</a><a class="headerlink" href="#why-am-i-receiving-the-error-functions-that-differ-only-in-their-return-type-cannot-be-overloaded-error-while-building-plugins" title="Permalink to this heading"></a></h4>
<p><strong>Fix:</strong> Build the plugin with ‘-std=c++14’ (or greater C++ standard).</p>
<p><strong>But what is the cause of the error?</strong></p>
<p>The plugin framework overloads member functions based on the reference-qualifier
of ‘this’ argument to provide optimal performance. However, C++11 does not support
specifying reference-qualifier for the ‘this’ argument of member functions. This
means that when C++11 is used, C++ cannot distinguish between member function
prototypes that only differ due to the reference-qualifier of the ‘this’ argument.</p>
</div>
<div class="section" id="why-am-i-getting-an-error-about-plugin-error-referenced-chunk-seen-from-last-rule-deleted-from-output-section">
<h4><a class="toc-backref" href="#id151"><span class="section-number">17.16.1.2. </span>Why am I getting an error about “Plugin Error referenced chunk &lt;seen from last rule&gt; deleted from Output section”</a><a class="headerlink" href="#why-am-i-getting-an-error-about-plugin-error-referenced-chunk-seen-from-last-rule-deleted-from-output-section" title="Permalink to this heading"></a></h4>
<p>This is a very common error, when a plugin takes chunks from linker script rules,
and sometimes the chunk are not put back by the linker plugins.</p>
<p>These chunks may be referred from other locations in the image, and is needed to
satisfy image layout requirements.</p>
<p>When such an error happens</p>
<ul class="simple">
<li><dl class="simple">
<dt>Please debug the plugin by inspecting calls to</dt><dd><ul>
<li><p>addChunk</p></li>
<li><p>removeChunk</p></li>
<li><p>updateChunks</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>You may also rely on linker map file to see that chunks are added and removed
properly by inspecting plugin behavior.</p>
</div>
</div>
<div class="section" id="runtime-errors">
<h3><a class="toc-backref" href="#id152"><span class="section-number">17.16.2. </span>Runtime errors</a><a class="headerlink" href="#runtime-errors" title="Permalink to this heading"></a></h3>
<div class="section" id="why-am-i-receiving-the-error-unable-to-load-library-libyourplugin-so-undefined-symbol">
<h4><a class="toc-backref" href="#id153"><span class="section-number">17.16.2.1. </span>Why am I receiving the error ‘Unable to load library ${libYourPlugin.so}: undefined symbol: …’?</a><a class="headerlink" href="#why-am-i-receiving-the-error-unable-to-load-library-libyourplugin-so-undefined-symbol" title="Permalink to this heading"></a></h4>
<p><strong>Fix:</strong> Build the plugin with ‘-stdlib=libc++’.</p>
<p>But what is the cause of this runtime error?</p>
<p>Plugin framework is compiled with ‘libc++’ implementation of standard library.
Therefore, the mangled names of standard library components in the plugin framework
are as per ‘libc++’ implementation. By default, Clang uses ‘libstdc++’ implementation
of standard library, which has different mangled names of standard library components
as compared to ‘libc++’ implementation. This difference of C++ standard library
implementation causes the conflict in the symbol names which in turn causes
undefined symbol error.</p>
</div>
</div>
<div class="section" id="concepts">
<h3><a class="toc-backref" href="#id154"><span class="section-number">17.16.3. </span>Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this heading"></a></h3>
<div class="section" id="id15">
<h4><a class="toc-backref" href="#id155"><span class="section-number">17.16.3.1. </span>What are the differences between SectionMatcherPlugin and SectionIteratorPlugin?</a><a class="headerlink" href="#id15" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><em>SectionMatcherPlugin</em> interface is run before garbage-collection whereas
SectionIteratorPlugin interface is run after rule-matching and garbage-collection.
As a consequence of this, SectionIteratorPlugin callbacks have access to the
information which sections are garbage-collected and discarded.</p></li>
<li><p><em>SectionIteratorPlugin</em> interface does not call ‘SectionIteratorPlugin::Process’
callback hook for garbage-collected sections. It is though called for discarded
sections. On the other hand, SectionMatcherPlugin call ‘SectionMatcherPlugin::Process’
callback hook for each input section.</p></li>
</ul>
</div>
<div class="section" id="what-is-the-search-order-for-plugin-invocation-configuration-file">
<h4><a class="toc-backref" href="#id156"><span class="section-number">17.16.3.2. </span>What is the search order for plugin invocation configuration file?</a><a class="headerlink" href="#what-is-the-search-order-for-plugin-invocation-configuration-file" title="Permalink to this heading"></a></h4>
<p>Plugin invocation configuration file is the YAML file that is specified to the linker
using <em>–plugin-config &lt;file&gt;</em> option.</p>
<p>The linker searches this file as follows:</p>
<ul class="simple">
<li><p>If the <em>&lt;file&gt;</em> is an absolute path, then no search is performed and the path is
taken as it is.</p></li>
<li><dl class="simple">
<dt>If the <em>&lt;file&gt;</em> is a relative path, then the search is performed as follows:</dt><dd><ul>
<li><p>In the current working directory. i.e. the directory from which linker is
invoked.</p></li>
<li><p>In the search directories specified by the -L option, in the order they are
listed in the link command.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="what-is-the-search-order-for-linkerwrapper-findconfigfile-function">
<h4><a class="toc-backref" href="#id157"><span class="section-number">17.16.3.3. </span>What is the search order for LinkerWrapper::findConfigFile function?</a><a class="headerlink" href="#what-is-the-search-order-for-linkerwrapper-findconfigfile-function" title="Permalink to this heading"></a></h4>
<p><em>LinkerWrapper::findConfigFile</em> searches the file as follows:</p>
<ul class="simple">
<li><p>If the <em>&lt;file&gt;</em> is an absolute path, then no search is performed and the path is taken as it is.</p></li>
<li><dl class="simple">
<dt>If the <em>&lt;file&gt;</em> is a relative path, then the search is performed as follows:</dt><dd><ul>
<li><p>In the current working directory. i.e. the directory from which linker is invoked</p></li>
<li><p>In the search directories specified by the -L option, in the order they are listed in the link command.</p></li>
<li><p>Plugin default configuration file directory that is shipped with the toolchain.
This directory is different for each plugin that is shipped with the toolchain.
This directory is searched so that it is convenient to use the default plugin
configuration files.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="debugging">
<h3><a class="toc-backref" href="#id158"><span class="section-number">17.16.4. </span>Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h3>
<div class="section" id="how-to-see-which-plugins-are-successfully-loaded">
<h4><a class="toc-backref" href="#id159"><span class="section-number">17.16.4.1. </span>How to see which plugins are successfully loaded?</a><a class="headerlink" href="#how-to-see-which-plugins-are-successfully-loaded" title="Permalink to this heading"></a></h4>
<p>Plugin workflow can be traced using the option <em>‘–trace=plugin’.</em>
This option tells the linker to print logs describing the plugin workflow, including
information about plugin loading.</p>
</div>
<div class="section" id="is-it-expected-to-see-decrease-in-link-time-performance-when-plugins-are-used">
<h4><a class="toc-backref" href="#id160"><span class="section-number">17.16.4.2. </span>Is it expected to see decrease in link-time performance when plugins are used?</a><a class="headerlink" href="#is-it-expected-to-see-decrease-in-link-time-performance-when-plugins-are-used" title="Permalink to this heading"></a></h4>
<p>Yes, user can is expected to see a decrease in link-time performance when</p>
<ul class="simple">
<li><dl class="simple">
<dt>Plugins are built with a wrong compiler optimization options.</dt><dd><ul>
<li><p>Using -g in release builds</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Plugins are developed without using Multi-threading features available.</p></li>
</ul>
<p>If you are developing plugins and plan to deploy it, use –print-timing-stats to
figure out which plugin / what part of the plugin is taking more time during the link step.
The plugin framework is feature rich and does not cause link time degradation in any way.</p>
</div>
<div class="section" id="how-to-verify-which-plugin-config-file-was-selected-by-the-linker">
<h4><a class="toc-backref" href="#id161"><span class="section-number">17.16.4.3. </span>How to verify which plugin config file was selected by the linker?</a><a class="headerlink" href="#how-to-verify-which-plugin-config-file-was-selected-by-the-linker" title="Permalink to this heading"></a></h4>
<p>Run the link command with –verbose option, and search the build logs for ‘Trying to open.
<em>&lt;plugin config file name&gt;’ and ‘&lt;plugin config file name&gt;.</em>: found’. These two
searches will tell you which directories were searched by the linker (and in which order),
and where the plugin configuration file was finally found.</p>
</div>
</div>
<div class="section" id="plugin-compatibility">
<h3><a class="toc-backref" href="#id162"><span class="section-number">17.16.5. </span>Plugin compatibility</a><a class="headerlink" href="#plugin-compatibility" title="Permalink to this heading"></a></h3>
<div class="section" id="plugin-api-version">
<h4><a class="toc-backref" href="#id163"><span class="section-number">17.16.5.1. </span>Plugin API version</a><a class="headerlink" href="#plugin-api-version" title="Permalink to this heading"></a></h4>
<p>Starting with version 19, linker verifies that the loaded plugin is build using
a compatible API version. Linker will refuse to load a plugin which API version
is incompatible or the plugin does not report its API version.</p>
<p>Plugin API version consists of major and minor version numbers. For example, the
current Plugin API version is 3.2, which can be inspected with the –version
linker option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ld.eld<span class="w"> </span>--version
Supported<span class="w"> </span>Targets:<span class="w"> </span>hexagon
Linker<span class="w"> </span>from<span class="w"> </span>QuIC<span class="w"> </span>LLVM<span class="w"> </span>Hexagon<span class="w"> </span>Clang<span class="w"> </span>version<span class="w"> </span>Version
Linker<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>LLVM<span class="w"> </span>version:<span class="w"> </span><span class="m">19</span>.0
Linker<span class="w"> </span>Plugin<span class="w"> </span>Support<span class="w"> </span>Enabled
Linker<span class="w"> </span>Plugin<span class="w"> </span>Interface<span class="w"> </span>Version<span class="w"> </span><span class="m">3</span>.2
LTO<span class="w"> </span>Support<span class="w"> </span>Enabled
</pre></div>
</div>
<p>A plugin is compatible with given Plugin API version if their major version numbers
are equal and plugin’s minor API version is the same or lower than the current
minor API version. This means that a plugin compiled for a certain linker API is
compatible with future linkers as long as the major version number stays the same.</p>
<p>Plugins must be recompiled to be used with linker with a different major API
version.</p>
</div>
<div class="section" id="reporting-api-version-by-plugins">
<h4><a class="toc-backref" href="#id164"><span class="section-number">17.16.5.2. </span>Reporting API version by plugins</a><a class="headerlink" href="#reporting-api-version-by-plugins" title="Permalink to this heading"></a></h4>
<p>Each plugin must report its API version by exporting the following function from
the plugin shared library:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">getPluginAPIVersion</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Major</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Minor</span><span class="p">);</span>
</pre></div>
</div>
<p>Plugin API library provides a helper implementation of this function, which as
defined in the PluginVersion.h  file. To report the plugin API, a plugin developer
can include this header file into one of the C++ source files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;PluginVersion.h&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="linker-plugin-config-search-paths">
<h3><a class="toc-backref" href="#id165"><span class="section-number">17.16.6. </span>Linker Plugin Config Search Paths</a><a class="headerlink" href="#linker-plugin-config-search-paths" title="Permalink to this heading"></a></h3>
<div class="section" id="what-are-the-search-paths-for-linker-plugin-config-files">
<h4><a class="toc-backref" href="#id166"><span class="section-number">17.16.6.1. </span>What are the search paths for linker plugin config files?</a><a class="headerlink" href="#what-are-the-search-paths-for-linker-plugin-config-files" title="Permalink to this heading"></a></h4>
<p>The <em>LinkerWrapper::findConfigFile()</em> API  searches for a config file in the
following directories in the following order:</p>
<ul class="simple">
<li><p>Try to find the file path directly</p></li>
<li><p>Search directories passed to the linker via -L. Some directories are implicitly
included, such as the current working directory, and /lib and /usr/lib on linux.</p></li>
<li><p>Default path for config files:
<em>${ORIGIN}/../etc/ELD/Plugins/&lt;Plugin name&gt;</em></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>${ORIGIN} is the directory in which the linker binary resides</p>
</div>
</div>
<div class="section" id="how-to-verify-that-the-plugin-search-config-was-found-and-debug-related-issues">
<h4><a class="toc-backref" href="#id167"><span class="section-number">17.16.6.2. </span>How to verify that the plugin search config was found and debug related issues?</a><a class="headerlink" href="#how-to-verify-that-the-plugin-search-config-was-found-and-debug-related-issues" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>The –verbose option will print extra logs to help determine if the plugin
config file was found</p></li>
<li><dl class="simple">
<dt>To debug issues related to search path for linker plugin file analyze the traces obtained via the below 2 steps:</dt><dd><ul>
<li><p>To get the list of paths at which the plugin config file path was searched for grep for “Trying to open.*&lt;plugin config file name&gt;” on verbose logs.</p></li>
<li><p>To see if the linker plugin config file was found grep for “&lt;plugin config file name&gt;.*: found” on verbose logs.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Example:</p>
<p>An example of using the API and verbose option to debug search paths is shown below for linux and for windows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">eld</span><span class="o">::</span><span class="n">Expected</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">expConfigPath</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">getLinker</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">findConfigFile</span><span class="p">(</span><span class="s">&quot;foo.ini&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Link command (linux):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ld.eld<span class="w"> </span>-L/tmp/<span class="w"> </span>...
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>//<span class="w"> </span>Search<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>file<span class="w"> </span>directly
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>file<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
//<span class="w"> </span>look<span class="w"> </span><span class="k">in</span><span class="w"> </span>-L<span class="w"> </span>directories
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>/tmp/foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
//<span class="w"> </span>implicit<span class="w"> </span>directories<span class="w"> </span><span class="o">(</span>cwd,<span class="w"> </span>/lib,<span class="w"> </span>/usr/lib<span class="o">)</span>
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>/usr2/aregmi/foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span>
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>/lib/foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>/usr/lib/foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
//<span class="w"> </span>try<span class="w"> </span>the<span class="w"> </span>default<span class="w"> </span>config<span class="w"> </span>directory
Note:<span class="w"> </span>Using<span class="w"> </span>default<span class="w"> </span>config<span class="w"> </span>path<span class="w"> </span><span class="k">for</span><span class="w"> </span>linker<span class="w"> </span>plugins
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>/local/mnt/workspace/aregmi/llvm-project/llvm/build/bin/../etc/ELD/Plugins/ConfigFile/foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>found
Verbose:<span class="w"> </span>Found<span class="w"> </span>plugin<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>/local/mnt/workspace/aregmi/llvm-project/llvm/build/etc/ELD/Plugins/ConfigFile/foo.ini
</pre></div>
</div>
<p>Link command (Windows):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ld.eld<span class="w"> </span>-L/<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\ </span>...
</pre></div>
</div>
<p>Verbose logs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>//<span class="w"> </span>Search<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>file<span class="w"> </span>directly
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>foo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>file<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
//<span class="w"> </span>look<span class="w"> </span><span class="k">in</span><span class="w"> </span>-L<span class="w"> </span>directories
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>C:<span class="se">\U</span>sers<span class="se">\f</span>oo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
//<span class="w"> </span>implicit<span class="w"> </span>directories<span class="w"> </span><span class="o">(</span>cwd<span class="o">)</span>
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>C:<span class="se">\U</span>sers<span class="se">\a</span>regmi<span class="se">\t</span>mp<span class="se">\f</span>oo.ini<span class="s1">&#39; for plugin configuration INI file `foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>not<span class="w"> </span>found
Note:<span class="w"> </span>Using<span class="w"> </span>default<span class="w"> </span>config<span class="w"> </span>path<span class="w"> </span><span class="k">for</span><span class="w"> </span>linker<span class="w"> </span>plugins
//<span class="w"> </span>default<span class="w"> </span>config<span class="w"> </span>directory
Verbose:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span><span class="sb">`</span>C:<span class="se">\U</span>sers<span class="se">\a</span>regmi<span class="se">\i</span>nstall<span class="se">\T</span>ools<span class="se">\b</span>in/../etc/ELD/Plugins/ConfigFile<span class="se">\f</span>oo.ini<span class="s1">&#39; for plugin configuration INI file</span>
<span class="s1">`foo.ini&#39;</span><span class="w"> </span><span class="o">(</span>search<span class="w"> </span>path<span class="o">)</span>:<span class="w"> </span>found
Verbose:<span class="w"> </span>Found<span class="w"> </span>plugin<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\a</span>regmi<span class="se">\i</span>nstall<span class="se">\T</span>ools<span class="se">\e</span>tc<span class="se">\E</span>LD<span class="se">\P</span>lugins<span class="se">\C</span>onfigFile<span class="se">\c</span>onfig<span class="se">\f</span>oo.ini
</pre></div>
</div>
</div>
</div>
<div class="section" id="linker-script-noload-handling">
<h3><a class="toc-backref" href="#id168"><span class="section-number">17.16.7. </span>Linker Script NOLOAD handling</a><a class="headerlink" href="#linker-script-noload-handling" title="Permalink to this heading"></a></h3>
<div class="section" id="description">
<h4><a class="toc-backref" href="#id169"><span class="section-number">17.16.7.1. </span>Description</a><a class="headerlink" href="#description" title="Permalink to this heading"></a></h4>
<p>NOLOAD sections are used as a way to tell the loader to reserve one or more regions
in memory and not refresh its contents for repeated loads of the same image.</p>
<p>Assumptions of the regions are</p>
<ul class="simple">
<li><p>The region has a reserved virtual address space</p></li>
<li><p>The region has a reserved physical address space</p></li>
<li><p>The region gets translated to “BSS”</p></li>
</ul>
<p>This means that the image when it runs, can write some content to the region and
re-read their contents.</p>
<p>Examples of use cases are:</p>
<ul class="simple">
<li><p>Store state of the application before the application crashes, resume from where
it left off</p></li>
<li><p>Store state of why the application crashed for inspection</p></li>
</ul>
</div>
<div class="section" id="references">
<h4><a class="toc-backref" href="#id170"><span class="section-number">17.16.7.2. </span>References</a><a class="headerlink" href="#references" title="Permalink to this heading"></a></h4>
<p><a class="reference external" href="https://mcuoneclipse.com/2014/04/19/gnu-linker-can-you-not-initialize-my-variable/">https://mcuoneclipse.com/2014/04/19/gnu-linker-can-you-not-initialize-my-variable/</a></p>
</div>
<div class="section" id="usecases">
<h4><a class="toc-backref" href="#id171"><span class="section-number">17.16.7.3. </span>Usecases</a><a class="headerlink" href="#usecases" title="Permalink to this heading"></a></h4>
<div class="section" id="noload-region-assigned-to-pt-null-segment">
<h5><a class="toc-backref" href="#id172"><span class="section-number">17.16.7.3.1. </span>NOLOAD region assigned to PT_NULL segment</a><a class="headerlink" href="#noload-region-assigned-to-pt-null-segment" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>fb.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>noload.lcs<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>B<span class="w"> </span>PT_NULL<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="w">  </span>.baz<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="o">}</span>
!
</pre></div>
</div>
<p>The above test places bar and baz in NOLOAD regions and places them in a segment
that is non loadable (PT_NULL).</p>
<p>Readelf Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>are<span class="w"> </span><span class="m">2</span><span class="w"> </span>program<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x0000c<span class="w"> </span>0x0000c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000
<span class="w">  </span>NULL<span class="w">           </span>0x000000<span class="w"> </span>0x00000010<span class="w"> </span>0x00000010<span class="w"> </span>0x00000<span class="w"> </span>0x00320<span class="w"> </span>RW<span class="w">  </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.foo
<span class="w">   </span><span class="m">01</span><span class="w">     </span>.bar<span class="w"> </span>.baz
<span class="w">   </span>None<span class="w">   </span>.comment<span class="w"> </span>.shstrtab<span class="w"> </span>.symtab<span class="w"> </span>.strtab
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PT_NULL segments in this case will have the virtual address set and the segment
memory size appropriately set. If you do not want to see virtual addresses assigned
or memory size set, remove the segment assignment(s).</p>
</div>
</div>
<div class="section" id="placing-a-loadable-section-to-pt-null">
<h5><a class="toc-backref" href="#id173"><span class="section-number">17.16.7.3.2. </span>Placing a loadable section to PT_NULL</a><a class="headerlink" href="#placing-a-loadable-section-to-pt-null" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>fb.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
int<span class="w"> </span>baz<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>noload.lcs<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>B<span class="w"> </span>PT_NULL<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="w">  </span>.baz<span class="w">  </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="o">}</span>
!
</pre></div>
</div>
<p>The test places baz which is loadable into a PT_NULL segment</p>
<p>Output:</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Error: Loadable section .baz not in any load segment
Fatal: Linking had errors.</p>
</div>
</div>
<div class="section" id="placing-noload-region-to-load-segment">
<h5><a class="toc-backref" href="#id174"><span class="section-number">17.16.7.3.3. </span>Placing NOLOAD region to LOAD segment</a><a class="headerlink" href="#placing-noload-region-to-load-segment" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>fb.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
int<span class="w"> </span>baz<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>noload.lcs<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>B<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="w">  </span>.baz<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.bss.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="o">}</span>
!
</pre></div>
</div>
<p>This tests produces valid results with a section that is set to NOLOAD and placed
in a PT_LOAD segment.</p>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>are<span class="w"> </span><span class="m">2</span><span class="w"> </span>program<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x0000c<span class="w"> </span>0x0000c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000
<span class="w">  </span>LOAD<span class="w">           </span>0x001010<span class="w"> </span>0x00000010<span class="w"> </span>0x00000010<span class="w"> </span>0x00000<span class="w"> </span>0x00320<span class="w"> </span>RW<span class="w">  </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.foo
<span class="w">   </span><span class="m">01</span><span class="w">     </span>.bar<span class="w"> </span>.baz
</pre></div>
</div>
</div>
<div class="section" id="mixing-noload-and-load-regions">
<h5><a class="toc-backref" href="#id175"><span class="section-number">17.16.7.3.4. </span>Mixing NOLOAD and LOAD regions</a><a class="headerlink" href="#mixing-noload-and-load-regions" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>fb.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
__attribute__<span class="o">((</span>aligned<span class="o">(</span><span class="m">4</span><span class="o">)))</span><span class="w"> </span>int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
__attribute__<span class="o">((</span>aligned<span class="o">(</span><span class="m">4</span><span class="o">)))</span><span class="w"> </span>int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
__attribute__<span class="o">((</span>aligned<span class="o">(</span><span class="m">4</span><span class="o">)))</span><span class="w"> </span>int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
__attribute__<span class="o">((</span>aligned<span class="o">(</span><span class="m">4</span><span class="o">)))</span><span class="w"> </span>int<span class="w"> </span>bad<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>noload.lcs<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w">  </span>B<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.foo<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="w">  </span>.baz<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="w">  </span>.bad<span class="w">  </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bad<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:B
<span class="o">}</span>
!
</pre></div>
</div>
<p>This places text.bar and text.baz as NOLOAD and .text.bad as a loadable section
but all of them in a LOAD segment.</p>
<p>These are the things that happens</p>
<ul class="simple">
<li><p>The text section gets turned into a BSS section (without any warning)</p></li>
<li><p>The text.bad section gets assigned a proper address</p></li>
</ul>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>are<span class="w"> </span><span class="m">2</span><span class="w"> </span>program<span class="w"> </span>headers,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x0000c<span class="w"> </span>0x0000c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000
<span class="w">  </span>LOAD<span class="w">           </span>0x001010<span class="w"> </span>0x00000010<span class="w"> </span>0x00000010<span class="w"> </span>0x0000c<span class="w"> </span>0x0002c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.foo
<span class="w">   </span><span class="m">01</span><span class="w">     </span>.bar<span class="w"> </span>.baz<span class="w"> </span>.bad
</pre></div>
</div>
</div>
<div class="section" id="noload-section-in-the-middle-of-a-pt-load-segment">
<h5><a class="toc-backref" href="#id176"><span class="section-number">17.16.7.3.5. </span>NOLOAD section in the middle of a PT_LOAD segment</a><a class="headerlink" href="#noload-section-in-the-middle-of-a-pt-load-segment" title="Permalink to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
int<span class="w"> </span>mybss<span class="o">[</span><span class="m">100</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">}</span><span class="p">;</span>

int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>.foo<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.data*<span class="o">)</span>
<span class="w">   </span>*<span class="o">(</span>.bss*<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bar<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>*<span class="o">(</span>.text.bar<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
!
</pre></div>
</div>
<p>The example places foo and bar in .foo and .bar output sections respectively. The
linker script also reserves a .bss region of type NOLOAD, which is followed by a
loadable section .bar. All of the sections are located in a loadable segment by
name ‘A’.</p>
<p>The layout is adjusted so that, the section .bar is placed after .bss in the file.
The offset for .bar is calculated as the offset of bss and the size of bss.</p>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x001ac<span class="w"> </span>0x001ac<span class="w"> </span>RWE<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.f<span class="w"> </span>.bss<span class="w"> </span>.bar
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Without the NOLOAD directive, Linker would have produced this error message</p>
<p>Mixing BSS and non-BSS sections in segment. non-BSS ‘.bar’ is after BSS ‘.bss’ in linker script</p>
</div>
</div>
<div class="section" id="noload-sections-start-of-the-segment-and-pt-null-segment">
<h5><a class="toc-backref" href="#id177"><span class="section-number">17.16.7.3.6. </span>NOLOAD sections start of the segment and PT_NULL segment</a><a class="headerlink" href="#noload-sections-start-of-the-segment-and-pt-null-segment" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>LinkerScript:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>A<span class="w"> </span>PT_NULL<span class="p">;</span>
<span class="o">}</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>.abss1<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.abss1<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.abss2<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.abss2<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.abss3<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.abss3<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.f<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss1<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.bss1<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss2<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.bss2<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss3<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.bss3<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>*<span class="o">(</span>.text.bar<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
</pre></div>
</div>
<p>Commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
<span class="nv">$ld</span>.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>is<span class="w"> </span><span class="m">1</span><span class="w"> </span>program<span class="w"> </span>header,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x000000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000<span class="w"> </span>0x1419c<span class="w"> </span>RWE<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.abss1<span class="w"> </span>.abss2<span class="w"> </span>.abss3<span class="w"> </span>.f<span class="w"> </span>.bss1<span class="w"> </span>.bss2<span class="w"> </span>.bss3<span class="w"> </span>.bar
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: the initial offset assigned to the section. This results in a bug with GNU linker.</p>
</div>
</div>
<div class="section" id="noload-sections-start-of-the-segment">
<h5><a class="toc-backref" href="#id178"><span class="section-number">17.16.7.3.7. </span>NOLOAD sections start of the segment</a><a class="headerlink" href="#noload-sections-start-of-the-segment" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>LinkerScript:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>
SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w"> </span>.abss1<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.abss1<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.abss2<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.abss2<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.abss3<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.abss3<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.f<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss1<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.bss1<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss2<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.bss2<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bss3<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.bss.bss3<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span>.bar<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>*<span class="o">(</span>.text.bar<span class="o">)</span>
<span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="o">}</span>
</pre></div>
</div>
<p>Commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
<span class="nv">$ld</span>.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>is<span class="w"> </span><span class="m">1</span><span class="w"> </span>program<span class="w"> </span>header,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x004000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x1419c<span class="w"> </span>0x1419c<span class="w"> </span>RWE<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.abss1<span class="w"> </span>.abss2<span class="w"> </span>.abss3<span class="w"> </span>.f<span class="w"> </span>.bss1<span class="w"> </span>.bss2<span class="w"> </span>.bss3<span class="w"> </span>.bar
</pre></div>
</div>
<div class="section" id="how-the-offset-of-the-section-is-calculated">
<h6><a class="toc-backref" href="#id179"><span class="section-number">17.16.7.3.7.1. </span>How the offset of the section is calculated</a><a class="headerlink" href="#how-the-offset-of-the-section-is-calculated" title="Permalink to this heading"></a></h6>
<ul class="simple">
<li><p>The offset of the first loadable section starts at an offset = previous offset +
(current section address - first section in the segment)</p></li>
<li><p>The offset of the first lodable section starts at an offset = previous offset +
(current section address - previous section which occupies file space)</p></li>
</ul>
</div>
</div>
<div class="section" id="noload-sections-start-of-the-segment-with-first-load-section-starting-at-a-virtual-address">
<h5><a class="toc-backref" href="#id180"><span class="section-number">17.16.7.3.8. </span>NOLOAD sections start of the segment with first load section starting at a virtual address</a><a class="headerlink" href="#noload-sections-start-of-the-segment-with-first-load-section-starting-at-a-virtual-address" title="Permalink to this heading"></a></h5>
<p>Code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bss3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16384</span><span class="p">)))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">abss3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>LinkerScript:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>PHDRS<span class="w"> </span><span class="o">{</span>
A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="w"> </span><span class="o">}</span>
<span class="w"> </span>SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.abss1<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.bss.abss1<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.abss2<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.bss.abss2<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.abss3<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.bss.abss3<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>0x80000000<span class="p">;</span>
<span class="w">  </span>.f<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bss1<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.bss.bss1<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bss2<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.bss.bss2<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bss3<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>*<span class="o">(</span>.bss.bss3<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bar<span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>*<span class="o">(</span>.text.bar<span class="o">)</span>
<span class="w">  </span><span class="o">}</span><span class="w"> </span>:A
<span class="w"> </span><span class="o">}</span>
</pre></div>
</div>
<p>Commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
<span class="nv">$ld</span>.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>is<span class="w"> </span><span class="m">1</span><span class="w"> </span>program<span class="w"> </span>header,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x004000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x8000c19c<span class="w"> </span>0x8000c19c<span class="w"> </span>RWE<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.abss1<span class="w"> </span>.abss2<span class="w"> </span>.abss3<span class="w"> </span>.f<span class="w"> </span>.bss1<span class="w"> </span>.bss2<span class="w"> </span>.bss3<span class="w"> </span>.ba
</pre></div>
</div>
</div>
<div class="section" id="noload-sections-placed-at-beginning-of-segment">
<h5><a class="toc-backref" href="#id181"><span class="section-number">17.16.7.3.9. </span>NOLOAD sections placed at beginning of segment</a><a class="headerlink" href="#noload-sections-placed-at-beginning-of-segment" title="Permalink to this heading"></a></h5>
<p>When NOLOAD sections are placed at the beginning of the segment, they are not
assigned to any segment.</p>
<p>The sections are assigned NOBITS section property.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w">            </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="w"> </span>+<span class="w"> </span>0x4000<span class="p">;</span>
<span class="w">         </span><span class="o">}</span>
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">  </span>.baz<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>/DISCARD/<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.eh_frame<span class="o">)</span><span class="w"> </span>*<span class="o">(</span>.ARM.exidx*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections<span class="w"> </span>-fdata-sections<span class="w"> </span>-G0
<span class="nv">$ld</span>.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>readelf<span class="w"> </span>-l<span class="w"> </span>-W<span class="w"> </span>a.out

Elf<span class="w"> </span>file<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
Entry<span class="w"> </span>point<span class="w"> </span>0x0
There<span class="w"> </span>is<span class="w"> </span><span class="m">1</span><span class="w"> </span>program<span class="w"> </span>header,<span class="w"> </span>starting<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">52</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001020<span class="w"> </span>0x00004020<span class="w"> </span>0x00004020<span class="w"> </span>0x0000c<span class="w"> </span>0x0000c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.baz
</pre></div>
</div>
</div>
<div class="section" id="load-sections-following-noload-sections">
<h5><a class="toc-backref" href="#id182"><span class="section-number">17.16.7.3.10. </span>LOAD sections following NOLOAD sections</a><a class="headerlink" href="#load-sections-following-noload-sections" title="Permalink to this heading"></a></h5>
<p>If there is a LOAD section and the the previous section was a NOLOAD section, the
load section is not assigned program headers automatically.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w">            </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="w"> </span>+<span class="w"> </span>0x4000<span class="p">;</span>
<span class="w">         </span><span class="o">}</span>
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">  </span>.baz<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="w">  </span>/DISCARD/<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.eh_frame<span class="o">)</span><span class="w"> </span>*<span class="o">(</span>.ARM.exidx*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span>
!
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections
<span class="nv">$ld</span>.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Section .baz does not have segment assignment in linker script.</p>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Loadable section .baz not in any load segment</p>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Linking had errors.</p>
</div>
</div>
<div class="section" id="noload-sections-at-the-beginning-of-the-load-segment">
<h5><a class="toc-backref" href="#id183"><span class="section-number">17.16.7.3.11. </span>NOLOAD sections at the beginning of the LOAD segment</a><a class="headerlink" href="#noload-sections-at-the-beginning-of-the-load-segment" title="Permalink to this heading"></a></h5>
<p>NOLOAD sections when assigned to a LOAD segment gets loaded. The section is marked NOBITS.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>script.t<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
PHDRS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>A<span class="w"> </span>PT_LOAD<span class="p">;</span>
<span class="o">}</span>

SECTIONS<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>.foo<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>*<span class="o">(</span>.text.foo<span class="o">)</span>
<span class="w">            </span>.<span class="w"> </span><span class="o">=</span><span class="w"> </span>.<span class="w"> </span>+<span class="w"> </span>0x4000<span class="p">;</span>
<span class="w">         </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.bar<span class="w"> </span><span class="o">(</span>NOLOAD<span class="o">)</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.bar<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>.baz<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.text.baz<span class="o">)</span><span class="w"> </span><span class="o">}</span><span class="w"> </span>:A
<span class="w">  </span>/DISCARD/<span class="w"> </span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span>*<span class="o">(</span>.eh_frame<span class="o">)</span><span class="w"> </span>*<span class="o">(</span>.ARM.exidx*<span class="o">)</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
!

cat<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="se">\!</span>
int<span class="w"> </span>foo<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>bar<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
int<span class="w"> </span>baz<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
!
</pre></div>
</div>
<p>Commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$clang</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span>.c<span class="w"> </span>-ffunction-sections
<span class="nv">$ld</span>.eld<span class="w"> </span><span class="m">1</span>.o<span class="w"> </span>-T<span class="w"> </span>script.t
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Section<span class="w"> </span>Headers:
<span class="w">  </span><span class="o">[</span>Nr<span class="o">]</span><span class="w"> </span>Name<span class="w">              </span>Type<span class="w">            </span>Addr<span class="w">     </span>Off<span class="w">    </span>Size<span class="w">   </span>ES<span class="w"> </span>Flg<span class="w"> </span>Lk<span class="w"> </span>Inf<span class="w"> </span>Al
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w">                   </span>NULL<span class="w">            </span><span class="m">00000000</span><span class="w"> </span><span class="m">000000</span><span class="w"> </span><span class="m">000000</span><span class="w"> </span><span class="m">00</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">0</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">1</span><span class="o">]</span><span class="w"> </span>.foo<span class="w">              </span>NOBITS<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">001000</span><span class="w"> </span>00400c<span class="w"> </span><span class="m">00</span><span class="w">  </span>AX<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w"> </span><span class="m">16</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>.bar<span class="w">              </span>NOBITS<span class="w">          </span><span class="m">00004010</span><span class="w"> </span><span class="m">001000</span><span class="w"> </span>00000c<span class="w"> </span><span class="m">00</span><span class="w">  </span>AX<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w"> </span><span class="m">16</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">3</span><span class="o">]</span><span class="w"> </span>.baz<span class="w">              </span>PROGBITS<span class="w">        </span><span class="m">00004020</span><span class="w"> </span><span class="m">005020</span><span class="w"> </span>00000c<span class="w"> </span><span class="m">00</span><span class="w">  </span>AX<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w"> </span><span class="m">16</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">4</span><span class="o">]</span><span class="w"> </span>.comment<span class="w">          </span>PROGBITS<span class="w">        </span><span class="m">00000000</span><span class="w"> </span>00502c<span class="w"> </span><span class="m">000106</span><span class="w"> </span><span class="m">01</span><span class="w">  </span>MS<span class="w">  </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">5</span><span class="o">]</span><span class="w"> </span>.shstrtab<span class="w">         </span>STRTAB<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">005132</span><span class="w"> </span><span class="m">000033</span><span class="w"> </span><span class="m">00</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">6</span><span class="o">]</span><span class="w"> </span>.symtab<span class="w">           </span>SYMTAB<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">005168</span><span class="w"> </span>0000a0<span class="w"> </span><span class="m">10</span><span class="w">      </span><span class="m">7</span><span class="w">   </span><span class="m">6</span><span class="w">  </span><span class="m">4</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="m">7</span><span class="o">]</span><span class="w"> </span>.strtab<span class="w">           </span>STRTAB<span class="w">          </span><span class="m">00000000</span><span class="w"> </span><span class="m">005208</span><span class="w"> </span>00002f<span class="w"> </span><span class="m">00</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>
Key<span class="w"> </span>to<span class="w"> </span>Flags:
<span class="w">  </span>W<span class="w"> </span><span class="o">(</span>write<span class="o">)</span>,<span class="w"> </span>A<span class="w"> </span><span class="o">(</span>alloc<span class="o">)</span>,<span class="w"> </span>X<span class="w"> </span><span class="o">(</span>execute<span class="o">)</span>,<span class="w"> </span>M<span class="w"> </span><span class="o">(</span>merge<span class="o">)</span>,<span class="w"> </span>S<span class="w"> </span><span class="o">(</span>strings<span class="o">)</span>,<span class="w"> </span>I<span class="w"> </span><span class="o">(</span>info<span class="o">)</span>,
<span class="w">  </span>L<span class="w"> </span><span class="o">(</span>link<span class="w"> </span>order<span class="o">)</span>,<span class="w"> </span>O<span class="w"> </span><span class="o">(</span>extra<span class="w"> </span>OS<span class="w"> </span>processing<span class="w"> </span>required<span class="o">)</span>,<span class="w"> </span>G<span class="w"> </span><span class="o">(</span>group<span class="o">)</span>,<span class="w"> </span>T<span class="w"> </span><span class="o">(</span>TLS<span class="o">)</span>,
<span class="w">  </span>C<span class="w"> </span><span class="o">(</span>compressed<span class="o">)</span>,<span class="w"> </span>x<span class="w"> </span><span class="o">(</span>unknown<span class="o">)</span>,<span class="w"> </span>o<span class="w"> </span><span class="o">(</span>OS<span class="w"> </span>specific<span class="o">)</span>,<span class="w"> </span>E<span class="w"> </span><span class="o">(</span>exclude<span class="o">)</span>,
<span class="w">  </span>p<span class="w"> </span><span class="o">(</span>processor<span class="w"> </span>specific<span class="o">)</span>

Program<span class="w"> </span>Headers:
<span class="w">  </span>Type<span class="w">           </span>Offset<span class="w">   </span>VirtAddr<span class="w">   </span>PhysAddr<span class="w">   </span>FileSiz<span class="w"> </span>MemSiz<span class="w">  </span>Flg<span class="w"> </span>Align
<span class="w">  </span>LOAD<span class="w">           </span>0x001000<span class="w"> </span>0x00000000<span class="w"> </span>0x00000000<span class="w"> </span>0x0402c<span class="w"> </span>0x0402c<span class="w"> </span>R<span class="w"> </span>E<span class="w"> </span>0x1000

<span class="w"> </span>Section<span class="w"> </span>to<span class="w"> </span>Segment<span class="w"> </span>mapping:
<span class="w">  </span>Segment<span class="w"> </span>Sections...
<span class="w">   </span><span class="m">00</span><span class="w">     </span>.foo<span class="w"> </span>.bar<span class="w"> </span>.baz
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="target_specific_features.html" class="btn btn-neutral float-left" title="16. Target Specific Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Qualcomm Technologies, Inc. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>